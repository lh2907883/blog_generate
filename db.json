{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/logo.jpg","path":"images/logo.jpg","modified":0,"renderable":0},{"_id":"themes/jacman/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/FontAwesome.otf","path":"font/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.eot","path":"font/coveredbyyourgrace-webfont.eot","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.ttf","path":"font/coveredbyyourgrace-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.woff","path":"font/coveredbyyourgrace-webfont.woff","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontawesome-webfont.eot","path":"font/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontawesome-webfont.woff","path":"font/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontdiao.eot","path":"font/fontdiao.eot","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/author.jpg","path":"img/author.jpg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-nc-nd.svg","path":"img/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-nc-sa.svg","path":"img/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-nc.svg","path":"img/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontdiao.ttf","path":"font/fontdiao.ttf","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontdiao.woff","path":"font/fontdiao.woff","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-nd.svg","path":"img/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by-sa.svg","path":"img/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-by.svg","path":"img/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/cc-zero.svg","path":"img/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/jacman.jpg","path":"img/jacman.jpg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/logo.svg","path":"img/logo.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/scrollup.png","path":"img/scrollup.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/gallery.js","path":"js/gallery.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/jquery.imagesloaded.min.js","path":"js/jquery.imagesloaded.min.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/jquery.qrcode-0.12.0.min.js","path":"js/jquery.qrcode-0.12.0.min.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.svg","path":"font/coveredbyyourgrace-webfont.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontawesome-webfont.ttf","path":"font/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontdiao.svg","path":"font/fontdiao.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/logo.png","path":"img/logo.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/js/jquery-2.0.3.min.js","path":"js/jquery-2.0.3.min.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/jacman/source/font/fontawesome-webfont.svg","path":"font/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/jacman/source/img/banner.jpg","path":"img/banner.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"495dc0d217dbc3e7cb0c015a4aa9af3e7011d37f","modified":1494149618000},{"_id":"themes/jacman/.gitignore","hash":"7d65523f2a5afb69d76824dd1dfa62a34faa3197","modified":1494667734000},{"_id":"themes/jacman/LICENSE","hash":"931516aa36c53eb7843c83d82662eb50cc3c4367","modified":1494667734000},{"_id":"themes/jacman/README.md","hash":"75a5c9fbd7c9cec4d2f277042d2fee550e4936be","modified":1494667734000},{"_id":"themes/jacman/README_zh.md","hash":"d6014b16eaccc97dc54a7779c9e36003752410e1","modified":1494667734000},{"_id":"themes/jacman/_config.yml","hash":"2ccb4ccec846f3c2629142ffad1736018754a6b4","modified":1494669547000},{"_id":"source/_drafts/fetch.md","hash":"3b351b7ad2539fa595a2b64f3b9887ba4634d389","modified":1494666625000},{"_id":"source/_drafts/webç¦»çº¿åº”ç”¨.md","hash":"7b07e82297a34b5c97ad2c16e54344a72bed4c7e","modified":1494683728000},{"_id":"source/_drafts/é›ªç¢§å›¾ç”Ÿæˆ.md","hash":"f5de27b23abb83f36641d486965221910657a65f","modified":1494666671000},{"_id":"source/_posts/hello-world.md","hash":"8a02477044e2b77f1b262da2c48c01429e4a32e4","modified":1494663571000},{"_id":"source/_posts/å…³äºXMLHttpRequest.md","hash":"c89d8455efadf9b8346d670aa7854f295244b7df","modified":1494171286000},{"_id":"source/images/logo.jpg","hash":"63cfaf908e5a4a512a47ff6c7067c5db9f9c37dc","modified":1494170737000},{"_id":"themes/jacman/languages/default.yml","hash":"eea72d6138497287c0b3f4bd93e4f6f62b7aff37","modified":1494667734000},{"_id":"themes/jacman/languages/zh-CN.yml","hash":"1f3b9d00dd4322352b0c9c82a76dc9865a616d41","modified":1494667734000},{"_id":"themes/jacman/languages/zh-TW.yml","hash":"61a02ba818d641579a86fcd7f5926ab1e6ab5f70","modified":1494667734000},{"_id":"themes/jacman/layout/archive.ejs","hash":"a18842e3d719fe3ca9b977a6995f8facc75c8673","modified":1494667734000},{"_id":"themes/jacman/layout/category.ejs","hash":"9b740fc33f6f028df60f0bc4312bf3ebd03aa8ea","modified":1494667734000},{"_id":"themes/jacman/layout/index.ejs","hash":"75cef2172c286994af412e11ab7f4f5a0daaf1f5","modified":1494667734000},{"_id":"themes/jacman/layout/layout.ejs","hash":"5b4289a4526899809b9c2facea535367ff51ba2b","modified":1494667734000},{"_id":"themes/jacman/layout/page.ejs","hash":"bd6bbf2ea8e183bd835867ff617dc6366b56748c","modified":1494667734000},{"_id":"themes/jacman/layout/post.ejs","hash":"3114134775bdde5a83cf14feb019606fa2b2b2be","modified":1494667734000},{"_id":"themes/jacman/layout/tag.ejs","hash":"45150a2365768b6b67880193c9264ad2bb4814db","modified":1494667734000},{"_id":"themes/jacman/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/after_footer.ejs","hash":"c703b0c25139b8a5f8f9d24a334a07905e2b7987","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/archive.ejs","hash":"2c7395e7563fe016521712a645c28a13f952d52a","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/article.ejs","hash":"261ecacb8456f4cb972632b6a9103860fa63b9a3","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/analytics.ejs","hash":"697601996220fe0a0f9cd628be67dec3c86ae2aa","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/article_row.ejs","hash":"4cb855d91ece7f67b2ca0992fffa55472d0b9c93","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/categories.ejs","hash":"8a52d0344d5bce1925cf586ed73c11192925209b","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/footer.ejs","hash":"5f80bf6c6ddcf8c28c4599cd1540b14b25d54f18","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/head.ejs","hash":"761941be4922cd3c177c8130296b909bf7db5c09","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/header.ejs","hash":"18515612344ff048b9372b91b7eef6f3b143801f","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/mathjax.ejs","hash":"d42994ac696f52ba99c1cbac382cd76d5b04a3e8","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/pagination.ejs","hash":"6146ac37dfb4f8613090bc52b3fc8cfa911a186a","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/search.ejs","hash":"1083824a6c6c3df02767f2f3b727aee78ebb76ec","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/sidebar.ejs","hash":"c4f527fff0070fbe65919053a16224412317f40d","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/tags.ejs","hash":"b33b2b5d08f1d53a8de25a95f660f7f1cea7b3cb","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/tinysou_search.ejs","hash":"06ecddc8a9d40b480fe2e958af1dab857a9d5441","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/totop.ejs","hash":"bea5bb7cb9350b8af7d97a8d223af63a5b30ab78","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/archive.ejs","hash":"39ea6b7888406fbd1b4cf236ebd718e881493374","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/category.ejs","hash":"c1fae96b5053da021bcc04ab2ce5c2c8d30de8a2","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/douban.ejs","hash":"e3820c36169e88663e6c9177666b2904c1ce47e6","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/github-card.ejs","hash":"5c759b6ea214bac56a393247de27e67ce73fb33f","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/links.ejs","hash":"e49868063439c2092cdf9a8ec82cc295b0e42f66","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/rss.ejs","hash":"0a4b5f2a2e36a1d504fe2e7c6c8372cbb4628aab","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/tag.ejs","hash":"7e82ad9c916b9ce871b2f65ce8f283c5ba47947b","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/tagcloud.ejs","hash":"10a1001189d5c28ce6d42494563b9637c302b454","modified":1494667734000},{"_id":"themes/jacman/layout/_widget/weibo.ejs","hash":"a31c2b223d0feb2a227e203cac9e5d13b7d328a8","modified":1494667734000},{"_id":"themes/jacman/source/css/style.styl","hash":"a0a45af186a72ae68979bf26f2a5d0d2303189ca","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1494667734000},{"_id":"themes/jacman/source/font/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1494667734000},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.eot","hash":"a17d0f10534303e40f210c506ebb8703fa23b7de","modified":1494667734000},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.ttf","hash":"194ccb4acf77a03dc25bcc174edb266143704fec","modified":1494667734000},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.woff","hash":"c6f8dc1a2f6ce914f120e80a876b8fd77b98888e","modified":1494667734000},{"_id":"themes/jacman/source/font/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1494667734000},{"_id":"themes/jacman/source/font/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1494667734000},{"_id":"themes/jacman/source/font/fontdiao.eot","hash":"9544a0d7ba208989302bc4da5a184faeb0e883c9","modified":1494667734000},{"_id":"themes/jacman/source/img/author.jpg","hash":"2a292e681b4c6c975eec9c8c356d99647a465542","modified":1494667734000},{"_id":"themes/jacman/source/img/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1494667734000},{"_id":"themes/jacman/source/img/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1494667734000},{"_id":"themes/jacman/source/img/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1494667734000},{"_id":"themes/jacman/source/font/fontdiao.ttf","hash":"ee9fd7be2493c9bf6d2841044e69a0830d9d3fab","modified":1494667734000},{"_id":"themes/jacman/source/font/fontdiao.woff","hash":"71f54eb6e98aa28cafeb04aab71c0e5b349ea89f","modified":1494667734000},{"_id":"themes/jacman/source/img/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1494667734000},{"_id":"themes/jacman/source/img/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1494667734000},{"_id":"themes/jacman/source/img/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1494667734000},{"_id":"themes/jacman/source/img/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1494667734000},{"_id":"themes/jacman/source/img/favicon.ico","hash":"2d22a3e0c7905a894e832c831dd91c29c209c7a5","modified":1494667734000},{"_id":"themes/jacman/source/img/jacman.jpg","hash":"0ba14a4a5e3be012826fc713c33479912126d34e","modified":1494667734000},{"_id":"themes/jacman/source/img/logo.svg","hash":"9ae38f7225c38624faeb7b74996efa9de7bf065b","modified":1494667734000},{"_id":"themes/jacman/source/img/scrollup.png","hash":"2137d4f1739aa8aa3fcb0348c3ddf1e41d62f2e3","modified":1494667734000},{"_id":"themes/jacman/source/js/gallery.js","hash":"f8a4ba7fb8349cca374a3c69fff9b2bf21f742ed","modified":1494667734000},{"_id":"themes/jacman/source/js/jquery.imagesloaded.min.js","hash":"4109837b1f6477bacc6b095a863b1b95b1b3693f","modified":1494667734000},{"_id":"themes/jacman/source/js/jquery.qrcode-0.12.0.min.js","hash":"57c3987166a26415a71292162690e82c21e315ad","modified":1494667734000},{"_id":"themes/jacman/source/js/totop.js","hash":"cad23c5ea7163d1e5c05a0fd3ef9233469da10cb","modified":1494667734000},{"_id":"themes/jacman/source/font/coveredbyyourgrace-webfont.svg","hash":"eabdb262d8e246865dfb56031f01ff6e8d2f9d53","modified":1494667734000},{"_id":"themes/jacman/source/font/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1494667734000},{"_id":"themes/jacman/source/font/fontdiao.svg","hash":"334a94e6a66a8b089be7315d876bec93efe38d2b","modified":1494667734000},{"_id":"themes/jacman/source/img/logo.png","hash":"fd08d12d1fa147cf894e8f8327e38f1758de32ed","modified":1494667734000},{"_id":"themes/jacman/source/js/jquery-2.0.3.min.js","hash":"a0ae3697b0ab8c0e8bd3186c80db42abd6d97a8d","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/post/article.ejs","hash":"b09e3acea7076e1f01dfe0c2295e19951ea09437","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/post/comment.ejs","hash":"c88bc8f5805173920a5fdd7e9234a850e3d8e151","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/post/catetags.ejs","hash":"0e37bababc8f4659f5b59a552a946b46d89e4158","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/post/footer.ejs","hash":"b12ec08a5845a3d8c01257614f1dfead879c87d2","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/post/gallery.ejs","hash":"fafc2501d7e65983b0f5c2b58151ca12e57c0574","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/post/header.ejs","hash":"36a705942b691abe0d643ea8afa339981b32f6f2","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/post/jiathis.ejs","hash":"d7f5960039ac74924559ab6ba03c64457b8f0966","modified":1494667734000},{"_id":"themes/jacman/layout/_partial/post/pagination.ejs","hash":"7de9c07a4c968429a8088c31a28b7f3a993ded1b","modified":1494667734000},{"_id":"themes/jacman/source/css/_base/font.styl","hash":"c8a0faf43b08e37ad07a5669db76d595da966159","modified":1494667734000},{"_id":"themes/jacman/source/css/_base/public.styl","hash":"f016180726019927b9a835ed01e04d153f27a149","modified":1494667734000},{"_id":"themes/jacman/source/css/_base/variable.styl","hash":"cb652eb83c28a208743fabab92de896f8b7cbf7b","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/article.styl","hash":"c69641b4a34a8c62986b335414413dbde26de25e","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/aside.styl","hash":"506fde1d67ce750452cbe84bee01a19c7d027c5e","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/duoshuo.styl","hash":"e85f1192283f043115c272a9deb3cb6ced793990","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/footer.styl","hash":"1911613a19b605a58f801c21b03b5d4c83b90f9c","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/gallery.styl","hash":"7246809f4ce3166ec1b259bf475cae1a48e29aad","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/header.styl","hash":"5121ceb712be3f2dde98b8b6e589b546e19eab8f","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/helper.styl","hash":"1136600932b97534b88465bf05ef313630b2de3d","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/index.styl","hash":"a72ff14effd276015264f870f47ed8f8413bf5d3","modified":1494667734000},{"_id":"themes/jacman/source/css/_partial/totop.styl","hash":"96363d7c5aaed5f649667fc0752a62620a67e872","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1494667734000},{"_id":"themes/jacman/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1494667734000},{"_id":"themes/jacman/source/font/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1494667734000},{"_id":"themes/jacman/source/img/banner.jpg","hash":"5104860c4f8b2e84ef734ba6c37fe7a288bf0d74","modified":1494667734000},{"_id":"themes/jacman/source/css/_base/highlight/highlight.styl","hash":"91b62bfc58390b0d5db782a75be6965ee3665eb3","modified":1494667734000},{"_id":"themes/jacman/source/css/_base/highlight/theme.styl","hash":"e3a59bd427ba37a54ead9eeba9a5356b3f720a48","modified":1494667734000},{"_id":"public/search.xml","hash":"af1d37fe20d626df8c15a6b520dd71d9e44ef561","modified":1494669712560},{"_id":"public/content.json","hash":"3189c773efeadbbabc6687fefd9a7425351c1c78","modified":1494669712649},{"_id":"public/atom.xml","hash":"23e64a26337ec710212a18b469fadeb946da0fc5","modified":1494669712650},{"_id":"public/sitemap.xml","hash":"48c7acc4d69376e1d1835efe596bc87f1c013228","modified":1494669712650},{"_id":"public/2017/05/06/hello-world/index.html","hash":"0b80d21f5292fa20f705f05b1c1f7fa21b8d8233","modified":1494669712666},{"_id":"public/archives/index.html","hash":"bba8383b6e1387792e28f528fbeef26205757a72","modified":1494669712686},{"_id":"public/archives/2017/index.html","hash":"0a1e4e377ae9055900f17b01693e1d3ed93ac203","modified":1494669712687},{"_id":"public/archives/2017/05/index.html","hash":"045a9150a01c802122b2859ebf52e3ca9e12d492","modified":1494669712687},{"_id":"public/tags/javascript/index.html","hash":"d6b6ac7ba7c8dc232b294a1a758d06310ad52d40","modified":1494669712687},{"_id":"public/2017/05/07/å…³äºXMLHttpRequest/index.html","hash":"4f8d6024f22c3911b99e23362645c50e68a89b03","modified":1494669712687},{"_id":"public/index.html","hash":"c682ea67b957dc37f76777fc291a0133519d07eb","modified":1494669712687},{"_id":"public/2017/05/13/é›ªç¢§å›¾ç”Ÿæˆ/index.html","hash":"674d98a9a14aac53613a26814197fbce69b689db","modified":1494669712693},{"_id":"public/2017/05/13/webç¦»çº¿åº”ç”¨/index.html","hash":"5ecc1f97eafce80fe55d76d42743e9cc86f313db","modified":1494669712693},{"_id":"public/2017/05/13/fetch/index.html","hash":"f4aa6b87b6ee50c6650dedfcc4196bdb1a4e7fe8","modified":1494669712693},{"_id":"public/images/logo.jpg","hash":"63cfaf908e5a4a512a47ff6c7067c5db9f9c37dc","modified":1494669712701},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1494669712701},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1494669712702},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1494669712702},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1494669712703},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1494669712703},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1494669712703},{"_id":"public/font/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1494669712703},{"_id":"public/font/coveredbyyourgrace-webfont.eot","hash":"a17d0f10534303e40f210c506ebb8703fa23b7de","modified":1494669712703},{"_id":"public/font/coveredbyyourgrace-webfont.woff","hash":"c6f8dc1a2f6ce914f120e80a876b8fd77b98888e","modified":1494669712703},{"_id":"public/font/coveredbyyourgrace-webfont.ttf","hash":"194ccb4acf77a03dc25bcc174edb266143704fec","modified":1494669712704},{"_id":"public/font/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1494669712704},{"_id":"public/img/author.jpg","hash":"2a292e681b4c6c975eec9c8c356d99647a465542","modified":1494669712704},{"_id":"public/img/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1494669712704},{"_id":"public/font/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1494669712704},{"_id":"public/font/fontdiao.eot","hash":"9544a0d7ba208989302bc4da5a184faeb0e883c9","modified":1494669712704},{"_id":"public/img/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1494669712704},{"_id":"public/img/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1494669712704},{"_id":"public/font/fontdiao.woff","hash":"71f54eb6e98aa28cafeb04aab71c0e5b349ea89f","modified":1494669712704},{"_id":"public/font/fontdiao.ttf","hash":"ee9fd7be2493c9bf6d2841044e69a0830d9d3fab","modified":1494669712704},{"_id":"public/img/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1494669712704},{"_id":"public/img/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1494669712705},{"_id":"public/img/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1494669712705},{"_id":"public/img/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1494669712705},{"_id":"public/img/favicon.ico","hash":"2d22a3e0c7905a894e832c831dd91c29c209c7a5","modified":1494669712705},{"_id":"public/img/jacman.jpg","hash":"0ba14a4a5e3be012826fc713c33479912126d34e","modified":1494669712705},{"_id":"public/img/logo.svg","hash":"9ae38f7225c38624faeb7b74996efa9de7bf065b","modified":1494669712705},{"_id":"public/img/scrollup.png","hash":"2137d4f1739aa8aa3fcb0348c3ddf1e41d62f2e3","modified":1494669712705},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1494669712705},{"_id":"public/font/coveredbyyourgrace-webfont.svg","hash":"eabdb262d8e246865dfb56031f01ff6e8d2f9d53","modified":1494669713344},{"_id":"public/img/logo.png","hash":"fd08d12d1fa147cf894e8f8327e38f1758de32ed","modified":1494669713350},{"_id":"public/font/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1494669713352},{"_id":"public/font/fontdiao.svg","hash":"334a94e6a66a8b089be7315d876bec93efe38d2b","modified":1494669713352},{"_id":"public/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1494669713356},{"_id":"public/js/gallery.js","hash":"f8a4ba7fb8349cca374a3c69fff9b2bf21f742ed","modified":1494669713356},{"_id":"public/js/jquery.imagesloaded.min.js","hash":"4109837b1f6477bacc6b095a863b1b95b1b3693f","modified":1494669713356},{"_id":"public/js/totop.js","hash":"cad23c5ea7163d1e5c05a0fd3ef9233469da10cb","modified":1494669713356},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1494669713356},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1494669713356},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1494669713356},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1494669713356},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1494669713356},{"_id":"public/css/style.css","hash":"01dacd94c4db9021e030bedc95f1a7ec402000f7","modified":1494669713356},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1494669713357},{"_id":"public/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1494669713357},{"_id":"public/js/jquery.qrcode-0.12.0.min.js","hash":"57c3987166a26415a71292162690e82c21e315ad","modified":1494669713357},{"_id":"public/js/jquery-2.0.3.min.js","hash":"a0ae3697b0ab8c0e8bd3186c80db42abd6d97a8d","modified":1494669713357},{"_id":"public/font/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1494669713358},{"_id":"public/img/banner.jpg","hash":"5104860c4f8b2e84ef734ba6c37fe7a288bf0d74","modified":1494669713358},{"_id":"source/_posts/webç¦»çº¿åº”ç”¨.md","hash":"eb3813aab23547ebae3af148228f853abbe65a6f","modified":1494752549000}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"fetch","_content":"","source":"_drafts/fetch.md","raw":"---\ntitle: fetch\ntags:\n---\n","slug":"fetch","published":0,"date":"2017-05-13T09:10:25.000Z","updated":"2017-05-13T09:10:25.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj2n3r716000010txaswmep2h","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"é›ªç¢§å›¾ç”Ÿæˆ","_content":"","source":"_drafts/é›ªç¢§å›¾ç”Ÿæˆ.md","raw":"---\ntitle: é›ªç¢§å›¾ç”Ÿæˆ\ntags:\n---\n","slug":"é›ªç¢§å›¾ç”Ÿæˆ","published":0,"date":"2017-05-13T09:11:11.000Z","updated":"2017-05-13T09:11:11.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj2n3r719000110txa742fi31","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/deployment.html)\n","slug":"hello-world","published":1,"date":"2017-05-06T08:43:45.000Z","updated":"2017-05-13T08:19:31.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj2n3r71d000310txcxwk7id4","content":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"external\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"external\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"external\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"external\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"external\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo server</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"external\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo generate</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"external\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo deploy</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"external\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\" target=\"_blank\" rel=\"external\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\" target=\"_blank\" rel=\"external\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\" target=\"_blank\" rel=\"external\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\" target=\"_blank\" rel=\"external\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\" target=\"_blank\" rel=\"external\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo server</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/server.html\" target=\"_blank\" rel=\"external\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo generate</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\" target=\"_blank\" rel=\"external\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ hexo deploy</div></pre></td></tr></table></figure>\n<p>More info: <a href=\"https://hexo.io/docs/deployment.html\" target=\"_blank\" rel=\"external\">Deployment</a></p>\n"},{"title":"å…³äºXMLHttpRequest","date":"2017-05-07T04:37:45.000Z","_content":"## XMLHttpRequestæ˜¯ä»€ä¹ˆ\nXMLHttpRequest æ˜¯ä¸€ä¸ª[API](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest), å®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ [AJAX](https://developer.mozilla.org/zh-CN/docs/AJAX) ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚\n\n## å…¼å®¹æ€§\n![](https://lh2907883.github.io/store/blog/%E5%85%B3%E4%BA%8EXMLHttpRequest/1.png)\n* IE8/IE9ä¹Ÿå®Œå…¨ä¸æ”¯æŒxhrå¯¹è±¡, ä¸è¿‡å¯ä»¥ä½¿ç”¨[ActiveXObject](https://msdn.microsoft.com/zh-cn/library/7sw4ddf8%28v=vs.94%29.aspx)ç±»ç”Ÿæˆxhrå®ä¾‹\n```javascript\nnew window.ActiveXObject( \"Microsoft.XMLHTTP\" )\n```\n* IE10/IE11éƒ¨åˆ†æ”¯æŒï¼Œä¸æ”¯æŒ xhr.responseTypeä¸ºjson\n\n## å¦‚ä½•ä½¿ç”¨\nä½¿ç”¨xhrç»™åå°serverå‘é€è¯·æ±‚,å¤§æ¦‚å¯ä»¥åˆ†ä¸‹é¢å‡ ä¸ªæ­¥éª¤\n### 1.å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡\n```javascript\nvar xhr = new XMLHttpRequest();\n```\n\n### 2.åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚\n```javascript\nxhr.open('POST', '/server', true);\n```\n``open(method, url [, async = true [, username = null [, password = null]]])``\n\nasync: é»˜è®¤å€¼ä¸ºtrueï¼Œå³ä¸ºå¼‚æ­¥è¯·æ±‚ï¼Œè‹¥async=falseï¼Œåˆ™ä¸ºåŒæ­¥è¯·æ±‚\n\n### 3.è®¾ç½®xhrå‚æ•°\n#### 3.1 è®¾ç½®request header\n1. é€šè¿‡è°ƒç”¨setRequestHeaderæ–¹æ³•,è®¾ç½®è¯·æ±‚å¤´,è¿™ä¸€æ­¥å¿…é¡»åœ¨``xhr.open``ä¹‹åè°ƒç”¨\n2. setRequestHeaderå¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›–overrideçš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ appendçš„æ–¹å¼\n```javascript\nxhr.setRequestHeader('X-Test', 'one');\nxhr.setRequestHeader('X-Test', 'two');\n// æœ€ç»ˆrequest headerä¸­\"X-Test\"ä¸º: one, two\n```\n\n#### 3.2 è®¾ç½®response type\n1. å¯ä»¥è®¾ç½®``xhr.responseType``,ä¸‹é¢æ˜¯responseTypeæ”¯æŒçš„ç±»å‹\n\n| å€¼             | xhr.response æ•°æ®ç±»å‹         |  è¯´æ˜                               |\n| ------        | -------                       |   ------                           |\n| \"\"            | String                        | é»˜è®¤å€¼(åœ¨ä¸è®¾ç½®responseTypeæ—¶)        |\n| \"text\"        | String                        |                                    |\n| \"document\"    | [Document](https://developer.mozilla.org/zh-CN/docs/Web/API/Document) å¯¹è±¡                  | å¸Œæœ›è¿”å› XML æ ¼å¼æ•°æ®æ—¶ä½¿ç”¨           |\n| \"json\"        | javascript å¯¹è±¡                | å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼ŒIE10/IE11ä¸æ”¯æŒ       |\n| \"blob\"        | [Blob](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)å¯¹è±¡                       |                                    |\n| \"arrayBuffer\" | [ArrayBuffer](https://developer.mozilla.org/zh-CN/docs/Web/API/ArrayBuffer)å¯¹è±¡                |                                    |\nå®¢æˆ·ç«¯ä»£ç \n```javascript\nvar xhr = new XMLHttpRequest();\nxhr.open('GET', '/json');\nxhr.responseType = 'json';\nxhr.onreadystatechange = function(e) {\n    if (this.readyState == 4 && this.status == 200) {\n        //é€šè¿‡xhr.responseå¯ä»¥æ‹¿åˆ°è¿”å›çš„jsonæ•°æ®\n        console.log(this.response);\n    }\n};\nxhr.send();\n```\næœåŠ¡ç«¯ä»£ç \n```javascript\nif (req.url == '/json') {\n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.write('{\"a\": 123, \"b\": \"dcs\"}');\n    res.end();\n}\n```\n\n2. é€šè¿‡è°ƒç”¨``xhr.overrideMimeType``æ–¹æ³•æ¥é‡å†™responseçš„content-type(ä¸è¿‡è¿™ä¸ªæ–¹æ³•æˆ‘è°ƒç”¨ä¹‹åå¹¶æ²¡æœ‰èµ·ä½œç”¨..)\n\n#### 3.3 è®¾ç½®è¯·æ±‚è¶…æ—¶\nå¯ä»¥è®¾ç½®``xhr.timeout``,æ¥è®¾ç½®è¶…æ—¶æ—¶é—´(å•ä½æ¯«ç§’),åœ¨xhr.send()æ–¹æ³•è°ƒç”¨åå¼€å§‹è®¡æ—¶\n\n#### 3.4 è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ\n```javascript\nxhr.onreadystatechange = function () {\n    switch(xhr.readyState){\n        case 0://UNSENT,open()æ–¹æ³•æ²¡æœ‰è°ƒç”¨\n            break;\n        case 1://OPENED,open()æ–¹æ³•å·²è¢«æˆåŠŸè°ƒç”¨,send()æ–¹æ³•è¿˜æœªè¢«è°ƒç”¨ã€‚\n            break;\n        case 2://HEADERS_RECEIVED,send()æ–¹æ³•å·²ç»è¢«è°ƒç”¨, å“åº”å¤´å’Œå“åº”çŠ¶æ€å·²ç»è¿”å›\n            break;\n        case 3://LOADING,å“åº”ä½“ä¸‹è½½ä¸­,responseTextä¸­å·²ç»è·å–äº†éƒ¨åˆ†æ•°æ®.\n            break;\n        case 4://DONE,æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹å·²ç»å®Œæ¯•.\n            break;\n    }\n}\n```\n#### 3.5 xhrçš„äº‹ä»¶\n| äº‹ä»¶                | è§¦å‘æ¡ä»¶                          |\n| -----              | -------                          |\n| onreadystatechange |\tæ¯å½“xhr.readyStateæ”¹å˜æ—¶è§¦å‘ï¼›ä½†xhr.readyStateç”±é0å€¼å˜ä¸º0æ—¶ä¸è§¦å‘ã€‚ |\n| onloadstart\t     |  è°ƒç”¨xhr.send()æ–¹æ³•åç«‹å³è§¦å‘ï¼Œè‹¥xhr.send()æœªè¢«è°ƒç”¨åˆ™ä¸ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚   |\n| onprogress         |\txhr.upload.onprogressåœ¨ä¸Šä¼ é˜¶æ®µ(å³xhr.send()ä¹‹åï¼Œxhr.readystate=2ä¹‹å‰)è§¦å‘ï¼›xhr.onprogressåœ¨ä¸‹è½½é˜¶æ®µï¼ˆå³xhr.readystate=3æ—¶ï¼‰è§¦å‘  |\n| onload             |\tå½“è¯·æ±‚æˆåŠŸå®Œæˆæ—¶è§¦å‘ï¼Œæ­¤æ—¶xhr.readystate=4   |\n| onloadend\t         |  å½“è¯·æ±‚ç»“æŸï¼ˆåŒ…æ‹¬è¯·æ±‚æˆåŠŸå’Œè¯·æ±‚å¤±è´¥ï¼‰æ—¶è§¦å‘   |\n| onabort            |\tå½“è°ƒç”¨xhr.abort()åè§¦å‘   |\n| ontimeout          |\txhr.timeoutä¸ç­‰äº0ï¼Œç”±è¯·æ±‚å¼€å§‹å³onloadstartå¼€å§‹ç®—èµ·ï¼Œå½“åˆ°è¾¾xhr.timeoutæ‰€è®¾ç½®æ—¶é—´è¯·æ±‚è¿˜æœªç»“æŸå³onloadendï¼Œåˆ™è§¦å‘æ­¤äº‹ä»¶ã€‚   |\n| onerror            |\tåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œè‹¥å‘ç”ŸNetwork erroråˆ™ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼ˆè‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ è¿˜æ²¡æœ‰ç»“æŸï¼Œåˆ™ä¼šå…ˆè§¦å‘xhr.upload.onerrorï¼Œå†è§¦å‘xhr.onerrorï¼›è‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ å·²ç»ç»“æŸï¼Œåˆ™åªä¼šè§¦å‘xhr.onerrorï¼‰ã€‚**æ³¨æ„**ï¼Œåªæœ‰å‘ç”Ÿäº†ç½‘ç»œå±‚çº§åˆ«çš„å¼‚å¸¸æ‰ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼Œå¯¹äºåº”ç”¨å±‚çº§åˆ«çš„å¼‚å¸¸ï¼Œå¦‚å“åº”è¿”å›çš„xhr.statusCodeæ˜¯4xxæ—¶ï¼Œå¹¶ä¸å±äºNetwork errorï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘onerroräº‹ä»¶ï¼Œè€Œæ˜¯ä¼šè§¦å‘onloadäº‹ä»¶ã€‚    |\n\n### 4.å‘é€æ•°æ®\n```javascript\nxhr.send(data);\n```\n* å¯¹äºGET/HEADè¯·æ±‚``send``æ–¹æ³•é€šå¸¸ä¸ä¼ å‚æ•°\n* å¯¹äºPOST/DELETE/PUTè¯·æ±‚,``xhr.send(data)``çš„å‚æ•°dataå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š\n    * [ArrayBuffer](https://developer.mozilla.org/zh-CN/docs/Web/API/ArrayBuffer)\n    * [Blob](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)\n    * [Document](https://developer.mozilla.org/zh-CN/docs/Web/API/Document)\n    * DOMString\n    * [FormData](https://developer.mozilla.org/zh-CN/docs/Web/API/FormData)\n\næ¥ä¸€ä¸ªğŸŒ°\n\nå®¢æˆ·ç«¯ä»£ç \n```javascript\nvar fileInputElement = document.getElementById('file')\n\nvar oMyForm = new FormData();\n\noMyForm.append(\"username\", \"dcs\");\noMyForm.append(\"num\", 123456); // æ•°å­—123456è¢«ç«‹å³è½¬æ¢æˆå­—ç¬¦ä¸²\"123456\"\n\n// fileInputElementä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·æ‰€é€‰æ‹©çš„æ–‡ä»¶\nfor (var i = 0; i < fileInputElement.files.length; i++) {\n    oMyForm.append(\"file\", fileInputElement.files[i]);\n}\n\nvar oFileBody = '<a id=\"a\"><b id=\"b\">hey!</b></a>'; // Blobå¯¹è±¡åŒ…å«çš„æ–‡ä»¶å†…å®¹\nvar oBlob = new Blob([oFileBody], {\n    type: \"text/xml\"\n});\noMyForm.append(\"blob\", oBlob);\n\nvar xhr = new XMLHttpRequest();\nxhr.upload.onprogress = function(event) {\n    if (event.lengthComputable) {\n        var completedPercent = event.loaded / event.total;\n        console.log(completedPercent);\n    }\n}\nxhr.open(\"POST\", \"/upload\");\nxhr.send(oMyForm);\n```\næœåŠ¡ç«¯ä»£ç \n```javascript\nif (req.url == '/upload' && req.method.toLowerCase() == 'post') {\n    req.on('data', function(buffer) {\n        //ä¼šä¸æ—¶çš„è§¦å‘dataäº‹ä»¶æ¥æ¥å—å®¢æˆ·ç«¯ä¼ é€’çš„æ•°æ®\n    })\n    .on('end', function() {\n        //æ•°æ®ä¼ é€’å®Œæ¯•\n    });\n}\n```\n**æ³¨æ„**: å®¢æˆ·ç«¯çš„``xhr.upload.onprogress``è¡¨ç¤ºçš„æ˜¯ä¸Šä¼ è¿›åº¦è§¦å‘çš„å›è°ƒ(è¿›åº¦å–å†³äºå®¢æˆ·ç«¯çš„ç½‘ç»œçŠ¶å†µ),å‚æ•°``event.total``é’ˆå¯¹çš„æ˜¯æ‰€æœ‰fileçš„æ€»å¤§å°, è€ŒæœåŠ¡ç«¯çš„``req.on('data', function(){})``åªæ˜¯è¿™æ¬¡è¯·æ±‚çš„æ•°æ®æµæ¥å—ä¸€å®šé‡çš„æ•°æ®åè§¦å‘çš„å›è°ƒ,ä¸¤è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»\n\n## å‚è€ƒèµ„æ–™\n* [ä½ çœŸçš„ä¼šä½¿ç”¨XMLHttpRequestå—ï¼Ÿ](https://segmentfault.com/a/1190000004322487)\n* [MDN XMLHttpRequest](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest)\n* [XMLHttpRequest2 æ–°æŠ€å·§](https://www.html5rocks.com/zh/tutorials/file/xhr2/)","source":"_posts/å…³äºXMLHttpRequest.md","raw":"---\ntitle: å…³äºXMLHttpRequest\ndate: 2017-05-07 12:37:45\ntags: javascript\n---\n## XMLHttpRequestæ˜¯ä»€ä¹ˆ\nXMLHttpRequest æ˜¯ä¸€ä¸ª[API](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest), å®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ [AJAX](https://developer.mozilla.org/zh-CN/docs/AJAX) ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚\n\n## å…¼å®¹æ€§\n![](https://lh2907883.github.io/store/blog/%E5%85%B3%E4%BA%8EXMLHttpRequest/1.png)\n* IE8/IE9ä¹Ÿå®Œå…¨ä¸æ”¯æŒxhrå¯¹è±¡, ä¸è¿‡å¯ä»¥ä½¿ç”¨[ActiveXObject](https://msdn.microsoft.com/zh-cn/library/7sw4ddf8%28v=vs.94%29.aspx)ç±»ç”Ÿæˆxhrå®ä¾‹\n```javascript\nnew window.ActiveXObject( \"Microsoft.XMLHTTP\" )\n```\n* IE10/IE11éƒ¨åˆ†æ”¯æŒï¼Œä¸æ”¯æŒ xhr.responseTypeä¸ºjson\n\n## å¦‚ä½•ä½¿ç”¨\nä½¿ç”¨xhrç»™åå°serverå‘é€è¯·æ±‚,å¤§æ¦‚å¯ä»¥åˆ†ä¸‹é¢å‡ ä¸ªæ­¥éª¤\n### 1.å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡\n```javascript\nvar xhr = new XMLHttpRequest();\n```\n\n### 2.åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚\n```javascript\nxhr.open('POST', '/server', true);\n```\n``open(method, url [, async = true [, username = null [, password = null]]])``\n\nasync: é»˜è®¤å€¼ä¸ºtrueï¼Œå³ä¸ºå¼‚æ­¥è¯·æ±‚ï¼Œè‹¥async=falseï¼Œåˆ™ä¸ºåŒæ­¥è¯·æ±‚\n\n### 3.è®¾ç½®xhrå‚æ•°\n#### 3.1 è®¾ç½®request header\n1. é€šè¿‡è°ƒç”¨setRequestHeaderæ–¹æ³•,è®¾ç½®è¯·æ±‚å¤´,è¿™ä¸€æ­¥å¿…é¡»åœ¨``xhr.open``ä¹‹åè°ƒç”¨\n2. setRequestHeaderå¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›–overrideçš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ appendçš„æ–¹å¼\n```javascript\nxhr.setRequestHeader('X-Test', 'one');\nxhr.setRequestHeader('X-Test', 'two');\n// æœ€ç»ˆrequest headerä¸­\"X-Test\"ä¸º: one, two\n```\n\n#### 3.2 è®¾ç½®response type\n1. å¯ä»¥è®¾ç½®``xhr.responseType``,ä¸‹é¢æ˜¯responseTypeæ”¯æŒçš„ç±»å‹\n\n| å€¼             | xhr.response æ•°æ®ç±»å‹         |  è¯´æ˜                               |\n| ------        | -------                       |   ------                           |\n| \"\"            | String                        | é»˜è®¤å€¼(åœ¨ä¸è®¾ç½®responseTypeæ—¶)        |\n| \"text\"        | String                        |                                    |\n| \"document\"    | [Document](https://developer.mozilla.org/zh-CN/docs/Web/API/Document) å¯¹è±¡                  | å¸Œæœ›è¿”å› XML æ ¼å¼æ•°æ®æ—¶ä½¿ç”¨           |\n| \"json\"        | javascript å¯¹è±¡                | å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼ŒIE10/IE11ä¸æ”¯æŒ       |\n| \"blob\"        | [Blob](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)å¯¹è±¡                       |                                    |\n| \"arrayBuffer\" | [ArrayBuffer](https://developer.mozilla.org/zh-CN/docs/Web/API/ArrayBuffer)å¯¹è±¡                |                                    |\nå®¢æˆ·ç«¯ä»£ç \n```javascript\nvar xhr = new XMLHttpRequest();\nxhr.open('GET', '/json');\nxhr.responseType = 'json';\nxhr.onreadystatechange = function(e) {\n    if (this.readyState == 4 && this.status == 200) {\n        //é€šè¿‡xhr.responseå¯ä»¥æ‹¿åˆ°è¿”å›çš„jsonæ•°æ®\n        console.log(this.response);\n    }\n};\nxhr.send();\n```\næœåŠ¡ç«¯ä»£ç \n```javascript\nif (req.url == '/json') {\n    res.writeHead(200, { 'content-type': 'application/json' });\n    res.write('{\"a\": 123, \"b\": \"dcs\"}');\n    res.end();\n}\n```\n\n2. é€šè¿‡è°ƒç”¨``xhr.overrideMimeType``æ–¹æ³•æ¥é‡å†™responseçš„content-type(ä¸è¿‡è¿™ä¸ªæ–¹æ³•æˆ‘è°ƒç”¨ä¹‹åå¹¶æ²¡æœ‰èµ·ä½œç”¨..)\n\n#### 3.3 è®¾ç½®è¯·æ±‚è¶…æ—¶\nå¯ä»¥è®¾ç½®``xhr.timeout``,æ¥è®¾ç½®è¶…æ—¶æ—¶é—´(å•ä½æ¯«ç§’),åœ¨xhr.send()æ–¹æ³•è°ƒç”¨åå¼€å§‹è®¡æ—¶\n\n#### 3.4 è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ\n```javascript\nxhr.onreadystatechange = function () {\n    switch(xhr.readyState){\n        case 0://UNSENT,open()æ–¹æ³•æ²¡æœ‰è°ƒç”¨\n            break;\n        case 1://OPENED,open()æ–¹æ³•å·²è¢«æˆåŠŸè°ƒç”¨,send()æ–¹æ³•è¿˜æœªè¢«è°ƒç”¨ã€‚\n            break;\n        case 2://HEADERS_RECEIVED,send()æ–¹æ³•å·²ç»è¢«è°ƒç”¨, å“åº”å¤´å’Œå“åº”çŠ¶æ€å·²ç»è¿”å›\n            break;\n        case 3://LOADING,å“åº”ä½“ä¸‹è½½ä¸­,responseTextä¸­å·²ç»è·å–äº†éƒ¨åˆ†æ•°æ®.\n            break;\n        case 4://DONE,æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹å·²ç»å®Œæ¯•.\n            break;\n    }\n}\n```\n#### 3.5 xhrçš„äº‹ä»¶\n| äº‹ä»¶                | è§¦å‘æ¡ä»¶                          |\n| -----              | -------                          |\n| onreadystatechange |\tæ¯å½“xhr.readyStateæ”¹å˜æ—¶è§¦å‘ï¼›ä½†xhr.readyStateç”±é0å€¼å˜ä¸º0æ—¶ä¸è§¦å‘ã€‚ |\n| onloadstart\t     |  è°ƒç”¨xhr.send()æ–¹æ³•åç«‹å³è§¦å‘ï¼Œè‹¥xhr.send()æœªè¢«è°ƒç”¨åˆ™ä¸ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚   |\n| onprogress         |\txhr.upload.onprogressåœ¨ä¸Šä¼ é˜¶æ®µ(å³xhr.send()ä¹‹åï¼Œxhr.readystate=2ä¹‹å‰)è§¦å‘ï¼›xhr.onprogressåœ¨ä¸‹è½½é˜¶æ®µï¼ˆå³xhr.readystate=3æ—¶ï¼‰è§¦å‘  |\n| onload             |\tå½“è¯·æ±‚æˆåŠŸå®Œæˆæ—¶è§¦å‘ï¼Œæ­¤æ—¶xhr.readystate=4   |\n| onloadend\t         |  å½“è¯·æ±‚ç»“æŸï¼ˆåŒ…æ‹¬è¯·æ±‚æˆåŠŸå’Œè¯·æ±‚å¤±è´¥ï¼‰æ—¶è§¦å‘   |\n| onabort            |\tå½“è°ƒç”¨xhr.abort()åè§¦å‘   |\n| ontimeout          |\txhr.timeoutä¸ç­‰äº0ï¼Œç”±è¯·æ±‚å¼€å§‹å³onloadstartå¼€å§‹ç®—èµ·ï¼Œå½“åˆ°è¾¾xhr.timeoutæ‰€è®¾ç½®æ—¶é—´è¯·æ±‚è¿˜æœªç»“æŸå³onloadendï¼Œåˆ™è§¦å‘æ­¤äº‹ä»¶ã€‚   |\n| onerror            |\tåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œè‹¥å‘ç”ŸNetwork erroråˆ™ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼ˆè‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ è¿˜æ²¡æœ‰ç»“æŸï¼Œåˆ™ä¼šå…ˆè§¦å‘xhr.upload.onerrorï¼Œå†è§¦å‘xhr.onerrorï¼›è‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ å·²ç»ç»“æŸï¼Œåˆ™åªä¼šè§¦å‘xhr.onerrorï¼‰ã€‚**æ³¨æ„**ï¼Œåªæœ‰å‘ç”Ÿäº†ç½‘ç»œå±‚çº§åˆ«çš„å¼‚å¸¸æ‰ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼Œå¯¹äºåº”ç”¨å±‚çº§åˆ«çš„å¼‚å¸¸ï¼Œå¦‚å“åº”è¿”å›çš„xhr.statusCodeæ˜¯4xxæ—¶ï¼Œå¹¶ä¸å±äºNetwork errorï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘onerroräº‹ä»¶ï¼Œè€Œæ˜¯ä¼šè§¦å‘onloadäº‹ä»¶ã€‚    |\n\n### 4.å‘é€æ•°æ®\n```javascript\nxhr.send(data);\n```\n* å¯¹äºGET/HEADè¯·æ±‚``send``æ–¹æ³•é€šå¸¸ä¸ä¼ å‚æ•°\n* å¯¹äºPOST/DELETE/PUTè¯·æ±‚,``xhr.send(data)``çš„å‚æ•°dataå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š\n    * [ArrayBuffer](https://developer.mozilla.org/zh-CN/docs/Web/API/ArrayBuffer)\n    * [Blob](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)\n    * [Document](https://developer.mozilla.org/zh-CN/docs/Web/API/Document)\n    * DOMString\n    * [FormData](https://developer.mozilla.org/zh-CN/docs/Web/API/FormData)\n\næ¥ä¸€ä¸ªğŸŒ°\n\nå®¢æˆ·ç«¯ä»£ç \n```javascript\nvar fileInputElement = document.getElementById('file')\n\nvar oMyForm = new FormData();\n\noMyForm.append(\"username\", \"dcs\");\noMyForm.append(\"num\", 123456); // æ•°å­—123456è¢«ç«‹å³è½¬æ¢æˆå­—ç¬¦ä¸²\"123456\"\n\n// fileInputElementä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·æ‰€é€‰æ‹©çš„æ–‡ä»¶\nfor (var i = 0; i < fileInputElement.files.length; i++) {\n    oMyForm.append(\"file\", fileInputElement.files[i]);\n}\n\nvar oFileBody = '<a id=\"a\"><b id=\"b\">hey!</b></a>'; // Blobå¯¹è±¡åŒ…å«çš„æ–‡ä»¶å†…å®¹\nvar oBlob = new Blob([oFileBody], {\n    type: \"text/xml\"\n});\noMyForm.append(\"blob\", oBlob);\n\nvar xhr = new XMLHttpRequest();\nxhr.upload.onprogress = function(event) {\n    if (event.lengthComputable) {\n        var completedPercent = event.loaded / event.total;\n        console.log(completedPercent);\n    }\n}\nxhr.open(\"POST\", \"/upload\");\nxhr.send(oMyForm);\n```\næœåŠ¡ç«¯ä»£ç \n```javascript\nif (req.url == '/upload' && req.method.toLowerCase() == 'post') {\n    req.on('data', function(buffer) {\n        //ä¼šä¸æ—¶çš„è§¦å‘dataäº‹ä»¶æ¥æ¥å—å®¢æˆ·ç«¯ä¼ é€’çš„æ•°æ®\n    })\n    .on('end', function() {\n        //æ•°æ®ä¼ é€’å®Œæ¯•\n    });\n}\n```\n**æ³¨æ„**: å®¢æˆ·ç«¯çš„``xhr.upload.onprogress``è¡¨ç¤ºçš„æ˜¯ä¸Šä¼ è¿›åº¦è§¦å‘çš„å›è°ƒ(è¿›åº¦å–å†³äºå®¢æˆ·ç«¯çš„ç½‘ç»œçŠ¶å†µ),å‚æ•°``event.total``é’ˆå¯¹çš„æ˜¯æ‰€æœ‰fileçš„æ€»å¤§å°, è€ŒæœåŠ¡ç«¯çš„``req.on('data', function(){})``åªæ˜¯è¿™æ¬¡è¯·æ±‚çš„æ•°æ®æµæ¥å—ä¸€å®šé‡çš„æ•°æ®åè§¦å‘çš„å›è°ƒ,ä¸¤è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»\n\n## å‚è€ƒèµ„æ–™\n* [ä½ çœŸçš„ä¼šä½¿ç”¨XMLHttpRequestå—ï¼Ÿ](https://segmentfault.com/a/1190000004322487)\n* [MDN XMLHttpRequest](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest)\n* [XMLHttpRequest2 æ–°æŠ€å·§](https://www.html5rocks.com/zh/tutorials/file/xhr2/)","slug":"å…³äºXMLHttpRequest","published":1,"updated":"2017-05-07T15:34:46.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cj2n3r71e000410txnc27anrb","content":"<h2 id=\"XMLHttpRequestæ˜¯ä»€ä¹ˆ\"><a href=\"#XMLHttpRequestæ˜¯ä»€ä¹ˆ\" class=\"headerlink\" title=\"XMLHttpRequestæ˜¯ä»€ä¹ˆ\"></a>XMLHttpRequestæ˜¯ä»€ä¹ˆ</h2><p>XMLHttpRequest æ˜¯ä¸€ä¸ª<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest\" target=\"_blank\" rel=\"external\">API</a>, å®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ <a href=\"https://developer.mozilla.org/zh-CN/docs/AJAX\" target=\"_blank\" rel=\"external\">AJAX</a> ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚</p>\n<h2 id=\"å…¼å®¹æ€§\"><a href=\"#å…¼å®¹æ€§\" class=\"headerlink\" title=\"å…¼å®¹æ€§\"></a>å…¼å®¹æ€§</h2><p><img src=\"https://lh2907883.github.io/store/blog/%E5%85%B3%E4%BA%8EXMLHttpRequest/1.png\" alt=\"\"></p>\n<ul>\n<li><p>IE8/IE9ä¹Ÿå®Œå…¨ä¸æ”¯æŒxhrå¯¹è±¡, ä¸è¿‡å¯ä»¥ä½¿ç”¨<a href=\"https://msdn.microsoft.com/zh-cn/library/7sw4ddf8%28v=vs.94%29.aspx\" target=\"_blank\" rel=\"external\">ActiveXObject</a>ç±»ç”Ÿæˆxhrå®ä¾‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">window</span>.ActiveXObject( <span class=\"string\">\"Microsoft.XMLHTTP\"</span> )</div></pre></td></tr></table></figure>\n</li>\n<li><p>IE10/IE11éƒ¨åˆ†æ”¯æŒï¼Œä¸æ”¯æŒ xhr.responseTypeä¸ºjson</p>\n</li>\n</ul>\n<h2 id=\"å¦‚ä½•ä½¿ç”¨\"><a href=\"#å¦‚ä½•ä½¿ç”¨\" class=\"headerlink\" title=\"å¦‚ä½•ä½¿ç”¨\"></a>å¦‚ä½•ä½¿ç”¨</h2><p>ä½¿ç”¨xhrç»™åå°serverå‘é€è¯·æ±‚,å¤§æ¦‚å¯ä»¥åˆ†ä¸‹é¢å‡ ä¸ªæ­¥éª¤</p>\n<h3 id=\"1-å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡\"><a href=\"#1-å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡\" class=\"headerlink\" title=\"1.å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡\"></a>1.å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</div></pre></td></tr></table></figure>\n<h3 id=\"2-åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚\"><a href=\"#2-åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚\" class=\"headerlink\" title=\"2.åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚\"></a>2.åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">xhr.open(<span class=\"string\">'POST'</span>, <span class=\"string\">'/server'</span>, <span class=\"literal\">true</span>);</div></pre></td></tr></table></figure>\n<p><code>open(method, url [, async = true [, username = null [, password = null]]])</code></p>\n<p>async: é»˜è®¤å€¼ä¸ºtrueï¼Œå³ä¸ºå¼‚æ­¥è¯·æ±‚ï¼Œè‹¥async=falseï¼Œåˆ™ä¸ºåŒæ­¥è¯·æ±‚</p>\n<h3 id=\"3-è®¾ç½®xhrå‚æ•°\"><a href=\"#3-è®¾ç½®xhrå‚æ•°\" class=\"headerlink\" title=\"3.è®¾ç½®xhrå‚æ•°\"></a>3.è®¾ç½®xhrå‚æ•°</h3><h4 id=\"3-1-è®¾ç½®request-header\"><a href=\"#3-1-è®¾ç½®request-header\" class=\"headerlink\" title=\"3.1 è®¾ç½®request header\"></a>3.1 è®¾ç½®request header</h4><ol>\n<li>é€šè¿‡è°ƒç”¨setRequestHeaderæ–¹æ³•,è®¾ç½®è¯·æ±‚å¤´,è¿™ä¸€æ­¥å¿…é¡»åœ¨<code>xhr.open</code>ä¹‹åè°ƒç”¨</li>\n<li>setRequestHeaderå¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›–overrideçš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ appendçš„æ–¹å¼<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">xhr.setRequestHeader(<span class=\"string\">'X-Test'</span>, <span class=\"string\">'one'</span>);</div><div class=\"line\">xhr.setRequestHeader(<span class=\"string\">'X-Test'</span>, <span class=\"string\">'two'</span>);</div><div class=\"line\"><span class=\"comment\">// æœ€ç»ˆrequest headerä¸­\"X-Test\"ä¸º: one, two</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h4 id=\"3-2-è®¾ç½®response-type\"><a href=\"#3-2-è®¾ç½®response-type\" class=\"headerlink\" title=\"3.2 è®¾ç½®response type\"></a>3.2 è®¾ç½®response type</h4><ol>\n<li>å¯ä»¥è®¾ç½®<code>xhr.responseType</code>,ä¸‹é¢æ˜¯responseTypeæ”¯æŒçš„ç±»å‹</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>å€¼</th>\n<th>xhr.response æ•°æ®ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>â€œâ€</td>\n<td>String</td>\n<td>é»˜è®¤å€¼(åœ¨ä¸è®¾ç½®responseTypeæ—¶)</td>\n</tr>\n<tr>\n<td>â€œtextâ€</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>â€œdocumentâ€</td>\n<td><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document\" target=\"_blank\" rel=\"external\">Document</a> å¯¹è±¡</td>\n<td>å¸Œæœ›è¿”å› XML æ ¼å¼æ•°æ®æ—¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>â€œjsonâ€</td>\n<td>javascript å¯¹è±¡</td>\n<td>å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼ŒIE10/IE11ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td>â€œblobâ€</td>\n<td><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Blob\" target=\"_blank\" rel=\"external\">Blob</a>å¯¹è±¡</td>\n<td></td>\n</tr>\n<tr>\n<td>â€œarrayBufferâ€</td>\n<td><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/ArrayBuffer\" target=\"_blank\" rel=\"external\">ArrayBuffer</a>å¯¹è±¡</td>\n</tr>\n</tbody>\n</table>\n<p>å®¢æˆ·ç«¯ä»£ç <br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</div><div class=\"line\">xhr.open(<span class=\"string\">'GET'</span>, <span class=\"string\">'/json'</span>);</div><div class=\"line\">xhr.responseType = <span class=\"string\">'json'</span>;</div><div class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.readyState == <span class=\"number\">4</span> &amp;&amp; <span class=\"keyword\">this</span>.status == <span class=\"number\">200</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//é€šè¿‡xhr.responseå¯ä»¥æ‹¿åˆ°è¿”å›çš„jsonæ•°æ®</span></div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.response);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\">xhr.send();</div></pre></td></tr></table></figure></p>\n<p>æœåŠ¡ç«¯ä»£ç <br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (req.url == <span class=\"string\">'/json'</span>) &#123;</div><div class=\"line\">    res.writeHead(<span class=\"number\">200</span>, &#123; <span class=\"string\">'content-type'</span>: <span class=\"string\">'application/json'</span> &#125;);</div><div class=\"line\">    res.write(<span class=\"string\">'&#123;\"a\": 123, \"b\": \"dcs\"&#125;'</span>);</div><div class=\"line\">    res.end();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<ol>\n<li>é€šè¿‡è°ƒç”¨<code>xhr.overrideMimeType</code>æ–¹æ³•æ¥é‡å†™responseçš„content-type(ä¸è¿‡è¿™ä¸ªæ–¹æ³•æˆ‘è°ƒç”¨ä¹‹åå¹¶æ²¡æœ‰èµ·ä½œç”¨..)</li>\n</ol>\n<h4 id=\"3-3-è®¾ç½®è¯·æ±‚è¶…æ—¶\"><a href=\"#3-3-è®¾ç½®è¯·æ±‚è¶…æ—¶\" class=\"headerlink\" title=\"3.3 è®¾ç½®è¯·æ±‚è¶…æ—¶\"></a>3.3 è®¾ç½®è¯·æ±‚è¶…æ—¶</h4><p>å¯ä»¥è®¾ç½®<code>xhr.timeout</code>,æ¥è®¾ç½®è¶…æ—¶æ—¶é—´(å•ä½æ¯«ç§’),åœ¨xhr.send()æ–¹æ³•è°ƒç”¨åå¼€å§‹è®¡æ—¶</p>\n<h4 id=\"3-4-è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ\"><a href=\"#3-4-è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ\" class=\"headerlink\" title=\"3.4 è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ\"></a>3.4 è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">switch</span>(xhr.readyState)&#123;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>:<span class=\"comment\">//UNSENT,open()æ–¹æ³•æ²¡æœ‰è°ƒç”¨</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">//OPENED,open()æ–¹æ³•å·²è¢«æˆåŠŸè°ƒç”¨,send()æ–¹æ³•è¿˜æœªè¢«è°ƒç”¨ã€‚</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">//HEADERS_RECEIVED,send()æ–¹æ³•å·²ç»è¢«è°ƒç”¨, å“åº”å¤´å’Œå“åº”çŠ¶æ€å·²ç»è¿”å›</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">//LOADING,å“åº”ä½“ä¸‹è½½ä¸­,responseTextä¸­å·²ç»è·å–äº†éƒ¨åˆ†æ•°æ®.</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">//DONE,æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹å·²ç»å®Œæ¯•.</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"3-5-xhrçš„äº‹ä»¶\"><a href=\"#3-5-xhrçš„äº‹ä»¶\" class=\"headerlink\" title=\"3.5 xhrçš„äº‹ä»¶\"></a>3.5 xhrçš„äº‹ä»¶</h4><table>\n<thead>\n<tr>\n<th>äº‹ä»¶</th>\n<th>è§¦å‘æ¡ä»¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>onreadystatechange</td>\n<td>æ¯å½“xhr.readyStateæ”¹å˜æ—¶è§¦å‘ï¼›ä½†xhr.readyStateç”±é0å€¼å˜ä¸º0æ—¶ä¸è§¦å‘ã€‚</td>\n</tr>\n<tr>\n<td>onloadstart</td>\n<td>è°ƒç”¨xhr.send()æ–¹æ³•åç«‹å³è§¦å‘ï¼Œè‹¥xhr.send()æœªè¢«è°ƒç”¨åˆ™ä¸ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚</td>\n</tr>\n<tr>\n<td>onprogress</td>\n<td>xhr.upload.onprogressåœ¨ä¸Šä¼ é˜¶æ®µ(å³xhr.send()ä¹‹åï¼Œxhr.readystate=2ä¹‹å‰)è§¦å‘ï¼›xhr.onprogressåœ¨ä¸‹è½½é˜¶æ®µï¼ˆå³xhr.readystate=3æ—¶ï¼‰è§¦å‘</td>\n</tr>\n<tr>\n<td>onload</td>\n<td>å½“è¯·æ±‚æˆåŠŸå®Œæˆæ—¶è§¦å‘ï¼Œæ­¤æ—¶xhr.readystate=4</td>\n</tr>\n<tr>\n<td>onloadend</td>\n<td>å½“è¯·æ±‚ç»“æŸï¼ˆåŒ…æ‹¬è¯·æ±‚æˆåŠŸå’Œè¯·æ±‚å¤±è´¥ï¼‰æ—¶è§¦å‘</td>\n</tr>\n<tr>\n<td>onabort</td>\n<td>å½“è°ƒç”¨xhr.abort()åè§¦å‘</td>\n</tr>\n<tr>\n<td>ontimeout</td>\n<td>xhr.timeoutä¸ç­‰äº0ï¼Œç”±è¯·æ±‚å¼€å§‹å³onloadstartå¼€å§‹ç®—èµ·ï¼Œå½“åˆ°è¾¾xhr.timeoutæ‰€è®¾ç½®æ—¶é—´è¯·æ±‚è¿˜æœªç»“æŸå³onloadendï¼Œåˆ™è§¦å‘æ­¤äº‹ä»¶ã€‚</td>\n</tr>\n<tr>\n<td>onerror</td>\n<td>åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œè‹¥å‘ç”ŸNetwork erroråˆ™ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼ˆè‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ è¿˜æ²¡æœ‰ç»“æŸï¼Œåˆ™ä¼šå…ˆè§¦å‘xhr.upload.onerrorï¼Œå†è§¦å‘xhr.onerrorï¼›è‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ å·²ç»ç»“æŸï¼Œåˆ™åªä¼šè§¦å‘xhr.onerrorï¼‰ã€‚<strong>æ³¨æ„</strong>ï¼Œåªæœ‰å‘ç”Ÿäº†ç½‘ç»œå±‚çº§åˆ«çš„å¼‚å¸¸æ‰ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼Œå¯¹äºåº”ç”¨å±‚çº§åˆ«çš„å¼‚å¸¸ï¼Œå¦‚å“åº”è¿”å›çš„xhr.statusCodeæ˜¯4xxæ—¶ï¼Œå¹¶ä¸å±äºNetwork errorï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘onerroräº‹ä»¶ï¼Œè€Œæ˜¯ä¼šè§¦å‘onloadäº‹ä»¶ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"4-å‘é€æ•°æ®\"><a href=\"#4-å‘é€æ•°æ®\" class=\"headerlink\" title=\"4.å‘é€æ•°æ®\"></a>4.å‘é€æ•°æ®</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">xhr.send(data);</div></pre></td></tr></table></figure>\n<ul>\n<li>å¯¹äºGET/HEADè¯·æ±‚<code>send</code>æ–¹æ³•é€šå¸¸ä¸ä¼ å‚æ•°</li>\n<li>å¯¹äºPOST/DELETE/PUTè¯·æ±‚,<code>xhr.send(data)</code>çš„å‚æ•°dataå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š<ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/ArrayBuffer\" target=\"_blank\" rel=\"external\">ArrayBuffer</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Blob\" target=\"_blank\" rel=\"external\">Blob</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document\" target=\"_blank\" rel=\"external\">Document</a></li>\n<li>DOMString</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData\" target=\"_blank\" rel=\"external\">FormData</a></li>\n</ul>\n</li>\n</ul>\n<p>æ¥ä¸€ä¸ªğŸŒ°</p>\n<p>å®¢æˆ·ç«¯ä»£ç <br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fileInputElement = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'file'</span>)</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> oMyForm = <span class=\"keyword\">new</span> FormData();</div><div class=\"line\"></div><div class=\"line\">oMyForm.append(<span class=\"string\">\"username\"</span>, <span class=\"string\">\"dcs\"</span>);</div><div class=\"line\">oMyForm.append(<span class=\"string\">\"num\"</span>, <span class=\"number\">123456</span>); <span class=\"comment\">// æ•°å­—123456è¢«ç«‹å³è½¬æ¢æˆå­—ç¬¦ä¸²\"123456\"</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// fileInputElementä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·æ‰€é€‰æ‹©çš„æ–‡ä»¶</span></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; fileInputElement.files.length; i++) &#123;</div><div class=\"line\">    oMyForm.append(<span class=\"string\">\"file\"</span>, fileInputElement.files[i]);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> oFileBody = <span class=\"string\">'&lt;a id=\"a\"&gt;&lt;b id=\"b\"&gt;hey!&lt;/b&gt;&lt;/a&gt;'</span>; <span class=\"comment\">// Blobå¯¹è±¡åŒ…å«çš„æ–‡ä»¶å†…å®¹</span></div><div class=\"line\"><span class=\"keyword\">var</span> oBlob = <span class=\"keyword\">new</span> Blob([oFileBody], &#123;</div><div class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">\"text/xml\"</span></div><div class=\"line\">&#125;);</div><div class=\"line\">oMyForm.append(<span class=\"string\">\"blob\"</span>, oBlob);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</div><div class=\"line\">xhr.upload.onprogress = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (event.lengthComputable) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> completedPercent = event.loaded / event.total;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(completedPercent);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">xhr.open(<span class=\"string\">\"POST\"</span>, <span class=\"string\">\"/upload\"</span>);</div><div class=\"line\">xhr.send(oMyForm);</div></pre></td></tr></table></figure></p>\n<p>æœåŠ¡ç«¯ä»£ç <br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (req.url == <span class=\"string\">'/upload'</span> &amp;&amp; req.method.toLowerCase() == <span class=\"string\">'post'</span>) &#123;</div><div class=\"line\">    req.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">buffer</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//ä¼šä¸æ—¶çš„è§¦å‘dataäº‹ä»¶æ¥æ¥å—å®¢æˆ·ç«¯ä¼ é€’çš„æ•°æ®</span></div><div class=\"line\">    &#125;)</div><div class=\"line\">    .on(<span class=\"string\">'end'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//æ•°æ®ä¼ é€’å®Œæ¯•</span></div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><strong>æ³¨æ„</strong>: å®¢æˆ·ç«¯çš„<code>xhr.upload.onprogress</code>è¡¨ç¤ºçš„æ˜¯ä¸Šä¼ è¿›åº¦è§¦å‘çš„å›è°ƒ(è¿›åº¦å–å†³äºå®¢æˆ·ç«¯çš„ç½‘ç»œçŠ¶å†µ),å‚æ•°<code>event.total</code>é’ˆå¯¹çš„æ˜¯æ‰€æœ‰fileçš„æ€»å¤§å°, è€ŒæœåŠ¡ç«¯çš„<code>req.on(&#39;data&#39;, function(){})</code>åªæ˜¯è¿™æ¬¡è¯·æ±‚çš„æ•°æ®æµæ¥å—ä¸€å®šé‡çš„æ•°æ®åè§¦å‘çš„å›è°ƒ,ä¸¤è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ul>\n<li><a href=\"https://segmentfault.com/a/1190000004322487\" target=\"_blank\" rel=\"external\">ä½ çœŸçš„ä¼šä½¿ç”¨XMLHttpRequestå—ï¼Ÿ</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest\" target=\"_blank\" rel=\"external\">MDN XMLHttpRequest</a></li>\n<li><a href=\"https://www.html5rocks.com/zh/tutorials/file/xhr2/\" target=\"_blank\" rel=\"external\">XMLHttpRequest2 æ–°æŠ€å·§</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"XMLHttpRequestæ˜¯ä»€ä¹ˆ\"><a href=\"#XMLHttpRequestæ˜¯ä»€ä¹ˆ\" class=\"headerlink\" title=\"XMLHttpRequestæ˜¯ä»€ä¹ˆ\"></a>XMLHttpRequestæ˜¯ä»€ä¹ˆ</h2><p>XMLHttpRequest æ˜¯ä¸€ä¸ª<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest\" target=\"_blank\" rel=\"external\">API</a>, å®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ <a href=\"https://developer.mozilla.org/zh-CN/docs/AJAX\" target=\"_blank\" rel=\"external\">AJAX</a> ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚</p>\n<h2 id=\"å…¼å®¹æ€§\"><a href=\"#å…¼å®¹æ€§\" class=\"headerlink\" title=\"å…¼å®¹æ€§\"></a>å…¼å®¹æ€§</h2><p><img src=\"https://lh2907883.github.io/store/blog/%E5%85%B3%E4%BA%8EXMLHttpRequest/1.png\" alt=\"\"></p>\n<ul>\n<li><p>IE8/IE9ä¹Ÿå®Œå…¨ä¸æ”¯æŒxhrå¯¹è±¡, ä¸è¿‡å¯ä»¥ä½¿ç”¨<a href=\"https://msdn.microsoft.com/zh-cn/library/7sw4ddf8%28v=vs.94%29.aspx\" target=\"_blank\" rel=\"external\">ActiveXObject</a>ç±»ç”Ÿæˆxhrå®ä¾‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">window</span>.ActiveXObject( <span class=\"string\">\"Microsoft.XMLHTTP\"</span> )</div></pre></td></tr></table></figure>\n</li>\n<li><p>IE10/IE11éƒ¨åˆ†æ”¯æŒï¼Œä¸æ”¯æŒ xhr.responseTypeä¸ºjson</p>\n</li>\n</ul>\n<h2 id=\"å¦‚ä½•ä½¿ç”¨\"><a href=\"#å¦‚ä½•ä½¿ç”¨\" class=\"headerlink\" title=\"å¦‚ä½•ä½¿ç”¨\"></a>å¦‚ä½•ä½¿ç”¨</h2><p>ä½¿ç”¨xhrç»™åå°serverå‘é€è¯·æ±‚,å¤§æ¦‚å¯ä»¥åˆ†ä¸‹é¢å‡ ä¸ªæ­¥éª¤</p>\n<h3 id=\"1-å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡\"><a href=\"#1-å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡\" class=\"headerlink\" title=\"1.å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡\"></a>1.å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</div></pre></td></tr></table></figure>\n<h3 id=\"2-åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚\"><a href=\"#2-åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚\" class=\"headerlink\" title=\"2.åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚\"></a>2.åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">xhr.open(<span class=\"string\">'POST'</span>, <span class=\"string\">'/server'</span>, <span class=\"literal\">true</span>);</div></pre></td></tr></table></figure>\n<p><code>open(method, url [, async = true [, username = null [, password = null]]])</code></p>\n<p>async: é»˜è®¤å€¼ä¸ºtrueï¼Œå³ä¸ºå¼‚æ­¥è¯·æ±‚ï¼Œè‹¥async=falseï¼Œåˆ™ä¸ºåŒæ­¥è¯·æ±‚</p>\n<h3 id=\"3-è®¾ç½®xhrå‚æ•°\"><a href=\"#3-è®¾ç½®xhrå‚æ•°\" class=\"headerlink\" title=\"3.è®¾ç½®xhrå‚æ•°\"></a>3.è®¾ç½®xhrå‚æ•°</h3><h4 id=\"3-1-è®¾ç½®request-header\"><a href=\"#3-1-è®¾ç½®request-header\" class=\"headerlink\" title=\"3.1 è®¾ç½®request header\"></a>3.1 è®¾ç½®request header</h4><ol>\n<li>é€šè¿‡è°ƒç”¨setRequestHeaderæ–¹æ³•,è®¾ç½®è¯·æ±‚å¤´,è¿™ä¸€æ­¥å¿…é¡»åœ¨<code>xhr.open</code>ä¹‹åè°ƒç”¨</li>\n<li>setRequestHeaderå¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›–overrideçš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ appendçš„æ–¹å¼<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">xhr.setRequestHeader(<span class=\"string\">'X-Test'</span>, <span class=\"string\">'one'</span>);</div><div class=\"line\">xhr.setRequestHeader(<span class=\"string\">'X-Test'</span>, <span class=\"string\">'two'</span>);</div><div class=\"line\"><span class=\"comment\">// æœ€ç»ˆrequest headerä¸­\"X-Test\"ä¸º: one, two</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h4 id=\"3-2-è®¾ç½®response-type\"><a href=\"#3-2-è®¾ç½®response-type\" class=\"headerlink\" title=\"3.2 è®¾ç½®response type\"></a>3.2 è®¾ç½®response type</h4><ol>\n<li>å¯ä»¥è®¾ç½®<code>xhr.responseType</code>,ä¸‹é¢æ˜¯responseTypeæ”¯æŒçš„ç±»å‹</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>å€¼</th>\n<th>xhr.response æ•°æ®ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>â€œâ€</td>\n<td>String</td>\n<td>é»˜è®¤å€¼(åœ¨ä¸è®¾ç½®responseTypeæ—¶)</td>\n</tr>\n<tr>\n<td>â€œtextâ€</td>\n<td>String</td>\n<td></td>\n</tr>\n<tr>\n<td>â€œdocumentâ€</td>\n<td><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document\" target=\"_blank\" rel=\"external\">Document</a> å¯¹è±¡</td>\n<td>å¸Œæœ›è¿”å› XML æ ¼å¼æ•°æ®æ—¶ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>â€œjsonâ€</td>\n<td>javascript å¯¹è±¡</td>\n<td>å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼ŒIE10/IE11ä¸æ”¯æŒ</td>\n</tr>\n<tr>\n<td>â€œblobâ€</td>\n<td><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Blob\" target=\"_blank\" rel=\"external\">Blob</a>å¯¹è±¡</td>\n<td></td>\n</tr>\n<tr>\n<td>â€œarrayBufferâ€</td>\n<td><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/ArrayBuffer\" target=\"_blank\" rel=\"external\">ArrayBuffer</a>å¯¹è±¡</td>\n</tr>\n</tbody>\n</table>\n<p>å®¢æˆ·ç«¯ä»£ç <br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</div><div class=\"line\">xhr.open(<span class=\"string\">'GET'</span>, <span class=\"string\">'/json'</span>);</div><div class=\"line\">xhr.responseType = <span class=\"string\">'json'</span>;</div><div class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.readyState == <span class=\"number\">4</span> &amp;&amp; <span class=\"keyword\">this</span>.status == <span class=\"number\">200</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//é€šè¿‡xhr.responseå¯ä»¥æ‹¿åˆ°è¿”å›çš„jsonæ•°æ®</span></div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.response);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\">xhr.send();</div></pre></td></tr></table></figure></p>\n<p>æœåŠ¡ç«¯ä»£ç <br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (req.url == <span class=\"string\">'/json'</span>) &#123;</div><div class=\"line\">    res.writeHead(<span class=\"number\">200</span>, &#123; <span class=\"string\">'content-type'</span>: <span class=\"string\">'application/json'</span> &#125;);</div><div class=\"line\">    res.write(<span class=\"string\">'&#123;\"a\": 123, \"b\": \"dcs\"&#125;'</span>);</div><div class=\"line\">    res.end();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<ol>\n<li>é€šè¿‡è°ƒç”¨<code>xhr.overrideMimeType</code>æ–¹æ³•æ¥é‡å†™responseçš„content-type(ä¸è¿‡è¿™ä¸ªæ–¹æ³•æˆ‘è°ƒç”¨ä¹‹åå¹¶æ²¡æœ‰èµ·ä½œç”¨..)</li>\n</ol>\n<h4 id=\"3-3-è®¾ç½®è¯·æ±‚è¶…æ—¶\"><a href=\"#3-3-è®¾ç½®è¯·æ±‚è¶…æ—¶\" class=\"headerlink\" title=\"3.3 è®¾ç½®è¯·æ±‚è¶…æ—¶\"></a>3.3 è®¾ç½®è¯·æ±‚è¶…æ—¶</h4><p>å¯ä»¥è®¾ç½®<code>xhr.timeout</code>,æ¥è®¾ç½®è¶…æ—¶æ—¶é—´(å•ä½æ¯«ç§’),åœ¨xhr.send()æ–¹æ³•è°ƒç”¨åå¼€å§‹è®¡æ—¶</p>\n<h4 id=\"3-4-è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ\"><a href=\"#3-4-è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ\" class=\"headerlink\" title=\"3.4 è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ\"></a>3.4 è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\">xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">switch</span>(xhr.readyState)&#123;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>:<span class=\"comment\">//UNSENT,open()æ–¹æ³•æ²¡æœ‰è°ƒç”¨</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>:<span class=\"comment\">//OPENED,open()æ–¹æ³•å·²è¢«æˆåŠŸè°ƒç”¨,send()æ–¹æ³•è¿˜æœªè¢«è°ƒç”¨ã€‚</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>:<span class=\"comment\">//HEADERS_RECEIVED,send()æ–¹æ³•å·²ç»è¢«è°ƒç”¨, å“åº”å¤´å’Œå“åº”çŠ¶æ€å·²ç»è¿”å›</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>:<span class=\"comment\">//LOADING,å“åº”ä½“ä¸‹è½½ä¸­,responseTextä¸­å·²ç»è·å–äº†éƒ¨åˆ†æ•°æ®.</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">4</span>:<span class=\"comment\">//DONE,æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹å·²ç»å®Œæ¯•.</span></div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"3-5-xhrçš„äº‹ä»¶\"><a href=\"#3-5-xhrçš„äº‹ä»¶\" class=\"headerlink\" title=\"3.5 xhrçš„äº‹ä»¶\"></a>3.5 xhrçš„äº‹ä»¶</h4><table>\n<thead>\n<tr>\n<th>äº‹ä»¶</th>\n<th>è§¦å‘æ¡ä»¶</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>onreadystatechange</td>\n<td>æ¯å½“xhr.readyStateæ”¹å˜æ—¶è§¦å‘ï¼›ä½†xhr.readyStateç”±é0å€¼å˜ä¸º0æ—¶ä¸è§¦å‘ã€‚</td>\n</tr>\n<tr>\n<td>onloadstart</td>\n<td>è°ƒç”¨xhr.send()æ–¹æ³•åç«‹å³è§¦å‘ï¼Œè‹¥xhr.send()æœªè¢«è°ƒç”¨åˆ™ä¸ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚</td>\n</tr>\n<tr>\n<td>onprogress</td>\n<td>xhr.upload.onprogressåœ¨ä¸Šä¼ é˜¶æ®µ(å³xhr.send()ä¹‹åï¼Œxhr.readystate=2ä¹‹å‰)è§¦å‘ï¼›xhr.onprogressåœ¨ä¸‹è½½é˜¶æ®µï¼ˆå³xhr.readystate=3æ—¶ï¼‰è§¦å‘</td>\n</tr>\n<tr>\n<td>onload</td>\n<td>å½“è¯·æ±‚æˆåŠŸå®Œæˆæ—¶è§¦å‘ï¼Œæ­¤æ—¶xhr.readystate=4</td>\n</tr>\n<tr>\n<td>onloadend</td>\n<td>å½“è¯·æ±‚ç»“æŸï¼ˆåŒ…æ‹¬è¯·æ±‚æˆåŠŸå’Œè¯·æ±‚å¤±è´¥ï¼‰æ—¶è§¦å‘</td>\n</tr>\n<tr>\n<td>onabort</td>\n<td>å½“è°ƒç”¨xhr.abort()åè§¦å‘</td>\n</tr>\n<tr>\n<td>ontimeout</td>\n<td>xhr.timeoutä¸ç­‰äº0ï¼Œç”±è¯·æ±‚å¼€å§‹å³onloadstartå¼€å§‹ç®—èµ·ï¼Œå½“åˆ°è¾¾xhr.timeoutæ‰€è®¾ç½®æ—¶é—´è¯·æ±‚è¿˜æœªç»“æŸå³onloadendï¼Œåˆ™è§¦å‘æ­¤äº‹ä»¶ã€‚</td>\n</tr>\n<tr>\n<td>onerror</td>\n<td>åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œè‹¥å‘ç”ŸNetwork erroråˆ™ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼ˆè‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ è¿˜æ²¡æœ‰ç»“æŸï¼Œåˆ™ä¼šå…ˆè§¦å‘xhr.upload.onerrorï¼Œå†è§¦å‘xhr.onerrorï¼›è‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ å·²ç»ç»“æŸï¼Œåˆ™åªä¼šè§¦å‘xhr.onerrorï¼‰ã€‚<strong>æ³¨æ„</strong>ï¼Œåªæœ‰å‘ç”Ÿäº†ç½‘ç»œå±‚çº§åˆ«çš„å¼‚å¸¸æ‰ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼Œå¯¹äºåº”ç”¨å±‚çº§åˆ«çš„å¼‚å¸¸ï¼Œå¦‚å“åº”è¿”å›çš„xhr.statusCodeæ˜¯4xxæ—¶ï¼Œå¹¶ä¸å±äºNetwork errorï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘onerroräº‹ä»¶ï¼Œè€Œæ˜¯ä¼šè§¦å‘onloadäº‹ä»¶ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"4-å‘é€æ•°æ®\"><a href=\"#4-å‘é€æ•°æ®\" class=\"headerlink\" title=\"4.å‘é€æ•°æ®\"></a>4.å‘é€æ•°æ®</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">xhr.send(data);</div></pre></td></tr></table></figure>\n<ul>\n<li>å¯¹äºGET/HEADè¯·æ±‚<code>send</code>æ–¹æ³•é€šå¸¸ä¸ä¼ å‚æ•°</li>\n<li>å¯¹äºPOST/DELETE/PUTè¯·æ±‚,<code>xhr.send(data)</code>çš„å‚æ•°dataå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š<ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/ArrayBuffer\" target=\"_blank\" rel=\"external\">ArrayBuffer</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Blob\" target=\"_blank\" rel=\"external\">Blob</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document\" target=\"_blank\" rel=\"external\">Document</a></li>\n<li>DOMString</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/FormData\" target=\"_blank\" rel=\"external\">FormData</a></li>\n</ul>\n</li>\n</ul>\n<p>æ¥ä¸€ä¸ªğŸŒ°</p>\n<p>å®¢æˆ·ç«¯ä»£ç <br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> fileInputElement = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'file'</span>)</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> oMyForm = <span class=\"keyword\">new</span> FormData();</div><div class=\"line\"></div><div class=\"line\">oMyForm.append(<span class=\"string\">\"username\"</span>, <span class=\"string\">\"dcs\"</span>);</div><div class=\"line\">oMyForm.append(<span class=\"string\">\"num\"</span>, <span class=\"number\">123456</span>); <span class=\"comment\">// æ•°å­—123456è¢«ç«‹å³è½¬æ¢æˆå­—ç¬¦ä¸²\"123456\"</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// fileInputElementä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·æ‰€é€‰æ‹©çš„æ–‡ä»¶</span></div><div class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; fileInputElement.files.length; i++) &#123;</div><div class=\"line\">    oMyForm.append(<span class=\"string\">\"file\"</span>, fileInputElement.files[i]);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> oFileBody = <span class=\"string\">'&lt;a id=\"a\"&gt;&lt;b id=\"b\"&gt;hey!&lt;/b&gt;&lt;/a&gt;'</span>; <span class=\"comment\">// Blobå¯¹è±¡åŒ…å«çš„æ–‡ä»¶å†…å®¹</span></div><div class=\"line\"><span class=\"keyword\">var</span> oBlob = <span class=\"keyword\">new</span> Blob([oFileBody], &#123;</div><div class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">\"text/xml\"</span></div><div class=\"line\">&#125;);</div><div class=\"line\">oMyForm.append(<span class=\"string\">\"blob\"</span>, oBlob);</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</div><div class=\"line\">xhr.upload.onprogress = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (event.lengthComputable) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> completedPercent = event.loaded / event.total;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(completedPercent);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\">xhr.open(<span class=\"string\">\"POST\"</span>, <span class=\"string\">\"/upload\"</span>);</div><div class=\"line\">xhr.send(oMyForm);</div></pre></td></tr></table></figure></p>\n<p>æœåŠ¡ç«¯ä»£ç <br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">if</span> (req.url == <span class=\"string\">'/upload'</span> &amp;&amp; req.method.toLowerCase() == <span class=\"string\">'post'</span>) &#123;</div><div class=\"line\">    req.on(<span class=\"string\">'data'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">buffer</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//ä¼šä¸æ—¶çš„è§¦å‘dataäº‹ä»¶æ¥æ¥å—å®¢æˆ·ç«¯ä¼ é€’çš„æ•°æ®</span></div><div class=\"line\">    &#125;)</div><div class=\"line\">    .on(<span class=\"string\">'end'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//æ•°æ®ä¼ é€’å®Œæ¯•</span></div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><strong>æ³¨æ„</strong>: å®¢æˆ·ç«¯çš„<code>xhr.upload.onprogress</code>è¡¨ç¤ºçš„æ˜¯ä¸Šä¼ è¿›åº¦è§¦å‘çš„å›è°ƒ(è¿›åº¦å–å†³äºå®¢æˆ·ç«¯çš„ç½‘ç»œçŠ¶å†µ),å‚æ•°<code>event.total</code>é’ˆå¯¹çš„æ˜¯æ‰€æœ‰fileçš„æ€»å¤§å°, è€ŒæœåŠ¡ç«¯çš„<code>req.on(&#39;data&#39;, function(){})</code>åªæ˜¯è¿™æ¬¡è¯·æ±‚çš„æ•°æ®æµæ¥å—ä¸€å®šé‡çš„æ•°æ®åè§¦å‘çš„å›è°ƒ,ä¸¤è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ul>\n<li><a href=\"https://segmentfault.com/a/1190000004322487\" target=\"_blank\" rel=\"external\">ä½ çœŸçš„ä¼šä½¿ç”¨XMLHttpRequestå—ï¼Ÿ</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest\" target=\"_blank\" rel=\"external\">MDN XMLHttpRequest</a></li>\n<li><a href=\"https://www.html5rocks.com/zh/tutorials/file/xhr2/\" target=\"_blank\" rel=\"external\">XMLHttpRequest2 æ–°æŠ€å·§</a></li>\n</ul>\n"},{"title":"webç¦»çº¿åº”ç”¨","date":"2017-05-14T07:57:53.000Z","_content":"\n## ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨\nåœ¨æ­£å¸¸æƒ…å†µä¸‹,å®¢æˆ·ç«¯ä½¿ç”¨HTTPåè®®é€šè¿‡ç½‘ç»œå¾—åˆ°æœåŠ¡å™¨çš„èµ„æº,ç„¶åå±•ç¤º,ä½†æ˜¯å¦‚æœåœ¨ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹,å®¢æˆ·ç«¯å°±æ²¡åŠæ³•äº†,è¿™æ—¶å°±éœ€è¦ä¸€ç§æŠ€æœ¯å»è§£å†³è¿™ä¸€é—®é¢˜,ç›®å‰æœ‰ä¸¤ç§æ–¹å¼:[AppCache](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache)å’Œ[Service Workers](https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers#Browser_compatibility),ä»–ä»¬éƒ½æ˜¯é€šè¿‡åœ¨æ–­ç½‘æ—¶è¯»å–æœ¬åœ°ç¼“å­˜èµ„æºæ¥å®ç°webåº”ç”¨çš„ç¦»çº¿è®¿é—®çš„.\n\n## æ¯”è¾ƒAppCacheå’ŒService Workers\n### ä½¿ç”¨æ–¹å¼\nAppCacheé€šè¿‡æŒ‡å®šç¼“å­˜æ¸…å•æ–‡ä»¶æ¥è®¾ç½®å“ªäº›èµ„æºéœ€è¦è¢«ç¼“å­˜\n\nService Workersåˆ™æœ‰æ›´æ–°å¼ºå¤§çš„APIæ¥é€šè¿‡è„šæœ¬ç²¾å‡†æ§åˆ¶ç¼“å­˜(åŒ…æ‹¬æ›´æ–°,è¿½åŠ ,åˆ é™¤ç¼“å­˜)\n\n### å…¼å®¹æ€§\nä¸‹å›¾æ˜¯å„å¤§æµè§ˆå™¨å¯¹AppCacheçš„æ”¯æŒæƒ…å†µ,å¯ä»¥çœ‹å‡ºåŸºæœ¬éƒ½æ”¯æŒ\n![](https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/1.png)\n\nè€ŒService Workersè¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒçš„(ç‰¹åˆ«æ˜¯ç§»åŠ¨å¹³å°)\n![](https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/2.png)\n\n### W3Cæ ‡å‡†\nå¦‚æœä½ çœ‹è¿‡[AppCache](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache)çš„æ–‡æ¡£,ä½ ä¼šå‘ç°\n> è¯¥ç‰¹æ€§å·²ç»ä»Webæ ‡å‡†ä¸­åˆ é™¤ï¼Œè™½ç„¶ä¸€äº›æµè§ˆå™¨ç›®å‰ä»ç„¶æ”¯æŒå®ƒï¼Œä½†ä¹Ÿè®¸ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´åœæ­¢æ”¯æŒï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚\n\n> åœ¨æ­¤åˆ»ä½¿ç”¨è¿™é‡Œæè¿°çš„åº”ç”¨ç¨‹åºç¼“å­˜åŠŸèƒ½é«˜åº¦ä¸é¼“åŠ±; å®ƒæ­£åœ¨å¤„äºä»Webå¹³å°ä¸­è¢«åˆ é™¤çš„è¿‡ç¨‹ã€‚è¯·æ”¹ç”¨[Service Workers](https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers#Browser_compatibility)ä»£æ›¿ã€‚\n\næˆ‘ä¸ªäººè®¤ä¸ºService Workerså„æ–¹é¢éƒ½è¦ä¼˜äºAppCache,é™¤äº†å…¼å®¹æ€§,ä¸è¿‡æ—¢ç„¶Service Workerså·²ç»æ˜¯W3Cæ ‡å‡†,æƒ³å¿…æœªæ¥çš„æ”¯æŒæƒ…å†µåº”è¯¥ä¼šå¥½ä¸€äº›,æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºService Workersçš„ç”¨æ³•\n\n## ä½¿ç”¨Service Workersçš„å‰ææ¡ä»¶\n> åœ¨å·²ç»æ”¯æŒ serivce workers çš„æµè§ˆå™¨çš„ç‰ˆæœ¬ä¸­, å¾ˆå¤šç‰¹æ€§æ²¡æœ‰é»˜è®¤å¼€å¯, éœ€è¦å¼€å¯ä¸€ä¸‹æµè§ˆå™¨çš„ç›¸å…³é…ç½®ï¼š\n> * Firefox Nightly: è®¿é—® about:config å¹¶è®¾ç½® dom.serviceWorkers.enabled çš„å€¼ä¸º true; é‡å¯æµè§ˆå™¨ï¼›\n> * Chrome Canary: è®¿é—® chrome://flags å¹¶å¼€å¯ experimental-web-platform-features; é‡å¯æµè§ˆå™¨ (æ³¨æ„ï¼šæœ‰äº›ç‰¹æ€§åœ¨Chromeä¸­æ²¡æœ‰é»˜è®¤å¼€æ”¾æ”¯æŒ)ï¼›\n> * Opera: è®¿é—® opera://flags å¹¶å¼€å¯ ServiceWorker çš„æ”¯æŒ; é‡å¯æµè§ˆå™¨ã€‚ \n\n> å¦å¤–ï¼Œä½ éœ€è¦é€šè¿‡ **HTTPS** æ¥è®¿é—®ä½ çš„é¡µé¢ â€” å‡ºäºå®‰å…¨åŸå› ï¼ŒService Workers è¦æ±‚è¦åœ¨å¿…é¡»åœ¨ HTTPS ä¸‹æ‰èƒ½è¿è¡Œã€‚Github æ˜¯ä¸ªç”¨æ¥æµ‹è¯•çš„å¥½åœ°æ–¹ï¼Œå› ä¸ºå®ƒå°±æ”¯æŒHTTPSã€‚ä¸ºäº†ä¾¿äºæœ¬åœ°å¼€å‘ï¼Œlocalhost ä¹Ÿè¢«æµè§ˆå™¨è®¤ä¸ºæ˜¯å®‰å…¨æºã€‚\n\n## å¦‚ä½•ä½¿ç”¨\n### æ³¨å†Œservice worker\n```javascript\n/**\n * @scriptURL ServiceWorkerè„šæœ¬èµ„æºè·¯å¾„(å¯ä»¥æ˜¯ç»å¯¹æˆ–è€…ç›¸å¯¹å½“å‰URLçš„è·¯å¾„)\n * @options {scope: './'} scopeæ˜¯ä¸€ä¸ªè·¯å¾„,é»˜è®¤å€¼å°±æ˜¯'./',å®ƒæ€»æ˜¯ç›¸å¯¹äºServiceWorkerè„šæœ¬èµ„æºè·¯å¾„çš„,scopeæŒ‡å®šäº†ä¸€ä¸ªServiceWorkerçš„ç”Ÿæ•ˆèŒƒå›´,åªæœ‰åœ¨è¿™ä¸ªè·¯å¾„èŒƒå›´å†…çš„èµ„æºæ‰èƒ½æ”¯æŒç¦»çº¿è®¿é—®(æ‰€ä»¥è·¨åŸŸçš„èµ„æºæ˜¯æ²¡æ³•ç¦»çº¿è®¿é—®çš„)\n */\nServiceWorkerContainer.register(scriptURL, options)\n    .then(\n        function(ServiceWorkerRegistration) {\n            // do something\n        }\n);\n```\nä»£ç å¦‚ä¸‹:\n```javascript\n//å…¼å®¹æ€§åˆ¤æ–­\nif ('serviceWorker' in navigator) {\n    navigator.serviceWorker.register('sw.js', {scope: './'}).then(function(reg) {\n        if (reg.installing) {\n            console.log('Service worker installing');\n        } else if (reg.waiting) {\n            console.log('Service worker installed');\n        } else if (reg.active) {\n            console.log('Service worker active');\n        }\n    }).catch(function(error) {\n        // registration failed\n        console.log('Registration failed with ' + error);\n    });\n}\n```\näº‹å®ä¸Šå½“æµè§ˆå™¨è¿è¡Œä¸Šé¢çš„ä»£ç æ—¶, ä¼šå…ˆæ£€æµ‹æ˜¯å¦ä¹‹å‰å°±è·å–å¹¶æ³¨å†Œè¿‡**sw.js**\n* å¦‚æœæ˜¯**é¦–æ¬¡è¿è¡Œ**,é‚£å°±å…ˆä¸‹è½½å¹¶ä¿å­˜åœ¨æœ¬åœ°, chromeä¸­å¯ä»¥åœ¨*Application -> Service Workers*é¢æ¿ä¸­æŸ¥çœ‹\n![](https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/3.png)\nè¿™æ—¶ä¼šè§¦å‘Service Workerçš„``install``äº‹ä»¶,ä¹‹åä¼šè¿›å…¥``navigator.serviceWorker.register``è¿”å›çš„``Promise.then``,çŠ¶æ€``state``ä¸º``installing``. \n* å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰**sw.js** *(å³ä½¿æœ¬åœ°çš„**sw.js**ä¸æ˜¯æœ€æ–°ä»£ç ,è¿™æ¬¡è®¿é—®ä»»ç„¶ä¼šä½¿ç”¨æœ¬åœ°**sw.js**çš„ä»£ç )*,é‚£ä¹ˆä¼šç›´æ¥è¿›å…¥``navigator.serviceWorker.register``è¿”å›çš„``Promise.then``,çŠ¶æ€``state``ä¸º``activated``,è¿™æ—¶Service Workerä¸ºå·²æ¿€æ´»çŠ¶æ€,åé¢åªè¦æ˜¯æœ‰``scope``èŒƒå›´å†…çš„è¯·æ±‚éƒ½ä¼šè¢«Service Workerçš„``fetch``äº‹ä»¶æ‹¦æˆª*(æ³¨æ„:å¦‚æœåœ¨scopeä¸‹çš„htmlé¡µé¢è®¿é—®äº†è·¨åŸŸçš„èµ„æº,æ¯”å¦‚å›¾ç‰‡ä»€ä¹ˆçš„,é‚£è¿™ä¸ªè·¨åŸŸèµ„æºè¯·æ±‚ä¹Ÿä¼šè¢«æ‹¦æˆª)*,åœ¨``fetch``çš„å›è°ƒå‡½æ•°é‡Œé¢ä½ å¯ä»¥è‡ªè¡Œæ§åˆ¶æ˜¯**è¯»ç¼“å­˜**,è¿˜æ˜¯**è¯·æ±‚ç½‘ç»œ**,ä½ ç”šè‡³å¯ä»¥**ä¼ªé€ å“åº”æ•°æ®** *(æˆ‘æƒ³è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆService Workeråªæ”¯æŒHTTPSçš„åŸå› )*\n* å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰**sw.js**å¹¶ä¸”æœ¬åœ°çš„**sw.js**ä¸æ˜¯æœ€æ–°ä»£ç ,é‚£ä¹ˆ**sw.js**ä¼šè‡ªåŠ¨æ›´æ–°,å¹¶è§¦å‘Service Workerçš„``install``äº‹ä»¶,åœ¨ä¸‹æ¬¡è®¿é—®é¡µé¢æ—¶å°†ä½¿ç”¨æ–°ç‰ˆæœ¬çš„**sw.js**.\n\n### å…³äºsw.js\n#### sw.jsçš„èŒè´£\nä»ä¸Šé¢çš„æè¿°,æˆ‘ä»¬å¯ä»¥çœ‹å‡º**sw.js**çš„èŒè´£å…¶å®æ˜¯æ§åˆ¶webåº”ç”¨ä¸­èµ„æºçš„è®¿é—®ç­–ç•¥,ä»–å’Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘,UIæ“ä½œéƒ½æ²¡æœ‰ä»»ä½•å…³ç³»,å®˜æ–¹è¯´æ˜:\n> å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œservice worker å°±åœ¨ [ServiceWorkerGlobalScope](https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerGlobalScope) ç¯å¢ƒä¸­è¿è¡Œï¼› è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„ woker ä¸Šä¸‹æ–‡è¿è¡Œç¯å¢ƒï¼Œä¸ä¸»è¿è¡Œçº¿ç¨‹ï¼ˆæ‰§è¡Œè„šæœ¬ï¼‰ç›¸ç‹¬ç«‹ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è®¿é—® DOM çš„èƒ½åŠ›ã€‚\n\n#### å…·ä½“å®ç°\n* æ³¨å†Œinstalläº‹ä»¶\n```javascript\nthis.addEventListener('install', function(event) {\n    //console.log('sw.js install');\n    event.waitUntil(\n        caches.open('v1').then(function(cache) {\n            return cache.addAll([\n                '/demo/service-workers/',\n                '/demo/service-workers/index.html',\n                '/demo/service-workers/js/main.js',\n                '/demo/service-workers/json/data.json',\n                '/demo/service-workers/images/1.jpg',\n                '/demo/service-workers/images/2.jpg',\n            ]);\n        })\n    );\n});\n```\n> install äº‹ä»¶ä¸€èˆ¬æ˜¯è¢«ç”¨æ¥å¡«å……ä½ çš„æµè§ˆå™¨çš„ç¦»çº¿ç¼“å­˜èƒ½åŠ›ã€‚ä¸ºäº†è¾¾æˆè¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Service Worker çš„ æ–°çš„æ ‡å¿—æ€§çš„å­˜å‚¨ [API â€” cache](https://developer.mozilla.org/zh-CN/docs/Web/API/Cache) â€” ä¸€ä¸ª service worker ä¸Šçš„å…¨å±€å¯¹è±¡ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥å­˜å‚¨ç½‘ç»œå“åº”å‘æ¥çš„èµ„æºï¼Œå¹¶ä¸”æ ¹æ®å®ƒä»¬çš„è¯·æ±‚æ¥ç”Ÿæˆkeyã€‚è¿™ä¸ª API å’Œæµè§ˆå™¨çš„æ ‡å‡†çš„ç¼“å­˜å·¥ä½œåŸç†å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯ç‰¹å®šä½ çš„åŸŸçš„ã€‚å®ƒä¼šä¸€ç›´æŒä¹…å­˜åœ¨ï¼Œç›´åˆ°ä½ å‘Šè¯‰å®ƒä¸å†å­˜å‚¨ï¼Œä½ æ‹¥æœ‰å…¨éƒ¨çš„æ§åˆ¶æƒã€‚\n> æ³¨æ„:  Cache API  å¹¶ä¸è¢«æ¯ä¸ªæµè§ˆå™¨æ”¯æŒã€‚ï¼ˆæŸ¥çœ‹ Browser support  éƒ¨åˆ†äº†è§£æ›´å¤šä¿¡æ¯ã€‚ï¼‰ å¦‚æœä½ ç°åœ¨å°±æƒ³ä½¿ç”¨å®ƒï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä¸€ä¸ª polyfillï¼Œæ¯”å¦‚ [Google topeka demo](https://github.com/Polymer/topeka/blob/master/sw.js)ï¼Œæˆ–è€…æŠŠä½ çš„èµ„æºå­˜å‚¨åœ¨ [IndexedDB](https://developer.mozilla.org/zh-CN/docs/Glossary/IndexedDB) ä¸­ã€‚\n\nç¼“å­˜æ–¹æ¡ˆæœ‰å¾ˆå¤šç§, ç¤ºä¾‹ä»£ç ä¸­é‡‡ç”¨``Cache``, å€¼å¾—æ³¨æ„çš„æ˜¯``cache.addAll``å¯ä¸ä»…ä»…åªæ˜¯è®°å½•éœ€è¦ç¼“å­˜çš„èµ„æºURLåˆ—è¡¨, å®ƒåŒæ—¶è¿˜ä¼š``fetch``è¿™äº›èµ„æºæŠŠå“åº”æ•°æ®ç¼“å­˜èµ·æ¥,ä»¥ä¾¿åé¢è®¿é—®çš„æ—¶å€™ä½¿ç”¨ *(å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„webåº”ç”¨,ä¸ªäººè§‰å¾—æœ‰äº›ä¸å¤ªåˆç†,è°åˆä¼šåœ¨é¡µé¢åˆšåˆšè¿›æ¥æ—¶å°±åŠ è½½æ‰€æœ‰èµ„æºå‘¢?)*\n\n* æ³¨å†Œfetchäº‹ä»¶\n```javascript\nthis.addEventListener('fetch', function(event) {\n    //console.log(event.request);\n    //console.log(caches);\n    event.respondWith(\n        caches.match(event.request)\n        .catch(function() {\n            return fetch(event.request);\n        }).then(function(response) {\n            //console.log(response);\n            caches.open('v1').then(function(cache) {\n                //console.log(cache);\n                cache.put(event.request, response);\n            });\n            return response.clone();\n        })\n    );\n});\n```\n1. ``event.respondWith``æ¥å—ä¸€ä¸ªè¿”å›responseå“åº”çš„Promise\n2. ``caches.match``ä¼šå°è¯•åœ¨ç¼“å­˜ä¸­åŒ¹é…å½“å‰fetchçš„è¯·æ±‚,åŒ¹é…åˆ°äº†å°±ç›´æ¥è¿”å›response\n3. ``cache.put``åˆ™æ˜¯æ›´æ–°ç¼“å­˜\n\n* æ³¨å†Œactivateäº‹ä»¶\n```javascript\nthis.addEventListener('activate', function(event) {\n    var cacheWhitelist = ['v2'];\n\n    event.waitUntil(\n        caches.keys().then(function(keyList) {\n            return Promise.all(keyList.map(function(key) {\n                if (cacheWhitelist.indexOf(key) === -1) {\n                    return caches.delete(key);\n                }\n            }));\n        })\n    );\n});\n```\nactivateäº‹ä»¶å›è°ƒä¸€èˆ¬è¢«ç”¨æ¥åˆ é™¤æ—§çš„ç¼“å­˜\n\n#### æ”¹è¿›åçš„ä»£ç \n```javascript\nthis.addEventListener('install', function(event) {\n    console.log('sw.js install');\n    event.waitUntil(\n        //è¿™é‡Œå…ˆä¸å¾€ç¼“å­˜ä¸­å†™\n        caches.open('v1').then(function(cache) {\n            return cache.addAll([\n                // '/demo/service-workers/',\n                // '/demo/service-workers/index.html',\n                // '/demo/service-workers/js/main.js',\n                // '/demo/service-workers/json/data.json',\n                // '/demo/service-workers/images/1.jpg',\n                // '/demo/service-workers/images/2.jpg',\n                // '/demo/service-workers/child.html',\n            ]);\n        })\n    );\n});\nthis.addEventListener('fetch', function(event) {\n    event.respondWith(\n        caches.match(event.request)\n        .then(function(response) {\n            if (response) {\n                //å¦‚æœåŒ¹é…åˆ°äº†\n                return response;\n            } else {\n                //å¦‚æœæœ‰èµ„æºæ²¡æœ‰åŒ¹é…(æ¯”å¦‚child.htmlé‡Œé¢çš„è·¨åŸŸå›¾ç‰‡),å°±å…ˆå‘è¯·æ±‚è®¿é—®,ç„¶åç¼“å­˜ä¸€ä»½\n                console.log('url not match;' + event.request.url);\n                return fetch(event.request).then(function(response) {\n                    console.log(response);\n                    caches.open('v1').then(function(cache) {\n                        cache.put(event.request, response);\n                    });\n                    return response.clone();\n                });\n            }\n        })\n        .catch(function() {\n            return fetch(event.request);\n        })\n    );\n});\nthis.addEventListener('activate', function(event) {\n    console.log('activate')\n});\n```\n[æ¼”ç¤ºåœ°å€](https://lh2907883.github.io/store/demo/service-workers/)\n\n## å‚è€ƒèµ„æ–™\n* [MDN ä½¿ç”¨ Service Workers](https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers)\n","source":"_posts/webç¦»çº¿åº”ç”¨.md","raw":"---\ntitle: webç¦»çº¿åº”ç”¨\ntags: javascript\ndate: 2017-05-14 15:57:53\n---\n\n## ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨\nåœ¨æ­£å¸¸æƒ…å†µä¸‹,å®¢æˆ·ç«¯ä½¿ç”¨HTTPåè®®é€šè¿‡ç½‘ç»œå¾—åˆ°æœåŠ¡å™¨çš„èµ„æº,ç„¶åå±•ç¤º,ä½†æ˜¯å¦‚æœåœ¨ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹,å®¢æˆ·ç«¯å°±æ²¡åŠæ³•äº†,è¿™æ—¶å°±éœ€è¦ä¸€ç§æŠ€æœ¯å»è§£å†³è¿™ä¸€é—®é¢˜,ç›®å‰æœ‰ä¸¤ç§æ–¹å¼:[AppCache](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache)å’Œ[Service Workers](https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers#Browser_compatibility),ä»–ä»¬éƒ½æ˜¯é€šè¿‡åœ¨æ–­ç½‘æ—¶è¯»å–æœ¬åœ°ç¼“å­˜èµ„æºæ¥å®ç°webåº”ç”¨çš„ç¦»çº¿è®¿é—®çš„.\n\n## æ¯”è¾ƒAppCacheå’ŒService Workers\n### ä½¿ç”¨æ–¹å¼\nAppCacheé€šè¿‡æŒ‡å®šç¼“å­˜æ¸…å•æ–‡ä»¶æ¥è®¾ç½®å“ªäº›èµ„æºéœ€è¦è¢«ç¼“å­˜\n\nService Workersåˆ™æœ‰æ›´æ–°å¼ºå¤§çš„APIæ¥é€šè¿‡è„šæœ¬ç²¾å‡†æ§åˆ¶ç¼“å­˜(åŒ…æ‹¬æ›´æ–°,è¿½åŠ ,åˆ é™¤ç¼“å­˜)\n\n### å…¼å®¹æ€§\nä¸‹å›¾æ˜¯å„å¤§æµè§ˆå™¨å¯¹AppCacheçš„æ”¯æŒæƒ…å†µ,å¯ä»¥çœ‹å‡ºåŸºæœ¬éƒ½æ”¯æŒ\n![](https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/1.png)\n\nè€ŒService Workersè¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒçš„(ç‰¹åˆ«æ˜¯ç§»åŠ¨å¹³å°)\n![](https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/2.png)\n\n### W3Cæ ‡å‡†\nå¦‚æœä½ çœ‹è¿‡[AppCache](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache)çš„æ–‡æ¡£,ä½ ä¼šå‘ç°\n> è¯¥ç‰¹æ€§å·²ç»ä»Webæ ‡å‡†ä¸­åˆ é™¤ï¼Œè™½ç„¶ä¸€äº›æµè§ˆå™¨ç›®å‰ä»ç„¶æ”¯æŒå®ƒï¼Œä½†ä¹Ÿè®¸ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´åœæ­¢æ”¯æŒï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚\n\n> åœ¨æ­¤åˆ»ä½¿ç”¨è¿™é‡Œæè¿°çš„åº”ç”¨ç¨‹åºç¼“å­˜åŠŸèƒ½é«˜åº¦ä¸é¼“åŠ±; å®ƒæ­£åœ¨å¤„äºä»Webå¹³å°ä¸­è¢«åˆ é™¤çš„è¿‡ç¨‹ã€‚è¯·æ”¹ç”¨[Service Workers](https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers#Browser_compatibility)ä»£æ›¿ã€‚\n\næˆ‘ä¸ªäººè®¤ä¸ºService Workerså„æ–¹é¢éƒ½è¦ä¼˜äºAppCache,é™¤äº†å…¼å®¹æ€§,ä¸è¿‡æ—¢ç„¶Service Workerså·²ç»æ˜¯W3Cæ ‡å‡†,æƒ³å¿…æœªæ¥çš„æ”¯æŒæƒ…å†µåº”è¯¥ä¼šå¥½ä¸€äº›,æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºService Workersçš„ç”¨æ³•\n\n## ä½¿ç”¨Service Workersçš„å‰ææ¡ä»¶\n> åœ¨å·²ç»æ”¯æŒ serivce workers çš„æµè§ˆå™¨çš„ç‰ˆæœ¬ä¸­, å¾ˆå¤šç‰¹æ€§æ²¡æœ‰é»˜è®¤å¼€å¯, éœ€è¦å¼€å¯ä¸€ä¸‹æµè§ˆå™¨çš„ç›¸å…³é…ç½®ï¼š\n> * Firefox Nightly: è®¿é—® about:config å¹¶è®¾ç½® dom.serviceWorkers.enabled çš„å€¼ä¸º true; é‡å¯æµè§ˆå™¨ï¼›\n> * Chrome Canary: è®¿é—® chrome://flags å¹¶å¼€å¯ experimental-web-platform-features; é‡å¯æµè§ˆå™¨ (æ³¨æ„ï¼šæœ‰äº›ç‰¹æ€§åœ¨Chromeä¸­æ²¡æœ‰é»˜è®¤å¼€æ”¾æ”¯æŒ)ï¼›\n> * Opera: è®¿é—® opera://flags å¹¶å¼€å¯ ServiceWorker çš„æ”¯æŒ; é‡å¯æµè§ˆå™¨ã€‚ \n\n> å¦å¤–ï¼Œä½ éœ€è¦é€šè¿‡ **HTTPS** æ¥è®¿é—®ä½ çš„é¡µé¢ â€” å‡ºäºå®‰å…¨åŸå› ï¼ŒService Workers è¦æ±‚è¦åœ¨å¿…é¡»åœ¨ HTTPS ä¸‹æ‰èƒ½è¿è¡Œã€‚Github æ˜¯ä¸ªç”¨æ¥æµ‹è¯•çš„å¥½åœ°æ–¹ï¼Œå› ä¸ºå®ƒå°±æ”¯æŒHTTPSã€‚ä¸ºäº†ä¾¿äºæœ¬åœ°å¼€å‘ï¼Œlocalhost ä¹Ÿè¢«æµè§ˆå™¨è®¤ä¸ºæ˜¯å®‰å…¨æºã€‚\n\n## å¦‚ä½•ä½¿ç”¨\n### æ³¨å†Œservice worker\n```javascript\n/**\n * @scriptURL ServiceWorkerè„šæœ¬èµ„æºè·¯å¾„(å¯ä»¥æ˜¯ç»å¯¹æˆ–è€…ç›¸å¯¹å½“å‰URLçš„è·¯å¾„)\n * @options {scope: './'} scopeæ˜¯ä¸€ä¸ªè·¯å¾„,é»˜è®¤å€¼å°±æ˜¯'./',å®ƒæ€»æ˜¯ç›¸å¯¹äºServiceWorkerè„šæœ¬èµ„æºè·¯å¾„çš„,scopeæŒ‡å®šäº†ä¸€ä¸ªServiceWorkerçš„ç”Ÿæ•ˆèŒƒå›´,åªæœ‰åœ¨è¿™ä¸ªè·¯å¾„èŒƒå›´å†…çš„èµ„æºæ‰èƒ½æ”¯æŒç¦»çº¿è®¿é—®(æ‰€ä»¥è·¨åŸŸçš„èµ„æºæ˜¯æ²¡æ³•ç¦»çº¿è®¿é—®çš„)\n */\nServiceWorkerContainer.register(scriptURL, options)\n    .then(\n        function(ServiceWorkerRegistration) {\n            // do something\n        }\n);\n```\nä»£ç å¦‚ä¸‹:\n```javascript\n//å…¼å®¹æ€§åˆ¤æ–­\nif ('serviceWorker' in navigator) {\n    navigator.serviceWorker.register('sw.js', {scope: './'}).then(function(reg) {\n        if (reg.installing) {\n            console.log('Service worker installing');\n        } else if (reg.waiting) {\n            console.log('Service worker installed');\n        } else if (reg.active) {\n            console.log('Service worker active');\n        }\n    }).catch(function(error) {\n        // registration failed\n        console.log('Registration failed with ' + error);\n    });\n}\n```\näº‹å®ä¸Šå½“æµè§ˆå™¨è¿è¡Œä¸Šé¢çš„ä»£ç æ—¶, ä¼šå…ˆæ£€æµ‹æ˜¯å¦ä¹‹å‰å°±è·å–å¹¶æ³¨å†Œè¿‡**sw.js**\n* å¦‚æœæ˜¯**é¦–æ¬¡è¿è¡Œ**,é‚£å°±å…ˆä¸‹è½½å¹¶ä¿å­˜åœ¨æœ¬åœ°, chromeä¸­å¯ä»¥åœ¨*Application -> Service Workers*é¢æ¿ä¸­æŸ¥çœ‹\n![](https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/3.png)\nè¿™æ—¶ä¼šè§¦å‘Service Workerçš„``install``äº‹ä»¶,ä¹‹åä¼šè¿›å…¥``navigator.serviceWorker.register``è¿”å›çš„``Promise.then``,çŠ¶æ€``state``ä¸º``installing``. \n* å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰**sw.js** *(å³ä½¿æœ¬åœ°çš„**sw.js**ä¸æ˜¯æœ€æ–°ä»£ç ,è¿™æ¬¡è®¿é—®ä»»ç„¶ä¼šä½¿ç”¨æœ¬åœ°**sw.js**çš„ä»£ç )*,é‚£ä¹ˆä¼šç›´æ¥è¿›å…¥``navigator.serviceWorker.register``è¿”å›çš„``Promise.then``,çŠ¶æ€``state``ä¸º``activated``,è¿™æ—¶Service Workerä¸ºå·²æ¿€æ´»çŠ¶æ€,åé¢åªè¦æ˜¯æœ‰``scope``èŒƒå›´å†…çš„è¯·æ±‚éƒ½ä¼šè¢«Service Workerçš„``fetch``äº‹ä»¶æ‹¦æˆª*(æ³¨æ„:å¦‚æœåœ¨scopeä¸‹çš„htmlé¡µé¢è®¿é—®äº†è·¨åŸŸçš„èµ„æº,æ¯”å¦‚å›¾ç‰‡ä»€ä¹ˆçš„,é‚£è¿™ä¸ªè·¨åŸŸèµ„æºè¯·æ±‚ä¹Ÿä¼šè¢«æ‹¦æˆª)*,åœ¨``fetch``çš„å›è°ƒå‡½æ•°é‡Œé¢ä½ å¯ä»¥è‡ªè¡Œæ§åˆ¶æ˜¯**è¯»ç¼“å­˜**,è¿˜æ˜¯**è¯·æ±‚ç½‘ç»œ**,ä½ ç”šè‡³å¯ä»¥**ä¼ªé€ å“åº”æ•°æ®** *(æˆ‘æƒ³è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆService Workeråªæ”¯æŒHTTPSçš„åŸå› )*\n* å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰**sw.js**å¹¶ä¸”æœ¬åœ°çš„**sw.js**ä¸æ˜¯æœ€æ–°ä»£ç ,é‚£ä¹ˆ**sw.js**ä¼šè‡ªåŠ¨æ›´æ–°,å¹¶è§¦å‘Service Workerçš„``install``äº‹ä»¶,åœ¨ä¸‹æ¬¡è®¿é—®é¡µé¢æ—¶å°†ä½¿ç”¨æ–°ç‰ˆæœ¬çš„**sw.js**.\n\n### å…³äºsw.js\n#### sw.jsçš„èŒè´£\nä»ä¸Šé¢çš„æè¿°,æˆ‘ä»¬å¯ä»¥çœ‹å‡º**sw.js**çš„èŒè´£å…¶å®æ˜¯æ§åˆ¶webåº”ç”¨ä¸­èµ„æºçš„è®¿é—®ç­–ç•¥,ä»–å’Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘,UIæ“ä½œéƒ½æ²¡æœ‰ä»»ä½•å…³ç³»,å®˜æ–¹è¯´æ˜:\n> å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œservice worker å°±åœ¨ [ServiceWorkerGlobalScope](https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerGlobalScope) ç¯å¢ƒä¸­è¿è¡Œï¼› è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„ woker ä¸Šä¸‹æ–‡è¿è¡Œç¯å¢ƒï¼Œä¸ä¸»è¿è¡Œçº¿ç¨‹ï¼ˆæ‰§è¡Œè„šæœ¬ï¼‰ç›¸ç‹¬ç«‹ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è®¿é—® DOM çš„èƒ½åŠ›ã€‚\n\n#### å…·ä½“å®ç°\n* æ³¨å†Œinstalläº‹ä»¶\n```javascript\nthis.addEventListener('install', function(event) {\n    //console.log('sw.js install');\n    event.waitUntil(\n        caches.open('v1').then(function(cache) {\n            return cache.addAll([\n                '/demo/service-workers/',\n                '/demo/service-workers/index.html',\n                '/demo/service-workers/js/main.js',\n                '/demo/service-workers/json/data.json',\n                '/demo/service-workers/images/1.jpg',\n                '/demo/service-workers/images/2.jpg',\n            ]);\n        })\n    );\n});\n```\n> install äº‹ä»¶ä¸€èˆ¬æ˜¯è¢«ç”¨æ¥å¡«å……ä½ çš„æµè§ˆå™¨çš„ç¦»çº¿ç¼“å­˜èƒ½åŠ›ã€‚ä¸ºäº†è¾¾æˆè¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Service Worker çš„ æ–°çš„æ ‡å¿—æ€§çš„å­˜å‚¨ [API â€” cache](https://developer.mozilla.org/zh-CN/docs/Web/API/Cache) â€” ä¸€ä¸ª service worker ä¸Šçš„å…¨å±€å¯¹è±¡ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥å­˜å‚¨ç½‘ç»œå“åº”å‘æ¥çš„èµ„æºï¼Œå¹¶ä¸”æ ¹æ®å®ƒä»¬çš„è¯·æ±‚æ¥ç”Ÿæˆkeyã€‚è¿™ä¸ª API å’Œæµè§ˆå™¨çš„æ ‡å‡†çš„ç¼“å­˜å·¥ä½œåŸç†å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯ç‰¹å®šä½ çš„åŸŸçš„ã€‚å®ƒä¼šä¸€ç›´æŒä¹…å­˜åœ¨ï¼Œç›´åˆ°ä½ å‘Šè¯‰å®ƒä¸å†å­˜å‚¨ï¼Œä½ æ‹¥æœ‰å…¨éƒ¨çš„æ§åˆ¶æƒã€‚\n> æ³¨æ„:  Cache API  å¹¶ä¸è¢«æ¯ä¸ªæµè§ˆå™¨æ”¯æŒã€‚ï¼ˆæŸ¥çœ‹ Browser support  éƒ¨åˆ†äº†è§£æ›´å¤šä¿¡æ¯ã€‚ï¼‰ å¦‚æœä½ ç°åœ¨å°±æƒ³ä½¿ç”¨å®ƒï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä¸€ä¸ª polyfillï¼Œæ¯”å¦‚ [Google topeka demo](https://github.com/Polymer/topeka/blob/master/sw.js)ï¼Œæˆ–è€…æŠŠä½ çš„èµ„æºå­˜å‚¨åœ¨ [IndexedDB](https://developer.mozilla.org/zh-CN/docs/Glossary/IndexedDB) ä¸­ã€‚\n\nç¼“å­˜æ–¹æ¡ˆæœ‰å¾ˆå¤šç§, ç¤ºä¾‹ä»£ç ä¸­é‡‡ç”¨``Cache``, å€¼å¾—æ³¨æ„çš„æ˜¯``cache.addAll``å¯ä¸ä»…ä»…åªæ˜¯è®°å½•éœ€è¦ç¼“å­˜çš„èµ„æºURLåˆ—è¡¨, å®ƒåŒæ—¶è¿˜ä¼š``fetch``è¿™äº›èµ„æºæŠŠå“åº”æ•°æ®ç¼“å­˜èµ·æ¥,ä»¥ä¾¿åé¢è®¿é—®çš„æ—¶å€™ä½¿ç”¨ *(å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„webåº”ç”¨,ä¸ªäººè§‰å¾—æœ‰äº›ä¸å¤ªåˆç†,è°åˆä¼šåœ¨é¡µé¢åˆšåˆšè¿›æ¥æ—¶å°±åŠ è½½æ‰€æœ‰èµ„æºå‘¢?)*\n\n* æ³¨å†Œfetchäº‹ä»¶\n```javascript\nthis.addEventListener('fetch', function(event) {\n    //console.log(event.request);\n    //console.log(caches);\n    event.respondWith(\n        caches.match(event.request)\n        .catch(function() {\n            return fetch(event.request);\n        }).then(function(response) {\n            //console.log(response);\n            caches.open('v1').then(function(cache) {\n                //console.log(cache);\n                cache.put(event.request, response);\n            });\n            return response.clone();\n        })\n    );\n});\n```\n1. ``event.respondWith``æ¥å—ä¸€ä¸ªè¿”å›responseå“åº”çš„Promise\n2. ``caches.match``ä¼šå°è¯•åœ¨ç¼“å­˜ä¸­åŒ¹é…å½“å‰fetchçš„è¯·æ±‚,åŒ¹é…åˆ°äº†å°±ç›´æ¥è¿”å›response\n3. ``cache.put``åˆ™æ˜¯æ›´æ–°ç¼“å­˜\n\n* æ³¨å†Œactivateäº‹ä»¶\n```javascript\nthis.addEventListener('activate', function(event) {\n    var cacheWhitelist = ['v2'];\n\n    event.waitUntil(\n        caches.keys().then(function(keyList) {\n            return Promise.all(keyList.map(function(key) {\n                if (cacheWhitelist.indexOf(key) === -1) {\n                    return caches.delete(key);\n                }\n            }));\n        })\n    );\n});\n```\nactivateäº‹ä»¶å›è°ƒä¸€èˆ¬è¢«ç”¨æ¥åˆ é™¤æ—§çš„ç¼“å­˜\n\n#### æ”¹è¿›åçš„ä»£ç \n```javascript\nthis.addEventListener('install', function(event) {\n    console.log('sw.js install');\n    event.waitUntil(\n        //è¿™é‡Œå…ˆä¸å¾€ç¼“å­˜ä¸­å†™\n        caches.open('v1').then(function(cache) {\n            return cache.addAll([\n                // '/demo/service-workers/',\n                // '/demo/service-workers/index.html',\n                // '/demo/service-workers/js/main.js',\n                // '/demo/service-workers/json/data.json',\n                // '/demo/service-workers/images/1.jpg',\n                // '/demo/service-workers/images/2.jpg',\n                // '/demo/service-workers/child.html',\n            ]);\n        })\n    );\n});\nthis.addEventListener('fetch', function(event) {\n    event.respondWith(\n        caches.match(event.request)\n        .then(function(response) {\n            if (response) {\n                //å¦‚æœåŒ¹é…åˆ°äº†\n                return response;\n            } else {\n                //å¦‚æœæœ‰èµ„æºæ²¡æœ‰åŒ¹é…(æ¯”å¦‚child.htmlé‡Œé¢çš„è·¨åŸŸå›¾ç‰‡),å°±å…ˆå‘è¯·æ±‚è®¿é—®,ç„¶åç¼“å­˜ä¸€ä»½\n                console.log('url not match;' + event.request.url);\n                return fetch(event.request).then(function(response) {\n                    console.log(response);\n                    caches.open('v1').then(function(cache) {\n                        cache.put(event.request, response);\n                    });\n                    return response.clone();\n                });\n            }\n        })\n        .catch(function() {\n            return fetch(event.request);\n        })\n    );\n});\nthis.addEventListener('activate', function(event) {\n    console.log('activate')\n});\n```\n[æ¼”ç¤ºåœ°å€](https://lh2907883.github.io/store/demo/service-workers/)\n\n## å‚è€ƒèµ„æ–™\n* [MDN ä½¿ç”¨ Service Workers](https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers)\n","slug":"webç¦»çº¿åº”ç”¨","published":1,"updated":"2017-05-14T09:02:29.000Z","_id":"cj2oermi00000vytxlkmlsfuy","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨\"><a href=\"#ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨\"></a>ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨</h2><p>åœ¨æ­£å¸¸æƒ…å†µä¸‹,å®¢æˆ·ç«¯ä½¿ç”¨HTTPåè®®é€šè¿‡ç½‘ç»œå¾—åˆ°æœåŠ¡å™¨çš„èµ„æº,ç„¶åå±•ç¤º,ä½†æ˜¯å¦‚æœåœ¨ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹,å®¢æˆ·ç«¯å°±æ²¡åŠæ³•äº†,è¿™æ—¶å°±éœ€è¦ä¸€ç§æŠ€æœ¯å»è§£å†³è¿™ä¸€é—®é¢˜,ç›®å‰æœ‰ä¸¤ç§æ–¹å¼:<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache\" target=\"_blank\" rel=\"external\">AppCache</a>å’Œ<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers#Browser_compatibility\" target=\"_blank\" rel=\"external\">Service Workers</a>,ä»–ä»¬éƒ½æ˜¯é€šè¿‡åœ¨æ–­ç½‘æ—¶è¯»å–æœ¬åœ°ç¼“å­˜èµ„æºæ¥å®ç°webåº”ç”¨çš„ç¦»çº¿è®¿é—®çš„.</p>\n<h2 id=\"æ¯”è¾ƒAppCacheå’ŒService-Workers\"><a href=\"#æ¯”è¾ƒAppCacheå’ŒService-Workers\" class=\"headerlink\" title=\"æ¯”è¾ƒAppCacheå’ŒService Workers\"></a>æ¯”è¾ƒAppCacheå’ŒService Workers</h2><h3 id=\"ä½¿ç”¨æ–¹å¼\"><a href=\"#ä½¿ç”¨æ–¹å¼\" class=\"headerlink\" title=\"ä½¿ç”¨æ–¹å¼\"></a>ä½¿ç”¨æ–¹å¼</h3><p>AppCacheé€šè¿‡æŒ‡å®šç¼“å­˜æ¸…å•æ–‡ä»¶æ¥è®¾ç½®å“ªäº›èµ„æºéœ€è¦è¢«ç¼“å­˜</p>\n<p>Service Workersåˆ™æœ‰æ›´æ–°å¼ºå¤§çš„APIæ¥é€šè¿‡è„šæœ¬ç²¾å‡†æ§åˆ¶ç¼“å­˜(åŒ…æ‹¬æ›´æ–°,è¿½åŠ ,åˆ é™¤ç¼“å­˜)</p>\n<h3 id=\"å…¼å®¹æ€§\"><a href=\"#å…¼å®¹æ€§\" class=\"headerlink\" title=\"å…¼å®¹æ€§\"></a>å…¼å®¹æ€§</h3><p>ä¸‹å›¾æ˜¯å„å¤§æµè§ˆå™¨å¯¹AppCacheçš„æ”¯æŒæƒ…å†µ,å¯ä»¥çœ‹å‡ºåŸºæœ¬éƒ½æ”¯æŒ<br><img src=\"https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/1.png\" alt=\"\"></p>\n<p>è€ŒService Workersè¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒçš„(ç‰¹åˆ«æ˜¯ç§»åŠ¨å¹³å°)<br><img src=\"https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/2.png\" alt=\"\"></p>\n<h3 id=\"W3Cæ ‡å‡†\"><a href=\"#W3Cæ ‡å‡†\" class=\"headerlink\" title=\"W3Cæ ‡å‡†\"></a>W3Cæ ‡å‡†</h3><p>å¦‚æœä½ çœ‹è¿‡<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache\" target=\"_blank\" rel=\"external\">AppCache</a>çš„æ–‡æ¡£,ä½ ä¼šå‘ç°</p>\n<blockquote>\n<p>è¯¥ç‰¹æ€§å·²ç»ä»Webæ ‡å‡†ä¸­åˆ é™¤ï¼Œè™½ç„¶ä¸€äº›æµè§ˆå™¨ç›®å‰ä»ç„¶æ”¯æŒå®ƒï¼Œä½†ä¹Ÿè®¸ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´åœæ­¢æ”¯æŒï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚</p>\n<p>åœ¨æ­¤åˆ»ä½¿ç”¨è¿™é‡Œæè¿°çš„åº”ç”¨ç¨‹åºç¼“å­˜åŠŸèƒ½é«˜åº¦ä¸é¼“åŠ±; å®ƒæ­£åœ¨å¤„äºä»Webå¹³å°ä¸­è¢«åˆ é™¤çš„è¿‡ç¨‹ã€‚è¯·æ”¹ç”¨<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers#Browser_compatibility\" target=\"_blank\" rel=\"external\">Service Workers</a>ä»£æ›¿ã€‚</p>\n</blockquote>\n<p>æˆ‘ä¸ªäººè®¤ä¸ºService Workerså„æ–¹é¢éƒ½è¦ä¼˜äºAppCache,é™¤äº†å…¼å®¹æ€§,ä¸è¿‡æ—¢ç„¶Service Workerså·²ç»æ˜¯W3Cæ ‡å‡†,æƒ³å¿…æœªæ¥çš„æ”¯æŒæƒ…å†µåº”è¯¥ä¼šå¥½ä¸€äº›,æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºService Workersçš„ç”¨æ³•</p>\n<h2 id=\"ä½¿ç”¨Service-Workersçš„å‰ææ¡ä»¶\"><a href=\"#ä½¿ç”¨Service-Workersçš„å‰ææ¡ä»¶\" class=\"headerlink\" title=\"ä½¿ç”¨Service Workersçš„å‰ææ¡ä»¶\"></a>ä½¿ç”¨Service Workersçš„å‰ææ¡ä»¶</h2><blockquote>\n<p>åœ¨å·²ç»æ”¯æŒ serivce workers çš„æµè§ˆå™¨çš„ç‰ˆæœ¬ä¸­, å¾ˆå¤šç‰¹æ€§æ²¡æœ‰é»˜è®¤å¼€å¯, éœ€è¦å¼€å¯ä¸€ä¸‹æµè§ˆå™¨çš„ç›¸å…³é…ç½®ï¼š</p>\n<ul>\n<li>Firefox Nightly: è®¿é—® about:config å¹¶è®¾ç½® dom.serviceWorkers.enabled çš„å€¼ä¸º true; é‡å¯æµè§ˆå™¨ï¼›</li>\n<li>Chrome Canary: è®¿é—® chrome://flags å¹¶å¼€å¯ experimental-web-platform-features; é‡å¯æµè§ˆå™¨ (æ³¨æ„ï¼šæœ‰äº›ç‰¹æ€§åœ¨Chromeä¸­æ²¡æœ‰é»˜è®¤å¼€æ”¾æ”¯æŒ)ï¼›</li>\n<li>Opera: è®¿é—® opera://flags å¹¶å¼€å¯ ServiceWorker çš„æ”¯æŒ; é‡å¯æµè§ˆå™¨ã€‚ </li>\n</ul>\n<p>å¦å¤–ï¼Œä½ éœ€è¦é€šè¿‡ <strong>HTTPS</strong> æ¥è®¿é—®ä½ çš„é¡µé¢ â€” å‡ºäºå®‰å…¨åŸå› ï¼ŒService Workers è¦æ±‚è¦åœ¨å¿…é¡»åœ¨ HTTPS ä¸‹æ‰èƒ½è¿è¡Œã€‚Github æ˜¯ä¸ªç”¨æ¥æµ‹è¯•çš„å¥½åœ°æ–¹ï¼Œå› ä¸ºå®ƒå°±æ”¯æŒHTTPSã€‚ä¸ºäº†ä¾¿äºæœ¬åœ°å¼€å‘ï¼Œlocalhost ä¹Ÿè¢«æµè§ˆå™¨è®¤ä¸ºæ˜¯å®‰å…¨æºã€‚</p>\n</blockquote>\n<h2 id=\"å¦‚ä½•ä½¿ç”¨\"><a href=\"#å¦‚ä½•ä½¿ç”¨\" class=\"headerlink\" title=\"å¦‚ä½•ä½¿ç”¨\"></a>å¦‚ä½•ä½¿ç”¨</h2><h3 id=\"æ³¨å†Œservice-worker\"><a href=\"#æ³¨å†Œservice-worker\" class=\"headerlink\" title=\"æ³¨å†Œservice worker\"></a>æ³¨å†Œservice worker</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * @scriptURL ServiceWorkerè„šæœ¬èµ„æºè·¯å¾„(å¯ä»¥æ˜¯ç»å¯¹æˆ–è€…ç›¸å¯¹å½“å‰URLçš„è·¯å¾„)</div><div class=\"line\"> * @options &#123;scope: './'&#125; scopeæ˜¯ä¸€ä¸ªè·¯å¾„,é»˜è®¤å€¼å°±æ˜¯'./',å®ƒæ€»æ˜¯ç›¸å¯¹äºServiceWorkerè„šæœ¬èµ„æºè·¯å¾„çš„,scopeæŒ‡å®šäº†ä¸€ä¸ªServiceWorkerçš„ç”Ÿæ•ˆèŒƒå›´,åªæœ‰åœ¨è¿™ä¸ªè·¯å¾„èŒƒå›´å†…çš„èµ„æºæ‰èƒ½æ”¯æŒç¦»çº¿è®¿é—®(æ‰€ä»¥è·¨åŸŸçš„èµ„æºæ˜¯æ²¡æ³•ç¦»çº¿è®¿é—®çš„)</div><div class=\"line\"> */</div><div class=\"line\">ServiceWorkerContainer.register(scriptURL, options)</div><div class=\"line\">    .then(</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ServiceWorkerRegistration</span>) </span>&#123;</div><div class=\"line\">            <span class=\"comment\">// do something</span></div><div class=\"line\">        &#125;</div><div class=\"line\">);</div></pre></td></tr></table></figure>\n<p>ä»£ç å¦‚ä¸‹:<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//å…¼å®¹æ€§åˆ¤æ–­</span></div><div class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">'serviceWorker'</span> <span class=\"keyword\">in</span> navigator) &#123;</div><div class=\"line\">    navigator.serviceWorker.register(<span class=\"string\">'sw.js'</span>, &#123;<span class=\"attr\">scope</span>: <span class=\"string\">'./'</span>&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">reg</span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (reg.installing) &#123;</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Service worker installing'</span>);</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (reg.waiting) &#123;</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Service worker installed'</span>);</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (reg.active) &#123;</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Service worker active'</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// registration failed</span></div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Registration failed with '</span> + error);</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>äº‹å®ä¸Šå½“æµè§ˆå™¨è¿è¡Œä¸Šé¢çš„ä»£ç æ—¶, ä¼šå…ˆæ£€æµ‹æ˜¯å¦ä¹‹å‰å°±è·å–å¹¶æ³¨å†Œè¿‡<strong>sw.js</strong></p>\n<ul>\n<li>å¦‚æœæ˜¯<strong>é¦–æ¬¡è¿è¡Œ</strong>,é‚£å°±å…ˆä¸‹è½½å¹¶ä¿å­˜åœ¨æœ¬åœ°, chromeä¸­å¯ä»¥åœ¨<em>Application -&gt; Service Workers</em>é¢æ¿ä¸­æŸ¥çœ‹<br><img src=\"https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/3.png\" alt=\"\"><br>è¿™æ—¶ä¼šè§¦å‘Service Workerçš„<code>install</code>äº‹ä»¶,ä¹‹åä¼šè¿›å…¥<code>navigator.serviceWorker.register</code>è¿”å›çš„<code>Promise.then</code>,çŠ¶æ€<code>state</code>ä¸º<code>installing</code>. </li>\n<li>å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰<strong>sw.js</strong> <em>(å³ä½¿æœ¬åœ°çš„<strong>sw.js</strong>ä¸æ˜¯æœ€æ–°ä»£ç ,è¿™æ¬¡è®¿é—®ä»»ç„¶ä¼šä½¿ç”¨æœ¬åœ°<strong>sw.js</strong>çš„ä»£ç )</em>,é‚£ä¹ˆä¼šç›´æ¥è¿›å…¥<code>navigator.serviceWorker.register</code>è¿”å›çš„<code>Promise.then</code>,çŠ¶æ€<code>state</code>ä¸º<code>activated</code>,è¿™æ—¶Service Workerä¸ºå·²æ¿€æ´»çŠ¶æ€,åé¢åªè¦æ˜¯æœ‰<code>scope</code>èŒƒå›´å†…çš„è¯·æ±‚éƒ½ä¼šè¢«Service Workerçš„<code>fetch</code>äº‹ä»¶æ‹¦æˆª<em>(æ³¨æ„:å¦‚æœåœ¨scopeä¸‹çš„htmlé¡µé¢è®¿é—®äº†è·¨åŸŸçš„èµ„æº,æ¯”å¦‚å›¾ç‰‡ä»€ä¹ˆçš„,é‚£è¿™ä¸ªè·¨åŸŸèµ„æºè¯·æ±‚ä¹Ÿä¼šè¢«æ‹¦æˆª)</em>,åœ¨<code>fetch</code>çš„å›è°ƒå‡½æ•°é‡Œé¢ä½ å¯ä»¥è‡ªè¡Œæ§åˆ¶æ˜¯<strong>è¯»ç¼“å­˜</strong>,è¿˜æ˜¯<strong>è¯·æ±‚ç½‘ç»œ</strong>,ä½ ç”šè‡³å¯ä»¥<strong>ä¼ªé€ å“åº”æ•°æ®</strong> <em>(æˆ‘æƒ³è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆService Workeråªæ”¯æŒHTTPSçš„åŸå› )</em></li>\n<li>å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰<strong>sw.js</strong>å¹¶ä¸”æœ¬åœ°çš„<strong>sw.js</strong>ä¸æ˜¯æœ€æ–°ä»£ç ,é‚£ä¹ˆ<strong>sw.js</strong>ä¼šè‡ªåŠ¨æ›´æ–°,å¹¶è§¦å‘Service Workerçš„<code>install</code>äº‹ä»¶,åœ¨ä¸‹æ¬¡è®¿é—®é¡µé¢æ—¶å°†ä½¿ç”¨æ–°ç‰ˆæœ¬çš„<strong>sw.js</strong>.</li>\n</ul>\n<h3 id=\"å…³äºsw-js\"><a href=\"#å…³äºsw-js\" class=\"headerlink\" title=\"å…³äºsw.js\"></a>å…³äºsw.js</h3><h4 id=\"sw-jsçš„èŒè´£\"><a href=\"#sw-jsçš„èŒè´£\" class=\"headerlink\" title=\"sw.jsçš„èŒè´£\"></a>sw.jsçš„èŒè´£</h4><p>ä»ä¸Šé¢çš„æè¿°,æˆ‘ä»¬å¯ä»¥çœ‹å‡º<strong>sw.js</strong>çš„èŒè´£å…¶å®æ˜¯æ§åˆ¶webåº”ç”¨ä¸­èµ„æºçš„è®¿é—®ç­–ç•¥,ä»–å’Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘,UIæ“ä½œéƒ½æ²¡æœ‰ä»»ä½•å…³ç³»,å®˜æ–¹è¯´æ˜:</p>\n<blockquote>\n<p>å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œservice worker å°±åœ¨ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerGlobalScope\" target=\"_blank\" rel=\"external\">ServiceWorkerGlobalScope</a> ç¯å¢ƒä¸­è¿è¡Œï¼› è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„ woker ä¸Šä¸‹æ–‡è¿è¡Œç¯å¢ƒï¼Œä¸ä¸»è¿è¡Œçº¿ç¨‹ï¼ˆæ‰§è¡Œè„šæœ¬ï¼‰ç›¸ç‹¬ç«‹ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è®¿é—® DOM çš„èƒ½åŠ›ã€‚</p>\n</blockquote>\n<h4 id=\"å…·ä½“å®ç°\"><a href=\"#å…·ä½“å®ç°\" class=\"headerlink\" title=\"å…·ä½“å®ç°\"></a>å…·ä½“å®ç°</h4><ul>\n<li>æ³¨å†Œinstalläº‹ä»¶<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'install'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//console.log('sw.js install');</span></div><div class=\"line\">    event.waitUntil(</div><div class=\"line\">        caches.open(<span class=\"string\">'v1'</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cache</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> cache.addAll([</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/index.html'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/js/main.js'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/json/data.json'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/images/1.jpg'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/images/2.jpg'</span>,</div><div class=\"line\">            ]);</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<blockquote>\n<p>install äº‹ä»¶ä¸€èˆ¬æ˜¯è¢«ç”¨æ¥å¡«å……ä½ çš„æµè§ˆå™¨çš„ç¦»çº¿ç¼“å­˜èƒ½åŠ›ã€‚ä¸ºäº†è¾¾æˆè¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Service Worker çš„ æ–°çš„æ ‡å¿—æ€§çš„å­˜å‚¨ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache\" target=\"_blank\" rel=\"external\">API â€” cache</a> â€” ä¸€ä¸ª service worker ä¸Šçš„å…¨å±€å¯¹è±¡ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥å­˜å‚¨ç½‘ç»œå“åº”å‘æ¥çš„èµ„æºï¼Œå¹¶ä¸”æ ¹æ®å®ƒä»¬çš„è¯·æ±‚æ¥ç”Ÿæˆkeyã€‚è¿™ä¸ª API å’Œæµè§ˆå™¨çš„æ ‡å‡†çš„ç¼“å­˜å·¥ä½œåŸç†å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯ç‰¹å®šä½ çš„åŸŸçš„ã€‚å®ƒä¼šä¸€ç›´æŒä¹…å­˜åœ¨ï¼Œç›´åˆ°ä½ å‘Šè¯‰å®ƒä¸å†å­˜å‚¨ï¼Œä½ æ‹¥æœ‰å…¨éƒ¨çš„æ§åˆ¶æƒã€‚<br>æ³¨æ„:  Cache API  å¹¶ä¸è¢«æ¯ä¸ªæµè§ˆå™¨æ”¯æŒã€‚ï¼ˆæŸ¥çœ‹ Browser support  éƒ¨åˆ†äº†è§£æ›´å¤šä¿¡æ¯ã€‚ï¼‰ å¦‚æœä½ ç°åœ¨å°±æƒ³ä½¿ç”¨å®ƒï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä¸€ä¸ª polyfillï¼Œæ¯”å¦‚ <a href=\"https://github.com/Polymer/topeka/blob/master/sw.js\" target=\"_blank\" rel=\"external\">Google topeka demo</a>ï¼Œæˆ–è€…æŠŠä½ çš„èµ„æºå­˜å‚¨åœ¨ <a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/IndexedDB\" target=\"_blank\" rel=\"external\">IndexedDB</a> ä¸­ã€‚</p>\n</blockquote>\n<p>ç¼“å­˜æ–¹æ¡ˆæœ‰å¾ˆå¤šç§, ç¤ºä¾‹ä»£ç ä¸­é‡‡ç”¨<code>Cache</code>, å€¼å¾—æ³¨æ„çš„æ˜¯<code>cache.addAll</code>å¯ä¸ä»…ä»…åªæ˜¯è®°å½•éœ€è¦ç¼“å­˜çš„èµ„æºURLåˆ—è¡¨, å®ƒåŒæ—¶è¿˜ä¼š<code>fetch</code>è¿™äº›èµ„æºæŠŠå“åº”æ•°æ®ç¼“å­˜èµ·æ¥,ä»¥ä¾¿åé¢è®¿é—®çš„æ—¶å€™ä½¿ç”¨ <em>(å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„webåº”ç”¨,ä¸ªäººè§‰å¾—æœ‰äº›ä¸å¤ªåˆç†,è°åˆä¼šåœ¨é¡µé¢åˆšåˆšè¿›æ¥æ—¶å°±åŠ è½½æ‰€æœ‰èµ„æºå‘¢?)</em></p>\n<ul>\n<li>æ³¨å†Œfetchäº‹ä»¶<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'fetch'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//console.log(event.request);</span></div><div class=\"line\">    <span class=\"comment\">//console.log(caches);</span></div><div class=\"line\">    event.respondWith(</div><div class=\"line\">        caches.match(event.request)</div><div class=\"line\">        .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> fetch(event.request);</div><div class=\"line\">        &#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</div><div class=\"line\">            <span class=\"comment\">//console.log(response);</span></div><div class=\"line\">            caches.open(<span class=\"string\">'v1'</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cache</span>) </span>&#123;</div><div class=\"line\">                <span class=\"comment\">//console.log(cache);</span></div><div class=\"line\">                cache.put(event.request, response);</div><div class=\"line\">            &#125;);</div><div class=\"line\">            <span class=\"keyword\">return</span> response.clone();</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ol>\n<li><code>event.respondWith</code>æ¥å—ä¸€ä¸ªè¿”å›responseå“åº”çš„Promise</li>\n<li><code>caches.match</code>ä¼šå°è¯•åœ¨ç¼“å­˜ä¸­åŒ¹é…å½“å‰fetchçš„è¯·æ±‚,åŒ¹é…åˆ°äº†å°±ç›´æ¥è¿”å›response</li>\n<li><code>cache.put</code>åˆ™æ˜¯æ›´æ–°ç¼“å­˜</li>\n</ol>\n<ul>\n<li>æ³¨å†Œactivateäº‹ä»¶<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'activate'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> cacheWhitelist = [<span class=\"string\">'v2'</span>];</div><div class=\"line\"></div><div class=\"line\">    event.waitUntil(</div><div class=\"line\">        caches.keys().then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">keyList</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all(keyList.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (cacheWhitelist.indexOf(key) === <span class=\"number\">-1</span>) &#123;</div><div class=\"line\">                    <span class=\"keyword\">return</span> caches.delete(key);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;));</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>activateäº‹ä»¶å›è°ƒä¸€èˆ¬è¢«ç”¨æ¥åˆ é™¤æ—§çš„ç¼“å­˜</p>\n<h4 id=\"æ”¹è¿›åçš„ä»£ç \"><a href=\"#æ”¹è¿›åçš„ä»£ç \" class=\"headerlink\" title=\"æ”¹è¿›åçš„ä»£ç \"></a>æ”¹è¿›åçš„ä»£ç </h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'install'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'sw.js install'</span>);</div><div class=\"line\">    event.waitUntil(</div><div class=\"line\">        <span class=\"comment\">//è¿™é‡Œå…ˆä¸å¾€ç¼“å­˜ä¸­å†™</span></div><div class=\"line\">        caches.open(<span class=\"string\">'v1'</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cache</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> cache.addAll([</div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/index.html',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/js/main.js',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/json/data.json',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/images/1.jpg',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/images/2.jpg',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/child.html',</span></div><div class=\"line\">            ]);</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'fetch'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    event.respondWith(</div><div class=\"line\">        caches.match(event.request)</div><div class=\"line\">        .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (response) &#123;</div><div class=\"line\">                <span class=\"comment\">//å¦‚æœåŒ¹é…åˆ°äº†</span></div><div class=\"line\">                <span class=\"keyword\">return</span> response;</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"comment\">//å¦‚æœæœ‰èµ„æºæ²¡æœ‰åŒ¹é…(æ¯”å¦‚child.htmlé‡Œé¢çš„è·¨åŸŸå›¾ç‰‡),å°±å…ˆå‘è¯·æ±‚è®¿é—®,ç„¶åç¼“å­˜ä¸€ä»½</span></div><div class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">'url not match;'</span> + event.request.url);</div><div class=\"line\">                <span class=\"keyword\">return</span> fetch(event.request).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</div><div class=\"line\">                    <span class=\"built_in\">console</span>.log(response);</div><div class=\"line\">                    caches.open(<span class=\"string\">'v1'</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cache</span>) </span>&#123;</div><div class=\"line\">                        cache.put(event.request, response);</div><div class=\"line\">                    &#125;);</div><div class=\"line\">                    <span class=\"keyword\">return</span> response.clone();</div><div class=\"line\">                &#125;);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;)</div><div class=\"line\">        .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> fetch(event.request);</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'activate'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'activate'</span>)</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<p><a href=\"https://lh2907883.github.io/store/demo/service-workers/\">æ¼”ç¤ºåœ°å€</a></p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers\" target=\"_blank\" rel=\"external\">MDN ä½¿ç”¨ Service Workers</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨\"><a href=\"#ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨\"></a>ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨</h2><p>åœ¨æ­£å¸¸æƒ…å†µä¸‹,å®¢æˆ·ç«¯ä½¿ç”¨HTTPåè®®é€šè¿‡ç½‘ç»œå¾—åˆ°æœåŠ¡å™¨çš„èµ„æº,ç„¶åå±•ç¤º,ä½†æ˜¯å¦‚æœåœ¨ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹,å®¢æˆ·ç«¯å°±æ²¡åŠæ³•äº†,è¿™æ—¶å°±éœ€è¦ä¸€ç§æŠ€æœ¯å»è§£å†³è¿™ä¸€é—®é¢˜,ç›®å‰æœ‰ä¸¤ç§æ–¹å¼:<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache\" target=\"_blank\" rel=\"external\">AppCache</a>å’Œ<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers#Browser_compatibility\" target=\"_blank\" rel=\"external\">Service Workers</a>,ä»–ä»¬éƒ½æ˜¯é€šè¿‡åœ¨æ–­ç½‘æ—¶è¯»å–æœ¬åœ°ç¼“å­˜èµ„æºæ¥å®ç°webåº”ç”¨çš„ç¦»çº¿è®¿é—®çš„.</p>\n<h2 id=\"æ¯”è¾ƒAppCacheå’ŒService-Workers\"><a href=\"#æ¯”è¾ƒAppCacheå’ŒService-Workers\" class=\"headerlink\" title=\"æ¯”è¾ƒAppCacheå’ŒService Workers\"></a>æ¯”è¾ƒAppCacheå’ŒService Workers</h2><h3 id=\"ä½¿ç”¨æ–¹å¼\"><a href=\"#ä½¿ç”¨æ–¹å¼\" class=\"headerlink\" title=\"ä½¿ç”¨æ–¹å¼\"></a>ä½¿ç”¨æ–¹å¼</h3><p>AppCacheé€šè¿‡æŒ‡å®šç¼“å­˜æ¸…å•æ–‡ä»¶æ¥è®¾ç½®å“ªäº›èµ„æºéœ€è¦è¢«ç¼“å­˜</p>\n<p>Service Workersåˆ™æœ‰æ›´æ–°å¼ºå¤§çš„APIæ¥é€šè¿‡è„šæœ¬ç²¾å‡†æ§åˆ¶ç¼“å­˜(åŒ…æ‹¬æ›´æ–°,è¿½åŠ ,åˆ é™¤ç¼“å­˜)</p>\n<h3 id=\"å…¼å®¹æ€§\"><a href=\"#å…¼å®¹æ€§\" class=\"headerlink\" title=\"å…¼å®¹æ€§\"></a>å…¼å®¹æ€§</h3><p>ä¸‹å›¾æ˜¯å„å¤§æµè§ˆå™¨å¯¹AppCacheçš„æ”¯æŒæƒ…å†µ,å¯ä»¥çœ‹å‡ºåŸºæœ¬éƒ½æ”¯æŒ<br><img src=\"https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/1.png\" alt=\"\"></p>\n<p>è€ŒService Workersè¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒçš„(ç‰¹åˆ«æ˜¯ç§»åŠ¨å¹³å°)<br><img src=\"https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/2.png\" alt=\"\"></p>\n<h3 id=\"W3Cæ ‡å‡†\"><a href=\"#W3Cæ ‡å‡†\" class=\"headerlink\" title=\"W3Cæ ‡å‡†\"></a>W3Cæ ‡å‡†</h3><p>å¦‚æœä½ çœ‹è¿‡<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTML/Using_the_application_cache\" target=\"_blank\" rel=\"external\">AppCache</a>çš„æ–‡æ¡£,ä½ ä¼šå‘ç°</p>\n<blockquote>\n<p>è¯¥ç‰¹æ€§å·²ç»ä»Webæ ‡å‡†ä¸­åˆ é™¤ï¼Œè™½ç„¶ä¸€äº›æµè§ˆå™¨ç›®å‰ä»ç„¶æ”¯æŒå®ƒï¼Œä½†ä¹Ÿè®¸ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´åœæ­¢æ”¯æŒï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚</p>\n<p>åœ¨æ­¤åˆ»ä½¿ç”¨è¿™é‡Œæè¿°çš„åº”ç”¨ç¨‹åºç¼“å­˜åŠŸèƒ½é«˜åº¦ä¸é¼“åŠ±; å®ƒæ­£åœ¨å¤„äºä»Webå¹³å°ä¸­è¢«åˆ é™¤çš„è¿‡ç¨‹ã€‚è¯·æ”¹ç”¨<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers#Browser_compatibility\" target=\"_blank\" rel=\"external\">Service Workers</a>ä»£æ›¿ã€‚</p>\n</blockquote>\n<p>æˆ‘ä¸ªäººè®¤ä¸ºService Workerså„æ–¹é¢éƒ½è¦ä¼˜äºAppCache,é™¤äº†å…¼å®¹æ€§,ä¸è¿‡æ—¢ç„¶Service Workerså·²ç»æ˜¯W3Cæ ‡å‡†,æƒ³å¿…æœªæ¥çš„æ”¯æŒæƒ…å†µåº”è¯¥ä¼šå¥½ä¸€äº›,æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºService Workersçš„ç”¨æ³•</p>\n<h2 id=\"ä½¿ç”¨Service-Workersçš„å‰ææ¡ä»¶\"><a href=\"#ä½¿ç”¨Service-Workersçš„å‰ææ¡ä»¶\" class=\"headerlink\" title=\"ä½¿ç”¨Service Workersçš„å‰ææ¡ä»¶\"></a>ä½¿ç”¨Service Workersçš„å‰ææ¡ä»¶</h2><blockquote>\n<p>åœ¨å·²ç»æ”¯æŒ serivce workers çš„æµè§ˆå™¨çš„ç‰ˆæœ¬ä¸­, å¾ˆå¤šç‰¹æ€§æ²¡æœ‰é»˜è®¤å¼€å¯, éœ€è¦å¼€å¯ä¸€ä¸‹æµè§ˆå™¨çš„ç›¸å…³é…ç½®ï¼š</p>\n<ul>\n<li>Firefox Nightly: è®¿é—® about:config å¹¶è®¾ç½® dom.serviceWorkers.enabled çš„å€¼ä¸º true; é‡å¯æµè§ˆå™¨ï¼›</li>\n<li>Chrome Canary: è®¿é—® chrome://flags å¹¶å¼€å¯ experimental-web-platform-features; é‡å¯æµè§ˆå™¨ (æ³¨æ„ï¼šæœ‰äº›ç‰¹æ€§åœ¨Chromeä¸­æ²¡æœ‰é»˜è®¤å¼€æ”¾æ”¯æŒ)ï¼›</li>\n<li>Opera: è®¿é—® opera://flags å¹¶å¼€å¯ ServiceWorker çš„æ”¯æŒ; é‡å¯æµè§ˆå™¨ã€‚ </li>\n</ul>\n<p>å¦å¤–ï¼Œä½ éœ€è¦é€šè¿‡ <strong>HTTPS</strong> æ¥è®¿é—®ä½ çš„é¡µé¢ â€” å‡ºäºå®‰å…¨åŸå› ï¼ŒService Workers è¦æ±‚è¦åœ¨å¿…é¡»åœ¨ HTTPS ä¸‹æ‰èƒ½è¿è¡Œã€‚Github æ˜¯ä¸ªç”¨æ¥æµ‹è¯•çš„å¥½åœ°æ–¹ï¼Œå› ä¸ºå®ƒå°±æ”¯æŒHTTPSã€‚ä¸ºäº†ä¾¿äºæœ¬åœ°å¼€å‘ï¼Œlocalhost ä¹Ÿè¢«æµè§ˆå™¨è®¤ä¸ºæ˜¯å®‰å…¨æºã€‚</p>\n</blockquote>\n<h2 id=\"å¦‚ä½•ä½¿ç”¨\"><a href=\"#å¦‚ä½•ä½¿ç”¨\" class=\"headerlink\" title=\"å¦‚ä½•ä½¿ç”¨\"></a>å¦‚ä½•ä½¿ç”¨</h2><h3 id=\"æ³¨å†Œservice-worker\"><a href=\"#æ³¨å†Œservice-worker\" class=\"headerlink\" title=\"æ³¨å†Œservice worker\"></a>æ³¨å†Œservice worker</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * @scriptURL ServiceWorkerè„šæœ¬èµ„æºè·¯å¾„(å¯ä»¥æ˜¯ç»å¯¹æˆ–è€…ç›¸å¯¹å½“å‰URLçš„è·¯å¾„)</div><div class=\"line\"> * @options &#123;scope: './'&#125; scopeæ˜¯ä¸€ä¸ªè·¯å¾„,é»˜è®¤å€¼å°±æ˜¯'./',å®ƒæ€»æ˜¯ç›¸å¯¹äºServiceWorkerè„šæœ¬èµ„æºè·¯å¾„çš„,scopeæŒ‡å®šäº†ä¸€ä¸ªServiceWorkerçš„ç”Ÿæ•ˆèŒƒå›´,åªæœ‰åœ¨è¿™ä¸ªè·¯å¾„èŒƒå›´å†…çš„èµ„æºæ‰èƒ½æ”¯æŒç¦»çº¿è®¿é—®(æ‰€ä»¥è·¨åŸŸçš„èµ„æºæ˜¯æ²¡æ³•ç¦»çº¿è®¿é—®çš„)</div><div class=\"line\"> */</div><div class=\"line\">ServiceWorkerContainer.register(scriptURL, options)</div><div class=\"line\">    .then(</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">ServiceWorkerRegistration</span>) </span>&#123;</div><div class=\"line\">            <span class=\"comment\">// do something</span></div><div class=\"line\">        &#125;</div><div class=\"line\">);</div></pre></td></tr></table></figure>\n<p>ä»£ç å¦‚ä¸‹:<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//å…¼å®¹æ€§åˆ¤æ–­</span></div><div class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">'serviceWorker'</span> <span class=\"keyword\">in</span> navigator) &#123;</div><div class=\"line\">    navigator.serviceWorker.register(<span class=\"string\">'sw.js'</span>, &#123;<span class=\"attr\">scope</span>: <span class=\"string\">'./'</span>&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">reg</span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (reg.installing) &#123;</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Service worker installing'</span>);</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (reg.waiting) &#123;</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Service worker installed'</span>);</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (reg.active) &#123;</div><div class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Service worker active'</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// registration failed</span></div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'Registration failed with '</span> + error);</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>äº‹å®ä¸Šå½“æµè§ˆå™¨è¿è¡Œä¸Šé¢çš„ä»£ç æ—¶, ä¼šå…ˆæ£€æµ‹æ˜¯å¦ä¹‹å‰å°±è·å–å¹¶æ³¨å†Œè¿‡<strong>sw.js</strong></p>\n<ul>\n<li>å¦‚æœæ˜¯<strong>é¦–æ¬¡è¿è¡Œ</strong>,é‚£å°±å…ˆä¸‹è½½å¹¶ä¿å­˜åœ¨æœ¬åœ°, chromeä¸­å¯ä»¥åœ¨<em>Application -&gt; Service Workers</em>é¢æ¿ä¸­æŸ¥çœ‹<br><img src=\"https://lh2907883.github.io/store/blog/web%E7%A6%BB%E7%BA%BF%E5%BA%94%E7%94%A8/3.png\" alt=\"\"><br>è¿™æ—¶ä¼šè§¦å‘Service Workerçš„<code>install</code>äº‹ä»¶,ä¹‹åä¼šè¿›å…¥<code>navigator.serviceWorker.register</code>è¿”å›çš„<code>Promise.then</code>,çŠ¶æ€<code>state</code>ä¸º<code>installing</code>. </li>\n<li>å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰<strong>sw.js</strong> <em>(å³ä½¿æœ¬åœ°çš„<strong>sw.js</strong>ä¸æ˜¯æœ€æ–°ä»£ç ,è¿™æ¬¡è®¿é—®ä»»ç„¶ä¼šä½¿ç”¨æœ¬åœ°<strong>sw.js</strong>çš„ä»£ç )</em>,é‚£ä¹ˆä¼šç›´æ¥è¿›å…¥<code>navigator.serviceWorker.register</code>è¿”å›çš„<code>Promise.then</code>,çŠ¶æ€<code>state</code>ä¸º<code>activated</code>,è¿™æ—¶Service Workerä¸ºå·²æ¿€æ´»çŠ¶æ€,åé¢åªè¦æ˜¯æœ‰<code>scope</code>èŒƒå›´å†…çš„è¯·æ±‚éƒ½ä¼šè¢«Service Workerçš„<code>fetch</code>äº‹ä»¶æ‹¦æˆª<em>(æ³¨æ„:å¦‚æœåœ¨scopeä¸‹çš„htmlé¡µé¢è®¿é—®äº†è·¨åŸŸçš„èµ„æº,æ¯”å¦‚å›¾ç‰‡ä»€ä¹ˆçš„,é‚£è¿™ä¸ªè·¨åŸŸèµ„æºè¯·æ±‚ä¹Ÿä¼šè¢«æ‹¦æˆª)</em>,åœ¨<code>fetch</code>çš„å›è°ƒå‡½æ•°é‡Œé¢ä½ å¯ä»¥è‡ªè¡Œæ§åˆ¶æ˜¯<strong>è¯»ç¼“å­˜</strong>,è¿˜æ˜¯<strong>è¯·æ±‚ç½‘ç»œ</strong>,ä½ ç”šè‡³å¯ä»¥<strong>ä¼ªé€ å“åº”æ•°æ®</strong> <em>(æˆ‘æƒ³è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆService Workeråªæ”¯æŒHTTPSçš„åŸå› )</em></li>\n<li>å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰<strong>sw.js</strong>å¹¶ä¸”æœ¬åœ°çš„<strong>sw.js</strong>ä¸æ˜¯æœ€æ–°ä»£ç ,é‚£ä¹ˆ<strong>sw.js</strong>ä¼šè‡ªåŠ¨æ›´æ–°,å¹¶è§¦å‘Service Workerçš„<code>install</code>äº‹ä»¶,åœ¨ä¸‹æ¬¡è®¿é—®é¡µé¢æ—¶å°†ä½¿ç”¨æ–°ç‰ˆæœ¬çš„<strong>sw.js</strong>.</li>\n</ul>\n<h3 id=\"å…³äºsw-js\"><a href=\"#å…³äºsw-js\" class=\"headerlink\" title=\"å…³äºsw.js\"></a>å…³äºsw.js</h3><h4 id=\"sw-jsçš„èŒè´£\"><a href=\"#sw-jsçš„èŒè´£\" class=\"headerlink\" title=\"sw.jsçš„èŒè´£\"></a>sw.jsçš„èŒè´£</h4><p>ä»ä¸Šé¢çš„æè¿°,æˆ‘ä»¬å¯ä»¥çœ‹å‡º<strong>sw.js</strong>çš„èŒè´£å…¶å®æ˜¯æ§åˆ¶webåº”ç”¨ä¸­èµ„æºçš„è®¿é—®ç­–ç•¥,ä»–å’Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘,UIæ“ä½œéƒ½æ²¡æœ‰ä»»ä½•å…³ç³»,å®˜æ–¹è¯´æ˜:</p>\n<blockquote>\n<p>å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œservice worker å°±åœ¨ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/ServiceWorkerGlobalScope\" target=\"_blank\" rel=\"external\">ServiceWorkerGlobalScope</a> ç¯å¢ƒä¸­è¿è¡Œï¼› è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„ woker ä¸Šä¸‹æ–‡è¿è¡Œç¯å¢ƒï¼Œä¸ä¸»è¿è¡Œçº¿ç¨‹ï¼ˆæ‰§è¡Œè„šæœ¬ï¼‰ç›¸ç‹¬ç«‹ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è®¿é—® DOM çš„èƒ½åŠ›ã€‚</p>\n</blockquote>\n<h4 id=\"å…·ä½“å®ç°\"><a href=\"#å…·ä½“å®ç°\" class=\"headerlink\" title=\"å…·ä½“å®ç°\"></a>å…·ä½“å®ç°</h4><ul>\n<li>æ³¨å†Œinstalläº‹ä»¶<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'install'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//console.log('sw.js install');</span></div><div class=\"line\">    event.waitUntil(</div><div class=\"line\">        caches.open(<span class=\"string\">'v1'</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cache</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> cache.addAll([</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/index.html'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/js/main.js'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/json/data.json'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/images/1.jpg'</span>,</div><div class=\"line\">                <span class=\"string\">'/demo/service-workers/images/2.jpg'</span>,</div><div class=\"line\">            ]);</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<blockquote>\n<p>install äº‹ä»¶ä¸€èˆ¬æ˜¯è¢«ç”¨æ¥å¡«å……ä½ çš„æµè§ˆå™¨çš„ç¦»çº¿ç¼“å­˜èƒ½åŠ›ã€‚ä¸ºäº†è¾¾æˆè¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Service Worker çš„ æ–°çš„æ ‡å¿—æ€§çš„å­˜å‚¨ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache\" target=\"_blank\" rel=\"external\">API â€” cache</a> â€” ä¸€ä¸ª service worker ä¸Šçš„å…¨å±€å¯¹è±¡ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥å­˜å‚¨ç½‘ç»œå“åº”å‘æ¥çš„èµ„æºï¼Œå¹¶ä¸”æ ¹æ®å®ƒä»¬çš„è¯·æ±‚æ¥ç”Ÿæˆkeyã€‚è¿™ä¸ª API å’Œæµè§ˆå™¨çš„æ ‡å‡†çš„ç¼“å­˜å·¥ä½œåŸç†å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯ç‰¹å®šä½ çš„åŸŸçš„ã€‚å®ƒä¼šä¸€ç›´æŒä¹…å­˜åœ¨ï¼Œç›´åˆ°ä½ å‘Šè¯‰å®ƒä¸å†å­˜å‚¨ï¼Œä½ æ‹¥æœ‰å…¨éƒ¨çš„æ§åˆ¶æƒã€‚<br>æ³¨æ„:  Cache API  å¹¶ä¸è¢«æ¯ä¸ªæµè§ˆå™¨æ”¯æŒã€‚ï¼ˆæŸ¥çœ‹ Browser support  éƒ¨åˆ†äº†è§£æ›´å¤šä¿¡æ¯ã€‚ï¼‰ å¦‚æœä½ ç°åœ¨å°±æƒ³ä½¿ç”¨å®ƒï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä¸€ä¸ª polyfillï¼Œæ¯”å¦‚ <a href=\"https://github.com/Polymer/topeka/blob/master/sw.js\" target=\"_blank\" rel=\"external\">Google topeka demo</a>ï¼Œæˆ–è€…æŠŠä½ çš„èµ„æºå­˜å‚¨åœ¨ <a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/IndexedDB\" target=\"_blank\" rel=\"external\">IndexedDB</a> ä¸­ã€‚</p>\n</blockquote>\n<p>ç¼“å­˜æ–¹æ¡ˆæœ‰å¾ˆå¤šç§, ç¤ºä¾‹ä»£ç ä¸­é‡‡ç”¨<code>Cache</code>, å€¼å¾—æ³¨æ„çš„æ˜¯<code>cache.addAll</code>å¯ä¸ä»…ä»…åªæ˜¯è®°å½•éœ€è¦ç¼“å­˜çš„èµ„æºURLåˆ—è¡¨, å®ƒåŒæ—¶è¿˜ä¼š<code>fetch</code>è¿™äº›èµ„æºæŠŠå“åº”æ•°æ®ç¼“å­˜èµ·æ¥,ä»¥ä¾¿åé¢è®¿é—®çš„æ—¶å€™ä½¿ç”¨ <em>(å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„webåº”ç”¨,ä¸ªäººè§‰å¾—æœ‰äº›ä¸å¤ªåˆç†,è°åˆä¼šåœ¨é¡µé¢åˆšåˆšè¿›æ¥æ—¶å°±åŠ è½½æ‰€æœ‰èµ„æºå‘¢?)</em></p>\n<ul>\n<li>æ³¨å†Œfetchäº‹ä»¶<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'fetch'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//console.log(event.request);</span></div><div class=\"line\">    <span class=\"comment\">//console.log(caches);</span></div><div class=\"line\">    event.respondWith(</div><div class=\"line\">        caches.match(event.request)</div><div class=\"line\">        .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> fetch(event.request);</div><div class=\"line\">        &#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</div><div class=\"line\">            <span class=\"comment\">//console.log(response);</span></div><div class=\"line\">            caches.open(<span class=\"string\">'v1'</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cache</span>) </span>&#123;</div><div class=\"line\">                <span class=\"comment\">//console.log(cache);</span></div><div class=\"line\">                cache.put(event.request, response);</div><div class=\"line\">            &#125;);</div><div class=\"line\">            <span class=\"keyword\">return</span> response.clone();</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ol>\n<li><code>event.respondWith</code>æ¥å—ä¸€ä¸ªè¿”å›responseå“åº”çš„Promise</li>\n<li><code>caches.match</code>ä¼šå°è¯•åœ¨ç¼“å­˜ä¸­åŒ¹é…å½“å‰fetchçš„è¯·æ±‚,åŒ¹é…åˆ°äº†å°±ç›´æ¥è¿”å›response</li>\n<li><code>cache.put</code>åˆ™æ˜¯æ›´æ–°ç¼“å­˜</li>\n</ol>\n<ul>\n<li>æ³¨å†Œactivateäº‹ä»¶<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'activate'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> cacheWhitelist = [<span class=\"string\">'v2'</span>];</div><div class=\"line\"></div><div class=\"line\">    event.waitUntil(</div><div class=\"line\">        caches.keys().then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">keyList</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all(keyList.map(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">key</span>) </span>&#123;</div><div class=\"line\">                <span class=\"keyword\">if</span> (cacheWhitelist.indexOf(key) === <span class=\"number\">-1</span>) &#123;</div><div class=\"line\">                    <span class=\"keyword\">return</span> caches.delete(key);</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;));</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>activateäº‹ä»¶å›è°ƒä¸€èˆ¬è¢«ç”¨æ¥åˆ é™¤æ—§çš„ç¼“å­˜</p>\n<h4 id=\"æ”¹è¿›åçš„ä»£ç \"><a href=\"#æ”¹è¿›åçš„ä»£ç \" class=\"headerlink\" title=\"æ”¹è¿›åçš„ä»£ç \"></a>æ”¹è¿›åçš„ä»£ç </h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'install'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'sw.js install'</span>);</div><div class=\"line\">    event.waitUntil(</div><div class=\"line\">        <span class=\"comment\">//è¿™é‡Œå…ˆä¸å¾€ç¼“å­˜ä¸­å†™</span></div><div class=\"line\">        caches.open(<span class=\"string\">'v1'</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cache</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> cache.addAll([</div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/index.html',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/js/main.js',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/json/data.json',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/images/1.jpg',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/images/2.jpg',</span></div><div class=\"line\">                <span class=\"comment\">// '/demo/service-workers/child.html',</span></div><div class=\"line\">            ]);</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'fetch'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    event.respondWith(</div><div class=\"line\">        caches.match(event.request)</div><div class=\"line\">        .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (response) &#123;</div><div class=\"line\">                <span class=\"comment\">//å¦‚æœåŒ¹é…åˆ°äº†</span></div><div class=\"line\">                <span class=\"keyword\">return</span> response;</div><div class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">                <span class=\"comment\">//å¦‚æœæœ‰èµ„æºæ²¡æœ‰åŒ¹é…(æ¯”å¦‚child.htmlé‡Œé¢çš„è·¨åŸŸå›¾ç‰‡),å°±å…ˆå‘è¯·æ±‚è®¿é—®,ç„¶åç¼“å­˜ä¸€ä»½</span></div><div class=\"line\">                <span class=\"built_in\">console</span>.log(<span class=\"string\">'url not match;'</span> + event.request.url);</div><div class=\"line\">                <span class=\"keyword\">return</span> fetch(event.request).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</div><div class=\"line\">                    <span class=\"built_in\">console</span>.log(response);</div><div class=\"line\">                    caches.open(<span class=\"string\">'v1'</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">cache</span>) </span>&#123;</div><div class=\"line\">                        cache.put(event.request, response);</div><div class=\"line\">                    &#125;);</div><div class=\"line\">                    <span class=\"keyword\">return</span> response.clone();</div><div class=\"line\">                &#125;);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;)</div><div class=\"line\">        .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> fetch(event.request);</div><div class=\"line\">        &#125;)</div><div class=\"line\">    );</div><div class=\"line\">&#125;);</div><div class=\"line\"><span class=\"keyword\">this</span>.addEventListener(<span class=\"string\">'activate'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>) </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'activate'</span>)</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<p><a href=\"https://lh2907883.github.io/store/demo/service-workers/\">æ¼”ç¤ºåœ°å€</a></p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API/Using_Service_Workers\" target=\"_blank\" rel=\"external\">MDN ä½¿ç”¨ Service Workers</a></li>\n</ul>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cj2n3r71e000410txnc27anrb","tag_id":"cj2n3r71k000510tx2z980zus","_id":"cj2n3r71q000610txvv1lfjl5"},{"post_id":"cj2oermi00000vytxlkmlsfuy","tag_id":"cj2n3r71k000510tx2z980zus","_id":"cj2oermi20001vytx3d1ko5px"}],"Tag":[{"name":"javascript","_id":"cj2n3r71k000510tx2z980zus"}]}}