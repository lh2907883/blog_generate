{"meta":{"title":"dcsçš„åšå®¢","subtitle":"å°½é‡ä¸çå†™","description":"å°½é‡ä¸çå†™","author":"lihao","url":"http://lh2907883.github.io/blog"},"pages":[],"posts":[{"title":"webç¦»çº¿åº”ç”¨","slug":"webç¦»çº¿åº”ç”¨","date":"2017-05-14T07:57:53.000Z","updated":"2017-05-14T09:02:29.000Z","comments":true,"path":"2017/05/14/webç¦»çº¿åº”ç”¨/","link":"","permalink":"http://lh2907883.github.io/blog/2017/05/14/webç¦»çº¿åº”ç”¨/","excerpt":"","text":"ä»€ä¹ˆæ˜¯webç¦»çº¿åº”ç”¨åœ¨æ­£å¸¸æƒ…å†µä¸‹,å®¢æˆ·ç«¯ä½¿ç”¨HTTPåè®®é€šè¿‡ç½‘ç»œå¾—åˆ°æœåŠ¡å™¨çš„èµ„æº,ç„¶åå±•ç¤º,ä½†æ˜¯å¦‚æœåœ¨ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹,å®¢æˆ·ç«¯å°±æ²¡åŠæ³•äº†,è¿™æ—¶å°±éœ€è¦ä¸€ç§æŠ€æœ¯å»è§£å†³è¿™ä¸€é—®é¢˜,ç›®å‰æœ‰ä¸¤ç§æ–¹å¼:AppCacheå’ŒService Workers,ä»–ä»¬éƒ½æ˜¯é€šè¿‡åœ¨æ–­ç½‘æ—¶è¯»å–æœ¬åœ°ç¼“å­˜èµ„æºæ¥å®ç°webåº”ç”¨çš„ç¦»çº¿è®¿é—®çš„. æ¯”è¾ƒAppCacheå’ŒService Workersä½¿ç”¨æ–¹å¼AppCacheé€šè¿‡æŒ‡å®šç¼“å­˜æ¸…å•æ–‡ä»¶æ¥è®¾ç½®å“ªäº›èµ„æºéœ€è¦è¢«ç¼“å­˜ Service Workersåˆ™æœ‰æ›´æ–°å¼ºå¤§çš„APIæ¥é€šè¿‡è„šæœ¬ç²¾å‡†æ§åˆ¶ç¼“å­˜(åŒ…æ‹¬æ›´æ–°,è¿½åŠ ,åˆ é™¤ç¼“å­˜) å…¼å®¹æ€§ä¸‹å›¾æ˜¯å„å¤§æµè§ˆå™¨å¯¹AppCacheçš„æ”¯æŒæƒ…å†µ,å¯ä»¥çœ‹å‡ºåŸºæœ¬éƒ½æ”¯æŒ è€ŒService Workersè¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒçš„(ç‰¹åˆ«æ˜¯ç§»åŠ¨å¹³å°) W3Cæ ‡å‡†å¦‚æœä½ çœ‹è¿‡AppCacheçš„æ–‡æ¡£,ä½ ä¼šå‘ç° è¯¥ç‰¹æ€§å·²ç»ä»Webæ ‡å‡†ä¸­åˆ é™¤ï¼Œè™½ç„¶ä¸€äº›æµè§ˆå™¨ç›®å‰ä»ç„¶æ”¯æŒå®ƒï¼Œä½†ä¹Ÿè®¸ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´åœæ­¢æ”¯æŒï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚ åœ¨æ­¤åˆ»ä½¿ç”¨è¿™é‡Œæè¿°çš„åº”ç”¨ç¨‹åºç¼“å­˜åŠŸèƒ½é«˜åº¦ä¸é¼“åŠ±; å®ƒæ­£åœ¨å¤„äºä»Webå¹³å°ä¸­è¢«åˆ é™¤çš„è¿‡ç¨‹ã€‚è¯·æ”¹ç”¨Service Workersä»£æ›¿ã€‚ æˆ‘ä¸ªäººè®¤ä¸ºService Workerså„æ–¹é¢éƒ½è¦ä¼˜äºAppCache,é™¤äº†å…¼å®¹æ€§,ä¸è¿‡æ—¢ç„¶Service Workerså·²ç»æ˜¯W3Cæ ‡å‡†,æƒ³å¿…æœªæ¥çš„æ”¯æŒæƒ…å†µåº”è¯¥ä¼šå¥½ä¸€äº›,æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºService Workersçš„ç”¨æ³• ä½¿ç”¨Service Workersçš„å‰ææ¡ä»¶ åœ¨å·²ç»æ”¯æŒ serivce workers çš„æµè§ˆå™¨çš„ç‰ˆæœ¬ä¸­, å¾ˆå¤šç‰¹æ€§æ²¡æœ‰é»˜è®¤å¼€å¯, éœ€è¦å¼€å¯ä¸€ä¸‹æµè§ˆå™¨çš„ç›¸å…³é…ç½®ï¼š Firefox Nightly: è®¿é—® about:config å¹¶è®¾ç½® dom.serviceWorkers.enabled çš„å€¼ä¸º true; é‡å¯æµè§ˆå™¨ï¼› Chrome Canary: è®¿é—® chrome://flags å¹¶å¼€å¯ experimental-web-platform-features; é‡å¯æµè§ˆå™¨ (æ³¨æ„ï¼šæœ‰äº›ç‰¹æ€§åœ¨Chromeä¸­æ²¡æœ‰é»˜è®¤å¼€æ”¾æ”¯æŒ)ï¼› Opera: è®¿é—® opera://flags å¹¶å¼€å¯ ServiceWorker çš„æ”¯æŒ; é‡å¯æµè§ˆå™¨ã€‚ å¦å¤–ï¼Œä½ éœ€è¦é€šè¿‡ HTTPS æ¥è®¿é—®ä½ çš„é¡µé¢ â€” å‡ºäºå®‰å…¨åŸå› ï¼ŒService Workers è¦æ±‚è¦åœ¨å¿…é¡»åœ¨ HTTPS ä¸‹æ‰èƒ½è¿è¡Œã€‚Github æ˜¯ä¸ªç”¨æ¥æµ‹è¯•çš„å¥½åœ°æ–¹ï¼Œå› ä¸ºå®ƒå°±æ”¯æŒHTTPSã€‚ä¸ºäº†ä¾¿äºæœ¬åœ°å¼€å‘ï¼Œlocalhost ä¹Ÿè¢«æµè§ˆå™¨è®¤ä¸ºæ˜¯å®‰å…¨æºã€‚ å¦‚ä½•ä½¿ç”¨æ³¨å†Œservice worker12345678910/** * @scriptURL ServiceWorkerè„šæœ¬èµ„æºè·¯å¾„(å¯ä»¥æ˜¯ç»å¯¹æˆ–è€…ç›¸å¯¹å½“å‰URLçš„è·¯å¾„) * @options &#123;scope: './'&#125; scopeæ˜¯ä¸€ä¸ªè·¯å¾„,é»˜è®¤å€¼å°±æ˜¯'./',å®ƒæ€»æ˜¯ç›¸å¯¹äºServiceWorkerè„šæœ¬èµ„æºè·¯å¾„çš„,scopeæŒ‡å®šäº†ä¸€ä¸ªServiceWorkerçš„ç”Ÿæ•ˆèŒƒå›´,åªæœ‰åœ¨è¿™ä¸ªè·¯å¾„èŒƒå›´å†…çš„èµ„æºæ‰èƒ½æ”¯æŒç¦»çº¿è®¿é—®(æ‰€ä»¥è·¨åŸŸçš„èµ„æºæ˜¯æ²¡æ³•ç¦»çº¿è®¿é—®çš„) */ServiceWorkerContainer.register(scriptURL, options) .then( function(ServiceWorkerRegistration) &#123; // do something &#125;); ä»£ç å¦‚ä¸‹:123456789101112131415//å…¼å®¹æ€§åˆ¤æ–­if ('serviceWorker' in navigator) &#123; navigator.serviceWorker.register('sw.js', &#123;scope: './'&#125;).then(function(reg) &#123; if (reg.installing) &#123; console.log('Service worker installing'); &#125; else if (reg.waiting) &#123; console.log('Service worker installed'); &#125; else if (reg.active) &#123; console.log('Service worker active'); &#125; &#125;).catch(function(error) &#123; // registration failed console.log('Registration failed with ' + error); &#125;);&#125; äº‹å®ä¸Šå½“æµè§ˆå™¨è¿è¡Œä¸Šé¢çš„ä»£ç æ—¶, ä¼šå…ˆæ£€æµ‹æ˜¯å¦ä¹‹å‰å°±è·å–å¹¶æ³¨å†Œè¿‡sw.js å¦‚æœæ˜¯é¦–æ¬¡è¿è¡Œ,é‚£å°±å…ˆä¸‹è½½å¹¶ä¿å­˜åœ¨æœ¬åœ°, chromeä¸­å¯ä»¥åœ¨Application -&gt; Service Workersé¢æ¿ä¸­æŸ¥çœ‹è¿™æ—¶ä¼šè§¦å‘Service Workerçš„installäº‹ä»¶,ä¹‹åä¼šè¿›å…¥navigator.serviceWorker.registerè¿”å›çš„Promise.then,çŠ¶æ€stateä¸ºinstalling. å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰sw.js (å³ä½¿æœ¬åœ°çš„sw.jsä¸æ˜¯æœ€æ–°ä»£ç ,è¿™æ¬¡è®¿é—®ä»»ç„¶ä¼šä½¿ç”¨æœ¬åœ°sw.jsçš„ä»£ç ),é‚£ä¹ˆä¼šç›´æ¥è¿›å…¥navigator.serviceWorker.registerè¿”å›çš„Promise.then,çŠ¶æ€stateä¸ºactivated,è¿™æ—¶Service Workerä¸ºå·²æ¿€æ´»çŠ¶æ€,åé¢åªè¦æ˜¯æœ‰scopeèŒƒå›´å†…çš„è¯·æ±‚éƒ½ä¼šè¢«Service Workerçš„fetchäº‹ä»¶æ‹¦æˆª(æ³¨æ„:å¦‚æœåœ¨scopeä¸‹çš„htmlé¡µé¢è®¿é—®äº†è·¨åŸŸçš„èµ„æº,æ¯”å¦‚å›¾ç‰‡ä»€ä¹ˆçš„,é‚£è¿™ä¸ªè·¨åŸŸèµ„æºè¯·æ±‚ä¹Ÿä¼šè¢«æ‹¦æˆª),åœ¨fetchçš„å›è°ƒå‡½æ•°é‡Œé¢ä½ å¯ä»¥è‡ªè¡Œæ§åˆ¶æ˜¯è¯»ç¼“å­˜,è¿˜æ˜¯è¯·æ±‚ç½‘ç»œ,ä½ ç”šè‡³å¯ä»¥ä¼ªé€ å“åº”æ•°æ® (æˆ‘æƒ³è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆService Workeråªæ”¯æŒHTTPSçš„åŸå› ) å¦‚æœå‘ç°æœ¬åœ°å·²ç»æœ‰sw.jså¹¶ä¸”æœ¬åœ°çš„sw.jsä¸æ˜¯æœ€æ–°ä»£ç ,é‚£ä¹ˆsw.jsä¼šè‡ªåŠ¨æ›´æ–°,å¹¶è§¦å‘Service Workerçš„installäº‹ä»¶,åœ¨ä¸‹æ¬¡è®¿é—®é¡µé¢æ—¶å°†ä½¿ç”¨æ–°ç‰ˆæœ¬çš„sw.js. å…³äºsw.jssw.jsçš„èŒè´£ä»ä¸Šé¢çš„æè¿°,æˆ‘ä»¬å¯ä»¥çœ‹å‡ºsw.jsçš„èŒè´£å…¶å®æ˜¯æ§åˆ¶webåº”ç”¨ä¸­èµ„æºçš„è®¿é—®ç­–ç•¥,ä»–å’Œå…·ä½“çš„ä¸šåŠ¡é€»è¾‘,UIæ“ä½œéƒ½æ²¡æœ‰ä»»ä½•å…³ç³»,å®˜æ–¹è¯´æ˜: å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œservice worker å°±åœ¨ ServiceWorkerGlobalScope ç¯å¢ƒä¸­è¿è¡Œï¼› è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„ woker ä¸Šä¸‹æ–‡è¿è¡Œç¯å¢ƒï¼Œä¸ä¸»è¿è¡Œçº¿ç¨‹ï¼ˆæ‰§è¡Œè„šæœ¬ï¼‰ç›¸ç‹¬ç«‹ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è®¿é—® DOM çš„èƒ½åŠ›ã€‚ å…·ä½“å®ç° æ³¨å†Œinstalläº‹ä»¶123456789101112131415this.addEventListener('install', function(event) &#123; //console.log('sw.js install'); event.waitUntil( caches.open('v1').then(function(cache) &#123; return cache.addAll([ '/demo/service-workers/', '/demo/service-workers/index.html', '/demo/service-workers/js/main.js', '/demo/service-workers/json/data.json', '/demo/service-workers/images/1.jpg', '/demo/service-workers/images/2.jpg', ]); &#125;) );&#125;); install äº‹ä»¶ä¸€èˆ¬æ˜¯è¢«ç”¨æ¥å¡«å……ä½ çš„æµè§ˆå™¨çš„ç¦»çº¿ç¼“å­˜èƒ½åŠ›ã€‚ä¸ºäº†è¾¾æˆè¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Service Worker çš„ æ–°çš„æ ‡å¿—æ€§çš„å­˜å‚¨ API â€” cache â€” ä¸€ä¸ª service worker ä¸Šçš„å…¨å±€å¯¹è±¡ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥å­˜å‚¨ç½‘ç»œå“åº”å‘æ¥çš„èµ„æºï¼Œå¹¶ä¸”æ ¹æ®å®ƒä»¬çš„è¯·æ±‚æ¥ç”Ÿæˆkeyã€‚è¿™ä¸ª API å’Œæµè§ˆå™¨çš„æ ‡å‡†çš„ç¼“å­˜å·¥ä½œåŸç†å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ˜¯ç‰¹å®šä½ çš„åŸŸçš„ã€‚å®ƒä¼šä¸€ç›´æŒä¹…å­˜åœ¨ï¼Œç›´åˆ°ä½ å‘Šè¯‰å®ƒä¸å†å­˜å‚¨ï¼Œä½ æ‹¥æœ‰å…¨éƒ¨çš„æ§åˆ¶æƒã€‚æ³¨æ„: Cache API å¹¶ä¸è¢«æ¯ä¸ªæµè§ˆå™¨æ”¯æŒã€‚ï¼ˆæŸ¥çœ‹ Browser support éƒ¨åˆ†äº†è§£æ›´å¤šä¿¡æ¯ã€‚ï¼‰ å¦‚æœä½ ç°åœ¨å°±æƒ³ä½¿ç”¨å®ƒï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä¸€ä¸ª polyfillï¼Œæ¯”å¦‚ Google topeka demoï¼Œæˆ–è€…æŠŠä½ çš„èµ„æºå­˜å‚¨åœ¨ IndexedDB ä¸­ã€‚ ç¼“å­˜æ–¹æ¡ˆæœ‰å¾ˆå¤šç§, ç¤ºä¾‹ä»£ç ä¸­é‡‡ç”¨Cache, å€¼å¾—æ³¨æ„çš„æ˜¯cache.addAllå¯ä¸ä»…ä»…åªæ˜¯è®°å½•éœ€è¦ç¼“å­˜çš„èµ„æºURLåˆ—è¡¨, å®ƒåŒæ—¶è¿˜ä¼šfetchè¿™äº›èµ„æºæŠŠå“åº”æ•°æ®ç¼“å­˜èµ·æ¥,ä»¥ä¾¿åé¢è®¿é—®çš„æ—¶å€™ä½¿ç”¨ (å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„webåº”ç”¨,ä¸ªäººè§‰å¾—æœ‰äº›ä¸å¤ªåˆç†,è°åˆä¼šåœ¨é¡µé¢åˆšåˆšè¿›æ¥æ—¶å°±åŠ è½½æ‰€æœ‰èµ„æºå‘¢?) æ³¨å†Œfetchäº‹ä»¶1234567891011121314151617this.addEventListener('fetch', function(event) &#123; //console.log(event.request); //console.log(caches); event.respondWith( caches.match(event.request) .catch(function() &#123; return fetch(event.request); &#125;).then(function(response) &#123; //console.log(response); caches.open('v1').then(function(cache) &#123; //console.log(cache); cache.put(event.request, response); &#125;); return response.clone(); &#125;) );&#125;); event.respondWithæ¥å—ä¸€ä¸ªè¿”å›responseå“åº”çš„Promise caches.matchä¼šå°è¯•åœ¨ç¼“å­˜ä¸­åŒ¹é…å½“å‰fetchçš„è¯·æ±‚,åŒ¹é…åˆ°äº†å°±ç›´æ¥è¿”å›response cache.putåˆ™æ˜¯æ›´æ–°ç¼“å­˜ æ³¨å†Œactivateäº‹ä»¶12345678910111213this.addEventListener('activate', function(event) &#123; var cacheWhitelist = ['v2']; event.waitUntil( caches.keys().then(function(keyList) &#123; return Promise.all(keyList.map(function(key) &#123; if (cacheWhitelist.indexOf(key) === -1) &#123; return caches.delete(key); &#125; &#125;)); &#125;) );&#125;); activateäº‹ä»¶å›è°ƒä¸€èˆ¬è¢«ç”¨æ¥åˆ é™¤æ—§çš„ç¼“å­˜ æ”¹è¿›åçš„ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344this.addEventListener('install', function(event) &#123; console.log('sw.js install'); event.waitUntil( //è¿™é‡Œå…ˆä¸å¾€ç¼“å­˜ä¸­å†™ caches.open('v1').then(function(cache) &#123; return cache.addAll([ // '/demo/service-workers/', // '/demo/service-workers/index.html', // '/demo/service-workers/js/main.js', // '/demo/service-workers/json/data.json', // '/demo/service-workers/images/1.jpg', // '/demo/service-workers/images/2.jpg', // '/demo/service-workers/child.html', ]); &#125;) );&#125;);this.addEventListener('fetch', function(event) &#123; event.respondWith( caches.match(event.request) .then(function(response) &#123; if (response) &#123; //å¦‚æœåŒ¹é…åˆ°äº† return response; &#125; else &#123; //å¦‚æœæœ‰èµ„æºæ²¡æœ‰åŒ¹é…(æ¯”å¦‚child.htmlé‡Œé¢çš„è·¨åŸŸå›¾ç‰‡),å°±å…ˆå‘è¯·æ±‚è®¿é—®,ç„¶åç¼“å­˜ä¸€ä»½ console.log('url not match;' + event.request.url); return fetch(event.request).then(function(response) &#123; console.log(response); caches.open('v1').then(function(cache) &#123; cache.put(event.request, response); &#125;); return response.clone(); &#125;); &#125; &#125;) .catch(function() &#123; return fetch(event.request); &#125;) );&#125;);this.addEventListener('activate', function(event) &#123; console.log('activate')&#125;); æ¼”ç¤ºåœ°å€ å‚è€ƒèµ„æ–™ MDN ä½¿ç”¨ Service Workers","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"http://lh2907883.github.io/blog/tags/javascript/"}]},{"title":"å…³äºXMLHttpRequest","slug":"å…³äºXMLHttpRequest","date":"2017-05-07T04:37:45.000Z","updated":"2017-05-07T15:34:46.000Z","comments":true,"path":"2017/05/07/å…³äºXMLHttpRequest/","link":"","permalink":"http://lh2907883.github.io/blog/2017/05/07/å…³äºXMLHttpRequest/","excerpt":"","text":"XMLHttpRequestæ˜¯ä»€ä¹ˆXMLHttpRequest æ˜¯ä¸€ä¸ªAPI, å®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ AJAX ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚ å…¼å®¹æ€§ IE8/IE9ä¹Ÿå®Œå…¨ä¸æ”¯æŒxhrå¯¹è±¡, ä¸è¿‡å¯ä»¥ä½¿ç”¨ActiveXObjectç±»ç”Ÿæˆxhrå®ä¾‹ 1new window.ActiveXObject( \"Microsoft.XMLHTTP\" ) IE10/IE11éƒ¨åˆ†æ”¯æŒï¼Œä¸æ”¯æŒ xhr.responseTypeä¸ºjson å¦‚ä½•ä½¿ç”¨ä½¿ç”¨xhrç»™åå°serverå‘é€è¯·æ±‚,å¤§æ¦‚å¯ä»¥åˆ†ä¸‹é¢å‡ ä¸ªæ­¥éª¤ 1.å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡1var xhr = new XMLHttpRequest(); 2.åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚1xhr.open('POST', '/server', true); open(method, url [, async = true [, username = null [, password = null]]]) async: é»˜è®¤å€¼ä¸ºtrueï¼Œå³ä¸ºå¼‚æ­¥è¯·æ±‚ï¼Œè‹¥async=falseï¼Œåˆ™ä¸ºåŒæ­¥è¯·æ±‚ 3.è®¾ç½®xhrå‚æ•°3.1 è®¾ç½®request header é€šè¿‡è°ƒç”¨setRequestHeaderæ–¹æ³•,è®¾ç½®è¯·æ±‚å¤´,è¿™ä¸€æ­¥å¿…é¡»åœ¨xhr.openä¹‹åè°ƒç”¨ setRequestHeaderå¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›–overrideçš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ appendçš„æ–¹å¼123xhr.setRequestHeader('X-Test', 'one');xhr.setRequestHeader('X-Test', 'two');// æœ€ç»ˆrequest headerä¸­\"X-Test\"ä¸º: one, two 3.2 è®¾ç½®response type å¯ä»¥è®¾ç½®xhr.responseType,ä¸‹é¢æ˜¯responseTypeæ”¯æŒçš„ç±»å‹ å€¼ xhr.response æ•°æ®ç±»å‹ è¯´æ˜ â€œâ€ String é»˜è®¤å€¼(åœ¨ä¸è®¾ç½®responseTypeæ—¶) â€œtextâ€ String â€œdocumentâ€ Document å¯¹è±¡ å¸Œæœ›è¿”å› XML æ ¼å¼æ•°æ®æ—¶ä½¿ç”¨ â€œjsonâ€ javascript å¯¹è±¡ å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼ŒIE10/IE11ä¸æ”¯æŒ â€œblobâ€ Blobå¯¹è±¡ â€œarrayBufferâ€ ArrayBufferå¯¹è±¡ å®¢æˆ·ç«¯ä»£ç 12345678910var xhr = new XMLHttpRequest();xhr.open('GET', '/json');xhr.responseType = 'json';xhr.onreadystatechange = function(e) &#123; if (this.readyState == 4 &amp;&amp; this.status == 200) &#123; //é€šè¿‡xhr.responseå¯ä»¥æ‹¿åˆ°è¿”å›çš„jsonæ•°æ® console.log(this.response); &#125;&#125;;xhr.send(); æœåŠ¡ç«¯ä»£ç 12345if (req.url == '/json') &#123; res.writeHead(200, &#123; 'content-type': 'application/json' &#125;); res.write('&#123;\"a\": 123, \"b\": \"dcs\"&#125;'); res.end();&#125; é€šè¿‡è°ƒç”¨xhr.overrideMimeTypeæ–¹æ³•æ¥é‡å†™responseçš„content-type(ä¸è¿‡è¿™ä¸ªæ–¹æ³•æˆ‘è°ƒç”¨ä¹‹åå¹¶æ²¡æœ‰èµ·ä½œç”¨..) 3.3 è®¾ç½®è¯·æ±‚è¶…æ—¶å¯ä»¥è®¾ç½®xhr.timeout,æ¥è®¾ç½®è¶…æ—¶æ—¶é—´(å•ä½æ¯«ç§’),åœ¨xhr.send()æ–¹æ³•è°ƒç”¨åå¼€å§‹è®¡æ—¶ 3.4 è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ1234567891011121314xhr.onreadystatechange = function () &#123; switch(xhr.readyState)&#123; case 0://UNSENT,open()æ–¹æ³•æ²¡æœ‰è°ƒç”¨ break; case 1://OPENED,open()æ–¹æ³•å·²è¢«æˆåŠŸè°ƒç”¨,send()æ–¹æ³•è¿˜æœªè¢«è°ƒç”¨ã€‚ break; case 2://HEADERS_RECEIVED,send()æ–¹æ³•å·²ç»è¢«è°ƒç”¨, å“åº”å¤´å’Œå“åº”çŠ¶æ€å·²ç»è¿”å› break; case 3://LOADING,å“åº”ä½“ä¸‹è½½ä¸­,responseTextä¸­å·²ç»è·å–äº†éƒ¨åˆ†æ•°æ®. break; case 4://DONE,æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹å·²ç»å®Œæ¯•. break; &#125;&#125; 3.5 xhrçš„äº‹ä»¶ äº‹ä»¶ è§¦å‘æ¡ä»¶ onreadystatechange æ¯å½“xhr.readyStateæ”¹å˜æ—¶è§¦å‘ï¼›ä½†xhr.readyStateç”±é0å€¼å˜ä¸º0æ—¶ä¸è§¦å‘ã€‚ onloadstart è°ƒç”¨xhr.send()æ–¹æ³•åç«‹å³è§¦å‘ï¼Œè‹¥xhr.send()æœªè¢«è°ƒç”¨åˆ™ä¸ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚ onprogress xhr.upload.onprogressåœ¨ä¸Šä¼ é˜¶æ®µ(å³xhr.send()ä¹‹åï¼Œxhr.readystate=2ä¹‹å‰)è§¦å‘ï¼›xhr.onprogressåœ¨ä¸‹è½½é˜¶æ®µï¼ˆå³xhr.readystate=3æ—¶ï¼‰è§¦å‘ onload å½“è¯·æ±‚æˆåŠŸå®Œæˆæ—¶è§¦å‘ï¼Œæ­¤æ—¶xhr.readystate=4 onloadend å½“è¯·æ±‚ç»“æŸï¼ˆåŒ…æ‹¬è¯·æ±‚æˆåŠŸå’Œè¯·æ±‚å¤±è´¥ï¼‰æ—¶è§¦å‘ onabort å½“è°ƒç”¨xhr.abort()åè§¦å‘ ontimeout xhr.timeoutä¸ç­‰äº0ï¼Œç”±è¯·æ±‚å¼€å§‹å³onloadstartå¼€å§‹ç®—èµ·ï¼Œå½“åˆ°è¾¾xhr.timeoutæ‰€è®¾ç½®æ—¶é—´è¯·æ±‚è¿˜æœªç»“æŸå³onloadendï¼Œåˆ™è§¦å‘æ­¤äº‹ä»¶ã€‚ onerror åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œè‹¥å‘ç”ŸNetwork erroråˆ™ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼ˆè‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ è¿˜æ²¡æœ‰ç»“æŸï¼Œåˆ™ä¼šå…ˆè§¦å‘xhr.upload.onerrorï¼Œå†è§¦å‘xhr.onerrorï¼›è‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ å·²ç»ç»“æŸï¼Œåˆ™åªä¼šè§¦å‘xhr.onerrorï¼‰ã€‚æ³¨æ„ï¼Œåªæœ‰å‘ç”Ÿäº†ç½‘ç»œå±‚çº§åˆ«çš„å¼‚å¸¸æ‰ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼Œå¯¹äºåº”ç”¨å±‚çº§åˆ«çš„å¼‚å¸¸ï¼Œå¦‚å“åº”è¿”å›çš„xhr.statusCodeæ˜¯4xxæ—¶ï¼Œå¹¶ä¸å±äºNetwork errorï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘onerroräº‹ä»¶ï¼Œè€Œæ˜¯ä¼šè§¦å‘onloadäº‹ä»¶ã€‚ 4.å‘é€æ•°æ®1xhr.send(data); å¯¹äºGET/HEADè¯·æ±‚sendæ–¹æ³•é€šå¸¸ä¸ä¼ å‚æ•° å¯¹äºPOST/DELETE/PUTè¯·æ±‚,xhr.send(data)çš„å‚æ•°dataå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š ArrayBuffer Blob Document DOMString FormData æ¥ä¸€ä¸ªğŸŒ° å®¢æˆ·ç«¯ä»£ç 123456789101112131415161718192021222324252627var fileInputElement = document.getElementById('file')var oMyForm = new FormData();oMyForm.append(\"username\", \"dcs\");oMyForm.append(\"num\", 123456); // æ•°å­—123456è¢«ç«‹å³è½¬æ¢æˆå­—ç¬¦ä¸²\"123456\"// fileInputElementä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·æ‰€é€‰æ‹©çš„æ–‡ä»¶for (var i = 0; i &lt; fileInputElement.files.length; i++) &#123; oMyForm.append(\"file\", fileInputElement.files[i]);&#125;var oFileBody = '&lt;a id=\"a\"&gt;&lt;b id=\"b\"&gt;hey!&lt;/b&gt;&lt;/a&gt;'; // Blobå¯¹è±¡åŒ…å«çš„æ–‡ä»¶å†…å®¹var oBlob = new Blob([oFileBody], &#123; type: \"text/xml\"&#125;);oMyForm.append(\"blob\", oBlob);var xhr = new XMLHttpRequest();xhr.upload.onprogress = function(event) &#123; if (event.lengthComputable) &#123; var completedPercent = event.loaded / event.total; console.log(completedPercent); &#125;&#125;xhr.open(\"POST\", \"/upload\");xhr.send(oMyForm); æœåŠ¡ç«¯ä»£ç 12345678if (req.url == '/upload' &amp;&amp; req.method.toLowerCase() == 'post') &#123; req.on('data', function(buffer) &#123; //ä¼šä¸æ—¶çš„è§¦å‘dataäº‹ä»¶æ¥æ¥å—å®¢æˆ·ç«¯ä¼ é€’çš„æ•°æ® &#125;) .on('end', function() &#123; //æ•°æ®ä¼ é€’å®Œæ¯• &#125;);&#125; æ³¨æ„: å®¢æˆ·ç«¯çš„xhr.upload.onprogressè¡¨ç¤ºçš„æ˜¯ä¸Šä¼ è¿›åº¦è§¦å‘çš„å›è°ƒ(è¿›åº¦å–å†³äºå®¢æˆ·ç«¯çš„ç½‘ç»œçŠ¶å†µ),å‚æ•°event.totalé’ˆå¯¹çš„æ˜¯æ‰€æœ‰fileçš„æ€»å¤§å°, è€ŒæœåŠ¡ç«¯çš„req.on(&#39;data&#39;, function(){})åªæ˜¯è¿™æ¬¡è¯·æ±‚çš„æ•°æ®æµæ¥å—ä¸€å®šé‡çš„æ•°æ®åè§¦å‘çš„å›è°ƒ,ä¸¤è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³» å‚è€ƒèµ„æ–™ ä½ çœŸçš„ä¼šä½¿ç”¨XMLHttpRequestå—ï¼Ÿ MDN XMLHttpRequest XMLHttpRequest2 æ–°æŠ€å·§","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"http://lh2907883.github.io/blog/tags/javascript/"}]},{"title":"Hello World","slug":"hello-world","date":"2017-05-06T08:43:45.000Z","updated":"2017-05-13T08:19:31.000Z","comments":true,"path":"2017/05/06/hello-world/","link":"","permalink":"http://lh2907883.github.io/blog/2017/05/06/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}]}