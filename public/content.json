{"meta":{"title":"dcsçš„åšå®¢","subtitle":"å°½é‡ä¸çå†™","description":"å°½é‡ä¸çå†™","author":"lihao","url":"http://lh2907883.github.io/blog"},"pages":[],"posts":[{"title":"å…³äºXMLHttpRequest","slug":"å…³äºXMLHttpRequest","date":"2017-05-07T04:37:45.000Z","updated":"2017-05-07T15:34:46.000Z","comments":true,"path":"2017/05/07/å…³äºXMLHttpRequest/","link":"","permalink":"http://lh2907883.github.io/blog/2017/05/07/å…³äºXMLHttpRequest/","excerpt":"","text":"XMLHttpRequestæ˜¯ä»€ä¹ˆXMLHttpRequest æ˜¯ä¸€ä¸ªAPI, å®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ AJAX ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚ å…¼å®¹æ€§ IE8/IE9ä¹Ÿå®Œå…¨ä¸æ”¯æŒxhrå¯¹è±¡, ä¸è¿‡å¯ä»¥ä½¿ç”¨ActiveXObjectç±»ç”Ÿæˆxhrå®ä¾‹ 1new window.ActiveXObject( \"Microsoft.XMLHTTP\" ) IE10/IE11éƒ¨åˆ†æ”¯æŒï¼Œä¸æ”¯æŒ xhr.responseTypeä¸ºjson å¦‚ä½•ä½¿ç”¨ä½¿ç”¨xhrç»™åå°serverå‘é€è¯·æ±‚,å¤§æ¦‚å¯ä»¥åˆ†ä¸‹é¢å‡ ä¸ªæ­¥éª¤ 1.å®ä¾‹åŒ–XMLHttpRequestå¯¹è±¡1var xhr = new XMLHttpRequest(); 2.åˆå§‹åŒ–ä¸€ä¸ªè¯·æ±‚1xhr.open('POST', '/server', true); open(method, url [, async = true [, username = null [, password = null]]]) async: é»˜è®¤å€¼ä¸ºtrueï¼Œå³ä¸ºå¼‚æ­¥è¯·æ±‚ï¼Œè‹¥async=falseï¼Œåˆ™ä¸ºåŒæ­¥è¯·æ±‚ 3.è®¾ç½®xhrå‚æ•°3.1 è®¾ç½®request header é€šè¿‡è°ƒç”¨setRequestHeaderæ–¹æ³•,è®¾ç½®è¯·æ±‚å¤´,è¿™ä¸€æ­¥å¿…é¡»åœ¨xhr.openä¹‹åè°ƒç”¨ setRequestHeaderå¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›–overrideçš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ appendçš„æ–¹å¼123xhr.setRequestHeader('X-Test', 'one');xhr.setRequestHeader('X-Test', 'two');// æœ€ç»ˆrequest headerä¸­\"X-Test\"ä¸º: one, two 3.2 è®¾ç½®response type å¯ä»¥è®¾ç½®xhr.responseType,ä¸‹é¢æ˜¯responseTypeæ”¯æŒçš„ç±»å‹ å€¼ xhr.response æ•°æ®ç±»å‹ è¯´æ˜ â€œâ€ String é»˜è®¤å€¼(åœ¨ä¸è®¾ç½®responseTypeæ—¶) â€œtextâ€ String â€œdocumentâ€ Document å¯¹è±¡ å¸Œæœ›è¿”å› XML æ ¼å¼æ•°æ®æ—¶ä½¿ç”¨ â€œjsonâ€ javascript å¯¹è±¡ å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼ŒIE10/IE11ä¸æ”¯æŒ â€œblobâ€ Blobå¯¹è±¡ â€œarrayBufferâ€ ArrayBufferå¯¹è±¡ å®¢æˆ·ç«¯ä»£ç 12345678910var xhr = new XMLHttpRequest();xhr.open('GET', '/json');xhr.responseType = 'json';xhr.onreadystatechange = function(e) &#123; if (this.readyState == 4 &amp;&amp; this.status == 200) &#123; //é€šè¿‡xhr.responseå¯ä»¥æ‹¿åˆ°è¿”å›çš„jsonæ•°æ® console.log(this.response); &#125;&#125;;xhr.send(); æœåŠ¡ç«¯ä»£ç 12345if (req.url == '/json') &#123; res.writeHead(200, &#123; 'content-type': 'application/json' &#125;); res.write('&#123;\"a\": 123, \"b\": \"dcs\"&#125;'); res.end();&#125; é€šè¿‡è°ƒç”¨xhr.overrideMimeTypeæ–¹æ³•æ¥é‡å†™responseçš„content-type(ä¸è¿‡è¿™ä¸ªæ–¹æ³•æˆ‘è°ƒç”¨ä¹‹åå¹¶æ²¡æœ‰èµ·ä½œç”¨..) 3.3 è®¾ç½®è¯·æ±‚è¶…æ—¶å¯ä»¥è®¾ç½®xhr.timeout,æ¥è®¾ç½®è¶…æ—¶æ—¶é—´(å•ä½æ¯«ç§’),åœ¨xhr.send()æ–¹æ³•è°ƒç”¨åå¼€å§‹è®¡æ—¶ 3.4 è®¾ç½®xhrçŠ¶æ€å˜åŒ–æ—¶çš„å›è°ƒ1234567891011121314xhr.onreadystatechange = function () &#123; switch(xhr.readyState)&#123; case 0://UNSENT,open()æ–¹æ³•æ²¡æœ‰è°ƒç”¨ break; case 1://OPENED,open()æ–¹æ³•å·²è¢«æˆåŠŸè°ƒç”¨,send()æ–¹æ³•è¿˜æœªè¢«è°ƒç”¨ã€‚ break; case 2://HEADERS_RECEIVED,send()æ–¹æ³•å·²ç»è¢«è°ƒç”¨, å“åº”å¤´å’Œå“åº”çŠ¶æ€å·²ç»è¿”å› break; case 3://LOADING,å“åº”ä½“ä¸‹è½½ä¸­,responseTextä¸­å·²ç»è·å–äº†éƒ¨åˆ†æ•°æ®. break; case 4://DONE,æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹å·²ç»å®Œæ¯•. break; &#125;&#125; 3.5 xhrçš„äº‹ä»¶ äº‹ä»¶ è§¦å‘æ¡ä»¶ onreadystatechange æ¯å½“xhr.readyStateæ”¹å˜æ—¶è§¦å‘ï¼›ä½†xhr.readyStateç”±é0å€¼å˜ä¸º0æ—¶ä¸è§¦å‘ã€‚ onloadstart è°ƒç”¨xhr.send()æ–¹æ³•åç«‹å³è§¦å‘ï¼Œè‹¥xhr.send()æœªè¢«è°ƒç”¨åˆ™ä¸ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚ onprogress xhr.upload.onprogressåœ¨ä¸Šä¼ é˜¶æ®µ(å³xhr.send()ä¹‹åï¼Œxhr.readystate=2ä¹‹å‰)è§¦å‘ï¼›xhr.onprogressåœ¨ä¸‹è½½é˜¶æ®µï¼ˆå³xhr.readystate=3æ—¶ï¼‰è§¦å‘ onload å½“è¯·æ±‚æˆåŠŸå®Œæˆæ—¶è§¦å‘ï¼Œæ­¤æ—¶xhr.readystate=4 onloadend å½“è¯·æ±‚ç»“æŸï¼ˆåŒ…æ‹¬è¯·æ±‚æˆåŠŸå’Œè¯·æ±‚å¤±è´¥ï¼‰æ—¶è§¦å‘ onabort å½“è°ƒç”¨xhr.abort()åè§¦å‘ ontimeout xhr.timeoutä¸ç­‰äº0ï¼Œç”±è¯·æ±‚å¼€å§‹å³onloadstartå¼€å§‹ç®—èµ·ï¼Œå½“åˆ°è¾¾xhr.timeoutæ‰€è®¾ç½®æ—¶é—´è¯·æ±‚è¿˜æœªç»“æŸå³onloadendï¼Œåˆ™è§¦å‘æ­¤äº‹ä»¶ã€‚ onerror åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œè‹¥å‘ç”ŸNetwork erroråˆ™ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼ˆè‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ è¿˜æ²¡æœ‰ç»“æŸï¼Œåˆ™ä¼šå…ˆè§¦å‘xhr.upload.onerrorï¼Œå†è§¦å‘xhr.onerrorï¼›è‹¥å‘ç”ŸNetwork erroræ—¶ï¼Œä¸Šä¼ å·²ç»ç»“æŸï¼Œåˆ™åªä¼šè§¦å‘xhr.onerrorï¼‰ã€‚æ³¨æ„ï¼Œåªæœ‰å‘ç”Ÿäº†ç½‘ç»œå±‚çº§åˆ«çš„å¼‚å¸¸æ‰ä¼šè§¦å‘æ­¤äº‹ä»¶ï¼Œå¯¹äºåº”ç”¨å±‚çº§åˆ«çš„å¼‚å¸¸ï¼Œå¦‚å“åº”è¿”å›çš„xhr.statusCodeæ˜¯4xxæ—¶ï¼Œå¹¶ä¸å±äºNetwork errorï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘onerroräº‹ä»¶ï¼Œè€Œæ˜¯ä¼šè§¦å‘onloadäº‹ä»¶ã€‚ 4.å‘é€æ•°æ®1xhr.send(data); å¯¹äºGET/HEADè¯·æ±‚sendæ–¹æ³•é€šå¸¸ä¸ä¼ å‚æ•° å¯¹äºPOST/DELETE/PUTè¯·æ±‚,xhr.send(data)çš„å‚æ•°dataå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š ArrayBuffer Blob Document DOMString FormData æ¥ä¸€ä¸ªğŸŒ° å®¢æˆ·ç«¯ä»£ç 123456789101112131415161718192021222324252627var fileInputElement = document.getElementById('file')var oMyForm = new FormData();oMyForm.append(\"username\", \"dcs\");oMyForm.append(\"num\", 123456); // æ•°å­—123456è¢«ç«‹å³è½¬æ¢æˆå­—ç¬¦ä¸²\"123456\"// fileInputElementä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·æ‰€é€‰æ‹©çš„æ–‡ä»¶for (var i = 0; i &lt; fileInputElement.files.length; i++) &#123; oMyForm.append(\"file\", fileInputElement.files[i]);&#125;var oFileBody = '&lt;a id=\"a\"&gt;&lt;b id=\"b\"&gt;hey!&lt;/b&gt;&lt;/a&gt;'; // Blobå¯¹è±¡åŒ…å«çš„æ–‡ä»¶å†…å®¹var oBlob = new Blob([oFileBody], &#123; type: \"text/xml\"&#125;);oMyForm.append(\"blob\", oBlob);var xhr = new XMLHttpRequest();xhr.upload.onprogress = function(event) &#123; if (event.lengthComputable) &#123; var completedPercent = event.loaded / event.total; console.log(completedPercent); &#125;&#125;xhr.open(\"POST\", \"/upload\");xhr.send(oMyForm); æœåŠ¡ç«¯ä»£ç 12345678if (req.url == '/upload' &amp;&amp; req.method.toLowerCase() == 'post') &#123; req.on('data', function(buffer) &#123; //ä¼šä¸æ—¶çš„è§¦å‘dataäº‹ä»¶æ¥æ¥å—å®¢æˆ·ç«¯ä¼ é€’çš„æ•°æ® &#125;) .on('end', function() &#123; //æ•°æ®ä¼ é€’å®Œæ¯• &#125;);&#125; æ³¨æ„: å®¢æˆ·ç«¯çš„xhr.upload.onprogressè¡¨ç¤ºçš„æ˜¯ä¸Šä¼ è¿›åº¦è§¦å‘çš„å›è°ƒ(è¿›åº¦å–å†³äºå®¢æˆ·ç«¯çš„ç½‘ç»œçŠ¶å†µ),å‚æ•°event.totalé’ˆå¯¹çš„æ˜¯æ‰€æœ‰fileçš„æ€»å¤§å°, è€ŒæœåŠ¡ç«¯çš„req.on(&#39;data&#39;, function(){})åªæ˜¯è¿™æ¬¡è¯·æ±‚çš„æ•°æ®æµæ¥å—ä¸€å®šé‡çš„æ•°æ®åè§¦å‘çš„å›è°ƒ,ä¸¤è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³» å‚è€ƒèµ„æ–™ ä½ çœŸçš„ä¼šä½¿ç”¨XMLHttpRequestå—ï¼Ÿ MDN XMLHttpRequest XMLHttpRequest2 æ–°æŠ€å·§","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"http://lh2907883.github.io/blog/tags/javascript/"}]},{"title":"Hello World","slug":"hello-world","date":"2017-05-06T08:43:45.000Z","updated":"2017-05-13T08:19:31.000Z","comments":true,"path":"2017/05/06/hello-world/","link":"","permalink":"http://lh2907883.github.io/blog/2017/05/06/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}]}